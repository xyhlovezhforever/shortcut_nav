# 任务编排服务核心逻辑文档索引

## 文档概览

本目录包含任务编排服务的详细技术文档，按功能模块分类组织，详细说明了系统的关键机制、代码位置和工作流程。

---

## 目录结构

```
Core_document/项目实现细节相关的文档/
├── 01-核心机制/           # 数据流转、参数处理、并行执行
├── 02-规划系统/           # 两阶段规划、语义路由、场景感知
├── 03-反思与恢复/         # 单步反思、计划级反思、智能恢复
├── 04-评估与提示词/       # 提示词系统、上下文工程、任务评估
├── 05-集成与推送/         # 事件推送、集成机制
├── 06-代码映射/           # 代码与文档的双向映射关系
└── archive-过时文档/      # 已被新文档覆盖的历史文档
```

---

## 01-核心机制

### [1-数据槽位的智能流转.md](./01-核心机制/1-数据槽位的智能流转.md)

**核心内容**:
- 三层数据存储架构（initial_metadata、runtime_metadata、step_results）
- 参数解析与占位符处理机制
- 步骤输出到运行时元数据的智能流转
- 数据依赖和参数传递的完整流程

**关键文件**:
- `src/core/execution_context.rs` - 执行上下文管理
- `src/core/parameter_resolver.rs` - 参数解析器
- `src/core/executor.rs` - 执行器与数据流转

**适用场景**: 理解多步骤任务中的数据如何在步骤间传递和流转

---

### [7-多步骤执行与参数动态占位机制详解.md](./01-核心机制/7-多步骤执行与参数动态占位机制详解.md)

**核心内容**:
- 占位符语法与解析规则
- 参数引用与依赖关系
- 运行时参数替换机制
- 复杂场景下的参数传递

**关键文件**:
- `src/core/parameter_resolver.rs` - 参数解析核心
- `src/core/executor.rs` - 参数应用逻辑

**适用场景**: 深入理解参数占位符机制和动态参数解析

---

### [8-并行执行功能代码修改详细记录.md](./01-核心机制/8-并行执行功能代码修改详细记录.md)

**核心内容**:
- 并行执行架构设计
- DAG（有向无环图）依赖分析
- 并发控制与同步机制
- 性能优化实现

**关键文件**:
- `src/core/parallel_executor.rs` - 并行执行器
- `src/core/dag_analyzer.rs` - 依赖分析器

**适用场景**: 理解并行执行的实现原理和性能优化

---

### [16-动态参数推断功能实现详解.md](./01-核心机制/16-动态参数推断功能实现详解.md)

**核心内容**:
- 动态参数推断设计背景与核心原则
- LLM驱动的参数推断流程
- 提示词模块（ParameterInferenceContext、ParameterInferenceResult）
- Executor的动态推断方法与回退机制
- 配置开关与使用指南

**关键文件**:
- `src/llm/parameter_inference_prompts.rs` - 参数推断提示词模块
- `src/core/executor.rs` - 执行器动态推断逻辑
- `src/config/mod.rs` - 配置结构定义

**适用场景**:
- 需要根据执行上下文动态生成工具参数
- 参数依赖关系复杂，难以用静态占位符表达

---

## 02-规划系统

### [4-两阶段规划架构与实现.md](./02-规划系统/4-两阶段规划架构与实现.md)

**核心内容**:
- 两阶段规划设计背景和优势
- 工具筛选阶段（简化信息，快速筛选）
- 任务分解阶段（详细信息，精准规划）
- Token优化（50-76%的token节省）
- 流式推送（实时工具筛选结果）
- 场景适配（初始规划和任务重新规划使用两阶段，单步修复复用原工具集）

**关键文件**:
- `src/core/planner.rs` - 两阶段规划核心逻辑
- `src/llm/prompts.rs` - 双阶段提示词模板
- `src/core/orchestrator.rs` - EventSender trait扩展
- `src/grpc/server.rs` - 流式推送实现

**适用场景**: 理解两阶段规划如何优化性能和提升规划质量

---

### [10-语义路由机制与场景感知提示词系统设计文档.md](./02-规划系统/10-语义路由机制与场景感知提示词系统设计文档(人为干预不同意图场景下大模型行动的核心武器).md)

**核心内容**:
- 基于意图识别的语义路由机制
- SceneManager场景管理器设计与实现
- 三个阶段(规划、反思、重新规划)的场景感知提示词系统
- 场景类型定义与匹配策略(精确匹配、模糊匹配、默认兜底)
- 五种内置场景(自然语言建模、工具管理、PLC控制器、客户端管理、通用)
- 场景扩展指南与最佳实践

**关键文件**:
- `src/llm/scene_guidance.rs` - 场景管理核心
- `src/llm/planning_prompts.rs` - 规划阶段提示词
- `src/llm/reflection_prompts.rs` - 反思阶段提示词
- `src/core/planner.rs` - 意图提取与场景路由

**适用场景**:
- 理解系统如何根据任务类型自动选择不同的提示词策略
- 学习如何新增自定义场景类型
- 优化特定领域任务的提示词指导

---

### [15-继续规划功能实现详解.md](./02-规划系统/15-继续规划功能实现详解.md)

**核心内容**:
- 继续规划（Continue Planning）机制
- 增量规划与任务延续
- 状态保持与上下文传递
- 🆕 **v2.0**: LLM智能规划策略判断（第11章）

**关键文件**:
- `src/core/planner.rs` - 继续规划逻辑与策略判断
- `src/llm/continue_planning_prompts.rs` - 继续规划提示词与策略判断
- `src/core/orchestrator.rs` - 规划延续控制

**适用场景**:
- 理解如何在现有计划基础上继续规划
- 学习LLM智能策略判断机制

---

### [22-LLM智能规划策略判断.md](./02-规划系统/22-LLM智能规划策略判断.md) 🆕

**核心内容**:
- **v2.0新增**：LLM智能规划策略判断机制
- 三种规划策略：继续规划、重新规划、普通规划
- 从关键词匹配升级为LLM智能判断（准确率 70% → 95%）
- 策略判断提示词设计
- 降级机制与容错处理
- 性能与成本分析

**关键文件**:
- `src/llm/continue_planning_prompts.rs:324-536` - 策略判断提示词与函数
- `src/core/planner.rs:481-611` - Planner集成逻辑
- `src/llm/mod.rs` - 公共接口导出

**核心数据结构**:
```rust
// 规划策略类型
pub enum PlanningStrategy {
    ContinuePlanning,  // 继续规划
    Replanning,        // 重新规划
    NormalPlanning,    // 普通规划
}

// 策略判断结果
pub struct PlanningStrategyDetectionResult {
    pub strategy: PlanningStrategy,
    pub confidence: f32,      // 置信度 0-100
    pub reasoning: String,    // 判断理由
}
```

**核心函数**:
- `detect_planning_strategy_with_llm()` - LLM策略判断
- `PlanningStrategyDetectionResult` - 判断结果结构

**适用场景**:
- 理解LLM如何智能判断规划策略
- 学习降级策略和容错机制
- 了解性能优化和成本控制
- 掌握策略判断的最佳实践

**优势**:
- ✅ 准确率从 ~70% 提升到 ~95%
- ✅ 支持自然语言和隐含意图识别
- ✅ 提供置信度评分和判断理由
- ✅ LLM失败时自动降级到关键词匹配

---

### [23-双模式工具筛选提示词设计.md](./02-规划系统/23-双模式工具筛选提示词设计.md) 🆕

**核心内容**:
- 双模式工具筛选的设计背景与价值
- 首次规划工具筛选提示词（预测性筛选）
- 重新规划工具筛选提示词（修正性筛选）
- 两种模式的对比与适用场景
- 完整的提示词模板与示例

**关键文件**:
- `src/llm/selection_prompts.rs:117-461` - 双模式工具筛选提示词

**核心差异**:
- 首次筛选：基于需求预测（语义匹配 + 意图识别）
- 重新筛选：基于执行反馈（保留/替换/补充/移除）

**适用场景**:
- 理解工具筛选的两种模式
- 学习如何设计预测性和修正性提示词
- 了解如何利用执行反馈优化工具选择

---

### [24-双模式工具筛选集成实现说明.md](./02-规划系统/24-双模式工具筛选集成实现说明.md) 🆕

**核心内容**:
- 双模式工具筛选的完整实现细节
- 数据结构设计（ReplanningToolSelectionContext、PreviousToolInfo）
- Planner 方法实现（select_relevant_tools、select_tools_for_replanning）
- Orchestrator 集成逻辑（工具效果收集、传递）
- 完整的代码映射和调用链路

**关键文件**:
- `src/llm/selection_prompts.rs` - 提示词实现
- `src/core/planner.rs:481-611, 1845-2071` - 工具筛选方法
- `src/core/orchestrator.rs:2916-2924` - 工具效果收集
- `src/llm/mod.rs` - 模块导出

**实现状态**: ✅ 已完整实现并集成

**适用场景**:
- 理解双模式工具筛选的实现细节
- 查找工具筛选相关代码位置
- 了解如何在Orchestrator中收集和传递工具效果
- 学习如何集成新的工具筛选模式

---

## 03-反思与恢复

### [14-单步反思与执行历史优化详解.md](./03-反思与恢复/14-单步反思与执行历史优化详解.md)

**核心内容**:
- 避免重复反思的机制设计
- 执行历史传递逻辑优化
- 任务后评估统计失败步骤的修复
- 反思内容占位符问题修复
- 单步反思提示词约束增强

**关键文件**:
- `src/core/orchestrator.rs` - 单步反思执行历史判断
- `src/core/post_task_evaluator.rs` - 任务后评估优化
- `src/llm/reflection_prompts.rs` - 反思提示词约束

**适用场景**:
- 理解如何避免重复反思相同问题
- 了解执行历史在反思中的作用

---

### [17-移除轮数限制-由大模型决定反思与重规划.md](./03-反思与恢复/17-移除轮数限制-由大模型决定反思与重规划.md)

**核心内容**:
- 移除人为轮数限制的设计理念
- 大模型自主决策机制（should_replan字段）
- 反思终止条件的智能判断
- 配置参数的演变

**关键文件**:
- `src/core/orchestrator.rs` - 反思循环控制
- `src/core/reflector.rs` - 反思决策逻辑
- `src/config/mod.rs` - 配置参数定义

**适用场景**: 理解系统如何让大模型自主决定是否继续反思

---

### [18-反思与规划实现逻辑与代码映射详解.md](./03-反思与恢复/18-反思与规划实现逻辑与代码映射详解.md)

**核心内容**:
- 反思器(Reflector)完整实现：数据结构、核心方法、错误分类
- 规划器(Planner)完整实现：两阶段规划、意图提取、重新规划
- 反思提示词系统：ReflectionContext、任务级反思、单步反思提示词结构
- 编排器反思循环：ContextEngineeringEventBuilder、执行历史格式化
- 场景管理与配置系统
- 核心调用关系与代码位置汇总

**关键文件**:
- `src/core/reflector.rs` - 反思器核心实现
- `src/core/planner.rs` - 规划器核心实现
- `src/core/orchestrator.rs` - 编排器与上下文工程
- `src/llm/reflection_prompts.rs` - 反思提示词模块
- `src/llm/scene_guidance.rs` - 场景管理器

**适用场景**:
- 理解反思与规划的完整工作流程
- 查找反思/规划相关代码的具体位置
- 了解提示词系统的结构设计
- 理解大模型如何自主决策是否继续反思

---

### [19-反思机制设计与实现文档.md](./03-反思与恢复/19-反思机制设计与实现文档.md)

**核心内容**:
- 两级反思架构（单步反思 + 计划级反思）
- 三大应对策略（参数修复、工具替换、停止反思）
- 清晰的决策流程与步骤式分析
- 丰富的场景示例（16个具体案例）
- 强化的重复检测机制
- 严格的一致性检查规则

**关键文件**:
- `src/llm/reflection_prompts.rs` - 反思提示词管理
- `src/core/reflector.rs` - 反思执行器
- `src/core/orchestrator.rs` - 任务编排器
- `src/core/parallel_executor.rs` - 步骤执行器

**适用场景**:
- 全面理解反思机制的设计理念
- 学习如何设计高质量的反思提示词
- 了解不同错误类型的处理策略

---

### [21-单步反思触发整体反思与细粒度重规划策略.md](./03-反思与恢复/21-单步反思触发整体反思与细粒度重规划策略.md)

**核心内容**:
- 单步反思不再直接停止任务，改为触发整体反思
- StepAction::StopExecution → TriggerOverallReflection 变更
- 细粒度重规划策略（FullReplan、ReplanFromStep、SkipSteps、AddRemediationSteps、AdjustDependencies）
- 整体反思指导信息传递到重新规划阶段
- 完整的代码映射和调用链路

**关键文件**:
- `src/core/reflector.rs` - StepAction 枚举、ReflectionResult、策略解析
- `src/core/orchestrator.rs` - TriggerOverallReflection 处理、指导信息传递
- `src/llm/reflection_prompts.rs` - 单步反思和整体反思提示词
- `src/llm/replanning_prompts.rs` - ReplanningStrategy、OverallReflectionGuidance

**适用场景**:
- 理解单步反思与整体反思的协作机制
- 学习细粒度重规划策略的使用
- 了解整体反思如何指导重新规划

---

### [22-反思输出结构化优化.md](./03-反思与恢复/22-反思输出结构化优化.md)

**核心内容**:
- 反思输出结构化优化背景与目标
- 整体反思5章节结构化模板（执行情况概览、问题诊断、改进方案、决策结论、经验总结）
- 单步反思3章节结构化模板（执行历史审查、错误分析、建议方案）
- 证据→推理→结论的逻辑链条
- 多方案对比与决策透明化

**关键文件**:
- `src/llm/reflection_prompts.rs` - 结构化提示词模板

**适用场景**:
- 理解反思输出的标准格式
- 快速定位反思结果中的关键信息
- 优化反思提示词的可读性

---

### [25-反思与工具筛选协同机制总览.md](./03-反思与恢复/25-反思与工具筛选协同机制总览.md) 🆕

**核心内容**:
- 反思机制与工具筛选机制的深度协同
- 两级反思架构（单步反思 + 整体反思）完整流程
- 双模式工具筛选（首次规划 + 重新规划）详细对比
- 协同工作流程全景图
- 关键数据流转与结构传递链
- 完整的代码映射（反思、工具筛选、编排器集成）

**关键文件**:
- `src/core/reflector.rs` - 反思核心实现
- `src/llm/selection_prompts.rs` - 双模式工具筛选提示词
- `src/core/planner.rs` - 工具筛选逻辑
- `src/core/orchestrator.rs` - 编排器协同集成
- `src/llm/replanning_prompts.rs` - 重规划策略定义

**适用场景**:
- **架构师必读**：理解反思与工具筛选的协同架构
- 快速了解反思机制的完整工作流程
- 理解工具筛选如何基于执行反馈动态调整
- 查找反思和工具筛选的代码映射关系
- 理解系统如何从失败中学习并优化工具选择

**文档特色**:
- 📊 完整的架构总览和流程图
- 🔍 详细的数据流转说明
- 🗺️ 精确的代码位置映射
- 💡 实战示例和使用场景

---

## 04-评估与提示词

### [5-提示词系统与核心工作流程.md](./04-评估与提示词/5-提示词系统与核心工作流程.md)

**核心内容**:
- 提示词模板系统（规划、评估、反思）
- Reflective Planning循环流程
- 四个阶段的详细实现（Planning → Execution → Evaluation → Reflection）
- 终止条件和配置参数

**关键文件**:
- `src/llm/prompts.rs` - 提示词模板定义
- `src/core/orchestrator.rs` - 核心工作流程控制
- `src/core/planner.rs` - 规划阶段
- `src/core/evaluator.rs` - 评估阶段
- `src/core/reflector.rs` - 反思阶段

**适用场景**: 理解系统的整体工作流程和LLM交互机制

---

### [11-上下文工程事件实现细节.md](./04-评估与提示词/11-上下文工程事件实现细节.md)

**核心内容**:
- 上下文工程事件（Context Engineering Event）设计
- ContextEngineeringEventBuilder实现
- 成功步骤与失败步骤的记录机制
- 执行历史格式化

**关键文件**:
- `src/core/orchestrator.rs` - ContextEngineeringEventBuilder
- `src/core/reflector.rs` - 执行历史使用

**适用场景**: 理解执行历史的收集、格式化和传递机制

---

### [12-上下文工程事件-格式化文本使用指南.md](./04-评估与提示词/12-上下文工程事件-格式化文本使用指南.md)

**核心内容**:
- 格式化文本的结构说明
- 各个字段的含义和用途
- 格式化文本的解析方法

**关键文件**:
- `src/core/orchestrator.rs` - format_to_file方法

**适用场景**: 了解如何使用和解析上下文工程事件的格式化文本

---

### [13-任务后评估功能实现详解.md](./04-评估与提示词/13-任务后评估功能实现详解.md)

**核心内容**:
- 任务后评估（Post-task Evaluation）机制
- LLM驱动的任务复盘
- 评估维度与评分标准
- 评估结果的存储与使用

**关键文件**:
- `src/core/post_task_evaluator.rs` - 任务后评估器
- `src/core/orchestrator.rs` - 评估触发逻辑

**适用场景**: 理解任务完成后的评估和复盘机制

---

## 05-集成与推送

### [Kafka日志系统实现详解.md](./05-集成与推送/Kafka日志系统实现详解.md)

**核心内容**:
- Kafka 日志系统架构与主题划分
- 三大核心组件（KafkaLogger、AuditLogger、TaskEventProducer）
- 日志发送点详解（步骤规划、工具执行、任务状态）
- 配置管理与主题统一读取
- 容错机制与降级策略

**关键文件**:
- `src/logging/kafka_logger.rs` - Kafka 日志记录器
- `src/kafka/audit.rs` - 审计日志记录器
- `src/kafka/producer.rs` - 任务事件生产者
- `src/core/planner.rs` - 步骤规划日志发送
- `src/core/executor.rs` - 工具执行日志发送
- `src/core/orchestrator.rs` - 任务状态日志发送
- `src/config/mod.rs` - Kafka 配置结构

**适用场景**:
- 理解 Kafka 日志系统的完整实现
- 了解如何发送和配置各类日志
- 排查日志发送问题

---

### [6-user模式下服务端事件推送机制详解.md](./05-集成与推送/6-user模式下服务端事件推送机制详解.md)

**核心内容**:
- 服务端事件推送（Server-Sent Events, SSE）��制
- user模式下的实时通信
- 事件类型与数据格式
- 前后端集成

**关键文件**:
- `src/grpc/server.rs` - 事件推送实现
- `src/core/orchestrator.rs` - 事件发送调用

**适用场景**: 理解如何实现实时任务进度推送

---

## 06-代码映射

### [代码文档实时映射.md](./06-代码映射/代码文档实时映射.md)

**核心内容**:
- 核心模块代码映射（src/core/、src/llm/）
- 功能到代码的映射（数据流转、规划、反思等9大功能）
- 文档到代码的映射（每个文档涉及的代码文件）
- 代码到文档的映射（每个代码文件的相关文档）
- 快速查找指南（我想修改XXX功能应该看哪些文件）

**关键信息**:
- **核心模块**: 10个核心文件的详细映射
- **提示词模块**: 12个提示词文件的详细映射
- **双向映射**: 代码↔文档的完整对应关系
- **维护指南**: 如何保持映射文档的同步

**适用场景**:
- 快速定位某个功能的代码实现位置
- 了解某个代码文件对应的文档说明
- 修改代码时查找相关文档
- 更新文档时确认涉及的代码范围
- 新人快速了解代码结构

---

## 过时文档归档

以下文档已被新版本覆盖，保留在 `archive-过时文档/` 目录供参考：

- `2-单步执行失败后的评估反思与重新规划.md` - 已被文档14、18、19覆盖
- `3-单步重试与重新规划的逻辑实现详解.md` - 已被文档18、19覆盖
- `9-反思模块与智能重执行机制详解.md` - 已被文档18、19覆盖
- `当前项目流程_2025_12_29.md` - 时效性文档，已过时
- `核心模块代码映射_2025_12_29.md` - 时效性文档，已过时

---

## 快速导航

### 按功能查找

**数据传递与参数处理**:
- 如何在步骤间传递数据？ → [01-核心机制/1-数据槽位的智能流转.md](./01-核心机制/1-数据槽位的智能流转.md)
- 如何使用参数占位符？ → [01-核心机制/7-多步骤执行与参数动态占位机制详解.md](./01-核心机制/7-多步骤执行与参数动态占位机制详解.md)
- 如何动态推断参数？ → [01-核心机制/16-动态参数推断功能实现详解.md](./01-核心机制/16-动态参数推断功能实现详解.md)

**规划与路由**:
- 两阶段规划如何工作？ → [02-规划系统/4-两阶段规划架构与实现.md](./02-规划系统/4-两阶段规划架构与实现.md)
- 如何实现场景感知？ → [02-规划系统/10-语义路由机制与场景感知提示词系统设计文档.md](./02-规划系统/10-语义路由机制与场景感知提示词系统设计文档(人为干预不同意图场景下大模型行动的核心武器).md)
- 如何继续规划？ → [02-规划系统/15-继续规划功能实现详解.md](./02-规划系统/15-继续规划功能实现详解.md)
- 双模式工具筛选如何工作？ → [02-规划系统/23-双模式工具筛选提示词设计.md](./02-规划系统/23-双模式工具筛选提示词设计.md)
- 工具筛选如何集成？ → [02-规划系统/24-双模式工具筛选集成实现说明.md](./02-规划系统/24-双模式工具筛选集成实现说明.md)

**反思与恢复**:
- **架构总览**：反思与工具筛选如何协同？ → [03-反思与恢复/25-反思与工具筛选协同机制总览.md](./03-反思与恢复/25-反思与工具筛选协同机制总览.md) 🔥
- 步骤失败后如何处理？ → [03-反思与恢复/19-反思机制设计与实现文档.md](./03-反思与恢复/19-反思机制设计与实现文档.md)
- 如何避免重复反思？ → [03-反思与恢复/14-单步反思与执行历史优化详解.md](./03-反思与恢复/14-单步反思与执行历史优化详解.md)
- 大模型如何决定反思？ → [03-反思与恢复/17-移除轮数限制-由大模型决定反思与重规划.md](./03-反思与恢复/17-移除轮数限制-由大模型决定反思与重规划.md)
- 反思代码在哪里？ → [03-反思与恢复/18-反思与规划实现逻辑与代码映射详解.md](./03-反思与恢复/18-反思与规划实现逻辑与代码映射详解.md)
- 单步反思如何触发整体反思？ → [03-反思与恢复/21-单步反思触发整体反思与细粒度重规划策略.md](./03-反思与恢复/21-单步反思触发整体反思与细粒度重规划策略.md)
- 细粒度重规划策略有哪些？ → [03-反思与恢复/21-单步反思触发整体反思与细粒度重规划策略.md](./03-反思与恢复/21-单步反思触发整体反思与细粒度重规划策略.md)
- 反思输出格式是什么？ → [03-反思与恢复/22-反思输出结构化优化.md](./03-反思与恢复/22-反思输出结构化优化.md)

**提示词与评估**:
- 提示词系统如何设计？ → [04-评估与提示词/5-提示词系统与核心工作流程.md](./04-评估与提示词/5-提示词系统与核心工作流程.md)
- 执行历史如何记录？ → [04-评估与提示词/11-上下文工程事件实现细节.md](./04-评估与提示词/11-上下文工程事件实现细节.md)
- 任务后如何评估？ → [04-评估与提示词/13-任务后评估功能实现详解.md](./04-评估与提示词/13-任务后评估功能实现详解.md)

**执行与集成**:
- 如何实现并行执行？ → [01-核心机制/8-并行执行功能代码修改详细记录.md](./01-核心机制/8-并行执行功能代码修改详细记录.md)
- 如何发送 Kafka 日志？ → [05-集成与推送/Kafka日志系统实现详解.md](./05-集成与推送/Kafka日志系统实现详解.md)
- 如何推送实时事件？ → [05-集成与推送/6-user模式下服务端事件推送机制详解.md](./05-集成与推送/6-user模式下服务端事件推送机制详解.md)

### 按角色查找

**开发者**:
- 修改数据流转逻辑 → 01-核心机制
- 优化反思与恢复策略 → 03-反思与恢复
- 调整提示词系统 → 02-规划系统 + 04-评估与提示词
- 实现新功能 → 根据功能模块选择相应目录

**架构师**:
- 理解系统整体设计 → [04-评估与提示词/5-提示词系统与核心工作流程.md](./04-评估与提示词/5-提示词系统与核心工作流程.md)
- 理解数据架构 → 01-核心机制
- 理解反思机制 → 03-反思与恢复
- 理解规划架构 → 02-规划系统

**运维人员**:
- 配置参数说明 → 各模块文档的"配置"部分
- 故障排查 → 03-反思与恢复
- 性能优化 → 01-核心机制 + 02-规划系统

### 新手入门推荐阅读顺序

1. [04-评估与提示词/5-提示词系统与核心工作流程.md](./04-评估与提示词/5-提示词系统与核心工作流程.md) - 理解整体工作流程
2. [01-核心机制/1-数据槽位的智能流转.md](./01-核心机制/1-数据槽位的智能流转.md) - 理解数据如何流转
3. [02-规划系统/4-两阶段规划架构与实现.md](./02-规划系统/4-两阶段规划架构与实现.md) - 理解规划优化
4. [03-反思与恢复/19-反思机制设计与实现文档.md](./03-反思与恢复/19-反思机制设计与实现文档.md) - 理解反思机制
5. 根据需要阅读其他专题文档

---

## 代码文件总览

### 核心模块

```
src/core/
├── orchestrator.rs          # 核心工作流程控制
├── planner.rs              # 规划与重新规划
├── executor.rs             # 步骤执行与数据流转
├── parallel_executor.rs    # 并行执行器
├── evaluator.rs            # 评估阶段
├── reflector.rs            # 反思阶段
├── execution_context.rs    # 执行上下文管理
├── parameter_resolver.rs   # 参数解析
├── dag_analyzer.rs         # DAG依赖分析
└── post_task_evaluator.rs  # 任务后评估
```

### 提示词模块

```
src/llm/
├── prompts.rs                       # 工具筛选提示词
├── planning_prompts.rs              # 规划阶段提示词
├── reflection_prompts.rs            # 反思阶段提示词
├── replanning_prompts.rs            # 重新规划提示词
├── scene_guidance.rs                # 场景管理核心
├── parameter_inference_prompts.rs   # 动态参数推断提示词
└── unified_client.rs                # LLM客户端
```

---

## 文档特点

1. **模块化组织** - 按功能模块分类，便于查找和维护
2. **详细的代码映射** - 每个文档都标注了具体的代码位置和行号
3. **完整的流程图** - 使用Mermaid语法绘制，清晰展示流程
4. **丰富的示例** - 包含真实场景的应用示例
5. **设计理念说明** - 解释设计原则和优势特点

---

## 更新日志

- **2026-01-15**:
  - 🆕 新增文档25《反思与工具筛选协同机制总览》，提供完整的架构总览和代码映射
  - 🆕 新增文档23《双模式工具筛选提示词设计》，详细说明首次规划和重新规划的工具筛选策略
  - 🆕 新增文档24《双模式工具筛选集成实现说明》，说明双模式工具筛选的完整实现
  - ✅ 新增文档22《反思输出结构化优化》，优化反思结果的可读性和结构化
- **2026-01-14**: 新增文档21《单步反思触发整体反思与细粒度重规划策略》，详细说明反思流程变更和细粒度策略
- **2026-01-13**: 新增《Kafka日志系统实现详解》文档，详细说明日志发送点和配置管理
- **2026-01-12**: 重组文档目录结构，按功能模块分类；移除过时文档；更新索引
- 2026-01-12: 新增文档18《反思与规划实现逻辑与代码映射详解》
- 2026-01-08: 新增文档7《动态参数推断功能实现详解》
- 2025-12-29: 新增文档6《语义路由机制与场景感知提示词系统设计》
- 2024-12-02: 新增文档5《规划模块优化方案》
- 2024-11-27: 新增文档4《两阶段规划架构与实现》
- 2024-11-18: 创建初始版本

---

## 贡献指南

更新文档时请确保：
1. 代码位置标注准确（文件路径 + 行号）
2. 流程图与代码实现一致
3. 示例真实可运行
4. 中文表述清晰准确
5. 文档放在正确的功能模块目录下

---

**最后更新**: 2026-01-15
**文档版本**: v2.3
**组织方式**: 按功能模块分类
