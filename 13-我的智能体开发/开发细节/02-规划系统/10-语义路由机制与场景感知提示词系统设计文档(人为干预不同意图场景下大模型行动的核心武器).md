# è¯­ä¹‰è·¯ç”±æœºåˆ¶ä¸åœºæ™¯æ„ŸçŸ¥æç¤ºè¯ç³»ç»Ÿè®¾è®¡æ–‡æ¡£

> **æ–‡æ¡£ç‰ˆæœ¬**: v2.0
> **åˆ›å»ºæ—¥æœŸ**: 2025-12-29
> **æœ€åæ›´æ–°**: 2025-12-30
> **ç³»ç»Ÿç‰ˆæœ¬**: 2025_12_30_version
> **é‡è¦æ€§**: â­â­â­â­â­ (æ ¸å¿ƒè®¾è®¡æ–‡æ¡£ï¼Œæ—¥åè¿­ä»£çš„é‡è¦å‚è€ƒ)

---

## ğŸ“‹ ç›®å½•

1. [ç³»ç»Ÿæ¦‚è¿°](#1-ç³»ç»Ÿæ¦‚è¿°)
2. [æ¶æ„è®¾è®¡](#2-æ¶æ„è®¾è®¡)
3. [æ ¸å¿ƒç»„ä»¶è¯¦è§£](#3-æ ¸å¿ƒç»„ä»¶è¯¦è§£)
4. [è¯­ä¹‰è·¯ç”±å®ç°æœºåˆ¶](#4-è¯­ä¹‰è·¯ç”±å®ç°æœºåˆ¶)
5. [åœºæ™¯æ„ŸçŸ¥æç¤ºè¯ç³»ç»Ÿ](#5-åœºæ™¯æ„ŸçŸ¥æç¤ºè¯ç³»ç»Ÿ)
6. [å„é˜¶æ®µæç¤ºè¯è¯¦è§£](#6-å„é˜¶æ®µæç¤ºè¯è¯¦è§£)
7. [åœºæ™¯ä¸“å±æŒ‡å¯¼å†…å®¹](#7-åœºæ™¯ä¸“å±æŒ‡å¯¼å†…å®¹)
8. [å®é™…æ‰§è¡Œæµç¨‹](#8-å®é™…æ‰§è¡Œæµç¨‹)
9. [æ‰©å±•æŒ‡å—](#9-æ‰©å±•æŒ‡å—)
10. [æœ€ä½³å®è·µ](#10-æœ€ä½³å®è·µ)
11. [å¸¸è§é—®é¢˜](#11-å¸¸è§é—®é¢˜)

---

## 1. ç³»ç»Ÿæ¦‚è¿°

### 1.1 è®¾è®¡ç›®æ ‡

æœ¬ç³»ç»Ÿå®ç°äº†ä¸€å¥—åŸºäº**æ„å›¾è¯†åˆ«**çš„**è¯­ä¹‰è·¯ç”±æœºåˆ¶**,é€šè¿‡åœ¨ä¸‰ä¸ªå…³é”®é˜¶æ®µ(è§„åˆ’ã€åæ€ã€é‡æ–°è§„åˆ’)æ³¨å…¥**åœºæ™¯æ„ŸçŸ¥çš„æç¤ºè¯æŒ‡å¯¼**,å®ç°äº†æ™ºèƒ½åŒ–çš„ä»»åŠ¡å¤„ç†æµç¨‹ã€‚

### 1.2 æ ¸å¿ƒç‰¹æ€§

- âœ… **æ„å›¾é©±åŠ¨**: ä»ä»»åŠ¡æè¿°ä¸­æå–æ˜ç¡®æ„å›¾æ ‡è®°
- âœ… **è¯­ä¹‰è·¯ç”±**: åŸºäºæ„å›¾è‡ªåŠ¨åŒ¹é…åœºæ™¯ç±»å‹
- âœ… **åœºæ™¯æ„ŸçŸ¥**: ä¸åŒåœºæ™¯ä½¿ç”¨ä¸åŒçš„ä¸“å±æç¤ºè¯
- âœ… **ç»Ÿä¸€ç®¡ç†**: æ‰€æœ‰åœºæ™¯å®šä¹‰åœ¨ä¸€å¤„ç»´æŠ¤
- âœ… **æ¨¡å—åŒ–è®¾è®¡**: ä¸‰ä¸ªé˜¶æ®µç‹¬ç«‹é…ç½®ä½†ç»Ÿä¸€åè°ƒ
- âœ… **å¯æ‰©å±•æ€§**: æ–°å¢åœºæ™¯åªéœ€ä¿®æ”¹ä¸€å¤„ä»£ç 

### 1.3 é€‚ç”¨åœºæ™¯

| åœºæ™¯ç±»å‹ | ä¸­æ–‡åç§° | åˆ«å/å…³é”®è¯ | å…¸å‹ä»»åŠ¡ |
|---------|---------|-----------|---------|
| `NaturalLanguageModeling` | è‡ªç„¶è¯­è¨€å»ºæ¨¡ | è‡ªåŠ¨å»ºæ¨¡ã€å»ºæ¨¡ã€modelingã€ä»¿çœŸã€æ‹“æ‰‘ | æ•°å­—å­ªç”Ÿå»ºæ¨¡ã€ç³»ç»Ÿæ‹“æ‰‘æ„å»º |
| `ToolManagement` | å·¥å…·ç®¡ç† | ä»£ç ç”Ÿæˆã€å·¥å…·ã€tool_management | åˆ›å»ºè®¡ç®—å™¨å·¥å…·ã€ç”Ÿæˆå·¥å…·æ–¹æ¡ˆ |
| `PlcController` | PLCæ§åˆ¶å™¨ | plcã€æ§åˆ¶å™¨ã€controllerã€è®¾å¤‡ | PLCè®¾å¤‡è¿æ¥ã€æ•°æ®é‡‡é›† |
| `ClientManagement` | å®¢æˆ·ç«¯ç®¡ç† | å®¢æˆ·ç«¯æ“ä½œã€è§’è‰²ã€roleã€ç”¨æˆ· | æ·»åŠ è§’è‰²ã€ç”¨æˆ·ç®¡ç† |
| `General` | é€šç”¨ | generalã€default | æ— æ˜ç¡®åœºæ™¯çš„ä»»åŠ¡ |

---

## 2. æ¶æ„è®¾è®¡

### 2.1 ç³»ç»Ÿåˆ†å±‚æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Orchestrator (ç¼–æ’å±‚)                     â”‚
â”‚  - åè°ƒ Plannerã€Reflectorã€Replanner                       â”‚
â”‚  - ç®¡ç†ä»»åŠ¡æ‰§è¡Œæµç¨‹                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚            â”‚            â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
    â”‚ Planner â”‚  â”‚Reflectorâ”‚ â”‚Replannerâ”‚
    â”‚ (è§„åˆ’)  â”‚  â”‚ (åæ€)  â”‚ â”‚(é‡æ–°è§„åˆ’)â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â”‚           â”‚            â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   SceneManager (åœºæ™¯ç®¡ç†) â”‚
         â”‚  - æ„å›¾è¯†åˆ«               â”‚
         â”‚  - åœºæ™¯åŒ¹é…               â”‚
         â”‚  - æç¤ºè¯è·¯ç”±             â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  SceneGuidance (åœºæ™¯æŒ‡å¯¼) â”‚
         â”‚  - planning_guidance      â”‚
         â”‚  - reflection_guidance    â”‚
         â”‚  - replanning_guidance    â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 ä»£ç æ¨¡å—ç»“æ„

```
src/llm/
â”œâ”€â”€ mod.rs                      # æ¨¡å—å¯¼å‡º
â”œâ”€â”€ prompts.rs                  # æç¤ºè¯ç»Ÿä¸€å…¥å£(re-export)
â”œâ”€â”€ scene_guidance.rs           # ğŸŒŸ åœºæ™¯ç®¡ç†æ ¸å¿ƒ ğŸŒŸ
â”‚   â”œâ”€â”€ SceneType              # åœºæ™¯ç±»å‹æšä¸¾
â”‚   â”œâ”€â”€ SceneGuidance          # åœºæ™¯æŒ‡å¯¼ç»“æ„
â”‚   â”œâ”€â”€ SceneManager           # åœºæ™¯ç®¡ç†å™¨
â”‚   â””â”€â”€ [åœºæ™¯æŒ‡å¯¼å¸¸é‡å®šä¹‰]
â”œâ”€â”€ selection_prompts.rs        # å·¥å…·ç­›é€‰æç¤ºè¯ + Builder
â”œâ”€â”€ planning_prompts.rs         # è§„åˆ’æç¤ºè¯ + Builder
â”œâ”€â”€ evaluation_prompts.rs       # è¯„ä¼°æç¤ºè¯ + Builder
â”œâ”€â”€ reflection_prompts.rs       # åæ€æç¤ºè¯ + Builder
â”œâ”€â”€ replanning_prompts.rs       # é‡æ–°è§„åˆ’æç¤ºè¯ + Builder
â””â”€â”€ message_templates.rs        # ç”¨æˆ·æ¶ˆæ¯æ¨¡æ¿ + Builder
```

---

## 3. æ ¸å¿ƒç»„ä»¶è¯¦è§£

### 3.1 SceneType (åœºæ™¯ç±»å‹æšä¸¾)

**æ–‡ä»¶ä½ç½®**: `src/llm/scene_guidance.rs:10-86`

```rust
#[derive(Debug, Clone, Copy, PartialEq, Eq, Hash)]
pub enum SceneType {
    NaturalLanguageModeling,  // è‡ªç„¶è¯­è¨€å»ºæ¨¡
    ToolManagement,           // å·¥å…·ç®¡ç†
    PlcController,            // PLCæ§åˆ¶å™¨
    ClientManagement,         // å®¢æˆ·ç«¯ç®¡ç†
    General,                  // é€šç”¨åœºæ™¯(é»˜è®¤)
}
```

**å…³é”®æ–¹æ³•**:
- `primary_name()`: è¿”å›ä¸»åç§°(ä¸­æ–‡)
- `aliases()`: è¿”å›æ‰€æœ‰åˆ«å(ç”¨äºç²¾ç¡®åŒ¹é…)
- `keywords()`: è¿”å›å…³é”®è¯(ç”¨äºæ¨¡ç³ŠåŒ¹é…)

### 3.2 SceneGuidance (åœºæ™¯æŒ‡å¯¼ç»“æ„)

**æ–‡ä»¶ä½ç½®**: `src/llm/scene_guidance.rs:91-105`

```rust
pub struct SceneGuidance {
    pub selection_guidance: &'static str,     // å·¥å…·ç­›é€‰é˜¶æ®µæŒ‡å¯¼
    pub planning_guidance: &'static str,      // è§„åˆ’é˜¶æ®µæŒ‡å¯¼
    pub evaluation_guidance: &'static str,    // æ‰§è¡Œè¯„ä¼°é˜¶æ®µæŒ‡å¯¼
    pub reflection_guidance: &'static str,    // åæ€é˜¶æ®µæŒ‡å¯¼
    pub replanning_guidance: &'static str,    // é‡æ–°è§„åˆ’é˜¶æ®µæŒ‡å¯¼
    pub message_guidance: &'static str,       // ç”¨æˆ·æ¶ˆæ¯ç”ŸæˆæŒ‡å¯¼
}
```

**è®¾è®¡åŸåˆ™**:
- æ¯ä¸ªåœºæ™¯éƒ½æœ‰å…­ä¸ªé˜¶æ®µçš„å®Œæ•´æŒ‡å¯¼(è¦†ç›–å®Œæ•´ä»»åŠ¡ç”Ÿå‘½å‘¨æœŸ)
- ä½¿ç”¨é™æ€å­—ç¬¦ä¸²,ç¼–è¯‘æ—¶ç¡®å®š
- å¯ä»¥ä¸ºç©ºå­—ç¬¦ä¸²(ä½¿ç”¨é»˜è®¤è¡Œä¸º)

### 3.3 SceneManager (åœºæ™¯ç®¡ç†å™¨)

**æ–‡ä»¶ä½ç½®**: `src/llm/scene_guidance.rs:218-382`

è¿™æ˜¯æ•´ä¸ªè¯­ä¹‰è·¯ç”±ç³»ç»Ÿçš„**æ ¸å¿ƒå¤§è„‘**,è´Ÿè´£:
1. æ³¨å†Œæ‰€æœ‰åœºæ™¯çš„åˆ«ååˆ°æ˜ å°„è¡¨
2. æ ¹æ®ä»»åŠ¡ç±»å‹å­—ç¬¦ä¸²åŒ¹é…åœºæ™¯
3. æä¾›å…­ä¸ªé˜¶æ®µçš„åœºæ™¯æŒ‡å¯¼æŸ¥è¯¢æ¥å£

**å…³é”®æ–¹æ³•**:

```rust
impl SceneManager {
    // åŒ¹é…åœºæ™¯ç±»å‹
    pub fn match_scene(&self, task_type: Option<&str>) -> SceneType

    // è·å–å·¥å…·ç­›é€‰é˜¶æ®µæŒ‡å¯¼
    pub fn get_selection_guidance(&self, task_type: Option<&str>) -> &'static str

    // è·å–è§„åˆ’é˜¶æ®µæŒ‡å¯¼
    pub fn get_planning_guidance(&self, task_type: Option<&str>) -> &'static str

    // è·å–æ‰§è¡Œè¯„ä¼°é˜¶æ®µæŒ‡å¯¼
    pub fn get_evaluation_guidance(&self, task_type: Option<&str>) -> &'static str

    // è·å–åæ€é˜¶æ®µæŒ‡å¯¼
    pub fn get_reflection_guidance(&self, task_type: Option<&str>) -> &'static str

    // è·å–é‡æ–°è§„åˆ’é˜¶æ®µæŒ‡å¯¼
    pub fn get_replanning_guidance(&self, task_type: Option<&str>) -> &'static str

    // è·å–ç”¨æˆ·æ¶ˆæ¯ç”ŸæˆæŒ‡å¯¼
    pub fn get_message_guidance(&self, task_type: Option<&str>) -> &'static str
}
```

---

## 4. è¯­ä¹‰è·¯ç”±å®ç°æœºåˆ¶

### 4.1 æ„å›¾æå– (Intent Extraction)

**å®ç°ä½ç½®**: `src/core/planner.rs:53-87`

ç³»ç»Ÿæ”¯æŒä»ä»»åŠ¡æè¿°ä¸­æå–æ˜ç¡®çš„æ„å›¾æ ‡è®°:

```rust
fn extract_intent_from_task(task_description: &str) -> Option<String> {
    let patterns = ["æ„å›¾:", "æ„å›¾:", "Intent:", "Intent:"];

    for pattern in &patterns {
        if let Some(start_pos) = task_description.find(pattern) {
            let after_colon = &task_description[start_pos + pattern.len()..];

            // æå–åˆ°ç¬¬ä¸€ä¸ªé€—å·ã€ä¸­æ–‡é€—å·æˆ–æ¢è¡Œç¬¦ä¹‹å‰çš„å†…å®¹
            let intent = after_colon
                .split(&[',', ',', '\n'][..])
                .next()
                .map(|s| s.trim().to_string())?;

            if !intent.is_empty() {
                return Some(intent);
            }
        }
    }
    None
}
```

**æ”¯æŒæ ¼å¼**:
- âœ… `æ„å›¾: å·¥å…·ç®¡ç†, ç”¨æˆ·è¾“å…¥: åˆ›å»ºè®¡ç®—å™¨`
- âœ… `æ„å›¾: PLCæ§åˆ¶å™¨, ç”¨æˆ·è¾“å…¥: è¿æ¥è®¾å¤‡`
- âœ… `Intent: tool_management, user_input: create tool`

**æå–ç»“æœ**:
- `"æ„å›¾: å·¥å…·ç®¡ç†, ç”¨æˆ·è¾“å…¥: ..."` â†’ `Some("å·¥å…·ç®¡ç†")`
- `"åˆ›å»ºè®¡ç®—å™¨å·¥å…·"` (æ— æ„å›¾æ ‡è®°) â†’ `None`

### 4.2 åœºæ™¯åŒ¹é… (Scene Matching)

**å®ç°ä½ç½®**: `src/llm/scene_guidance.rs:197-230`

**åŒ¹é…ç­–ç•¥** (ä¼˜å…ˆçº§ä»é«˜åˆ°ä½):

```
1. ç²¾ç¡®åŒ¹é…åˆ«å (ä¸åŒºåˆ†å¤§å°å†™)
   â””â”€> æŸ¥è¯¢ alias_map
       â”œâ”€> "å·¥å…·ç®¡ç†" â†’ ToolManagement
       â”œâ”€> "tool_management" â†’ ToolManagement
       â””â”€> "TOOL_MANAGEMENT" â†’ ToolManagement

2. æ¨¡ç³ŠåŒ¹é…å…³é”®è¯
   â””â”€> éå†æ‰€æœ‰åœºæ™¯çš„ keywords()
       â”œâ”€> task_type åŒ…å« keyword
       â”œâ”€> keyword åŒ…å« task_type
       â””â”€> ç¤ºä¾‹: "åˆ›å»ºå·¥å…·ä»»åŠ¡" åŒ…å« "å·¥å…·" â†’ ToolManagement

3. é»˜è®¤è¿”å› General
   â””â”€> æ— æ³•åŒ¹é…æ—¶çš„å…œåº•ç­–ç•¥
```

**ä»£ç ç¤ºä¾‹**:

```rust
pub fn match_scene(&self, task_type: Option<&str>) -> SceneType {
    let task_type_lower = task_type
        .map(|s| s.to_lowercase())
        .unwrap_or_else(|| "é€šç”¨".to_string());

    // 1. ç²¾ç¡®åŒ¹é…
    if let Some(&scene_type) = self.alias_map.get(&task_type_lower) {
        return scene_type;
    }

    // 2. æ¨¡ç³ŠåŒ¹é…
    for scene_type in [NaturalLanguageModeling, ToolManagement, PlcController, ClientManagement] {
        for keyword in scene_type.keywords() {
            if task_type_lower.contains(&keyword.to_lowercase())
               || keyword.to_lowercase().contains(&task_type_lower) {
                return scene_type;
            }
        }
    }

    // 3. é»˜è®¤è¿”å›é€šç”¨åœºæ™¯
    SceneType::General
}
```

### 4.3 æç¤ºè¯è·¯ç”± (Prompt Routing)

å…­ä¸ªé˜¶æ®µéƒ½ä½¿ç”¨ç»Ÿä¸€çš„è·¯ç”±é€»è¾‘:

```rust
// å·¥å…·ç­›é€‰é˜¶æ®µ
pub fn get_selection_guidance(&self, task_type: Option<&str>) -> &'static str {
    let scene_type = self.match_scene(task_type);
    self.get_scene_guidance(scene_type).selection_guidance
}

// è§„åˆ’é˜¶æ®µ
pub fn get_planning_guidance(&self, task_type: Option<&str>) -> &'static str {
    let scene_type = self.match_scene(task_type);
    self.get_scene_guidance(scene_type).planning_guidance
}

// è¯„ä¼°é˜¶æ®µ
pub fn get_evaluation_guidance(&self, task_type: Option<&str>) -> &'static str {
    let scene_type = self.match_scene(task_type);
    self.get_scene_guidance(scene_type).evaluation_guidance
}

// åæ€é˜¶æ®µ
pub fn get_reflection_guidance(&self, task_type: Option<&str>) -> &'static str {
    let scene_type = self.match_scene(task_type);
    self.get_scene_guidance(scene_type).reflection_guidance
}

// é‡æ–°è§„åˆ’é˜¶æ®µ
pub fn get_replanning_guidance(&self, task_type: Option<&str>) -> &'static str {
    let scene_type = self.match_scene(task_type);
    self.get_scene_guidance(scene_type).replanning_guidance
}

// ç”¨æˆ·æ¶ˆæ¯ç”Ÿæˆé˜¶æ®µ
pub fn get_message_guidance(&self, task_type: Option<&str>) -> &'static str {
    let scene_type = self.match_scene(task_type);
    self.get_scene_guidance(scene_type).message_guidance
}
```

---

## 5. åœºæ™¯æ„ŸçŸ¥æç¤ºè¯ç³»ç»Ÿ

### 5.1 è®¾è®¡åŸåˆ™

1. **åŸºç¡€æ¨¡æ¿ + åœºæ™¯æŒ‡å¯¼åˆ†ç¦»**
   - åŸºç¡€æ¨¡æ¿: å¯¹æ‰€æœ‰åœºæ™¯é€šç”¨çš„æ ¸å¿ƒé€»è¾‘
   - åœºæ™¯æŒ‡å¯¼: æ³¨å…¥åˆ°ç”¨æˆ·æç¤ºè¯ä¸­çš„ç‰¹å®šè§„åˆ™

2. **æç¤ºè¯ä¼˜å…ˆçº§**
   ```
   åœºæ™¯ä¸“å±æŒ‡å¯¼ > é€šç”¨è¦æ±‚ > ç¤ºä¾‹
   ```

3. **æ’å…¥ä½ç½®**
   - è§„åˆ’é˜¶æ®µ: æ’å…¥åˆ°ç”¨æˆ·æç¤ºè¯çš„ `{scene_guidance}` å ä½ç¬¦
   - åæ€é˜¶æ®µ: æ’å…¥åˆ°ç”¨æˆ·æç¤ºè¯çš„ `{scene_specific_guidance}` å ä½ç¬¦
   - é‡æ–°è§„åˆ’é˜¶æ®µ: æ’å…¥åˆ°ç”¨æˆ·æç¤ºè¯çš„ `{scene_specific_guidance}` å ä½ç¬¦

### 5.2 æç¤ºè¯æ¨¡æ¿ç»“æ„

#### è§„åˆ’é˜¶æ®µ (Planning)

**æ–‡ä»¶ä½ç½®**: `src/llm/planning_prompts.rs:33-350`

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PLANNING_SYSTEM_PROMPT (ç³»ç»Ÿæç¤ºè¯)     â”‚  â† åŸºç¡€æ¨¡æ¿,ä¸å˜
â”‚  - æ ¸å¿ƒèŒè´£                             â”‚
â”‚  - å¹¶è¡Œæ‰§è¡Œè§„åˆ’                         â”‚
â”‚  - Actionsæ ¼å¼                         â”‚
â”‚  - å·¥ä½œæµåŒ¹é…è§„åˆ™                       â”‚
â”‚  - è¾“å‡ºJSON Schema                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PLANNING_USER_TEMPLATE (ç”¨æˆ·æç¤ºè¯)     â”‚
â”‚  - ä»»åŠ¡æè¿°: {task_description}         â”‚
â”‚  - å¯ç”¨å·¥å…·: {available_tools}          â”‚
â”‚  - å…ƒæ•°æ®: {metadata}                   â”‚
â”‚  - ä¸Šä¸‹æ–‡: {context}                    â”‚
â”‚  - åæ€å†å²: {reflection_history}       â”‚
â”‚  - å·¥ä½œæµæç¤º: {workflow_hint}          â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”      â”‚
â”‚  âš ï¸ ã€åœºæ™¯ä¸“å±è§„åˆ’æŒ‡å¯¼ - æœ€é«˜ä¼˜å…ˆçº§ã€‘    â”‚ â† åŠ¨æ€æ³¨å…¥
â”‚  {scene_guidance}                       â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”      â”‚
â”‚  - é€šç”¨è¦æ±‚                             â”‚
â”‚  - ç¤ºä¾‹                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### åæ€é˜¶æ®µ (Reflection)

**æ–‡ä»¶ä½ç½®**: `src/llm/reflection_prompts.rs:80-154`

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BASE_REFLECTION_SYSTEM_PROMPT          â”‚  â† åŸºç¡€æ¨¡æ¿,ä¸å˜
â”‚  - æ ¸å¿ƒèŒè´£                             â”‚
â”‚  - å…³é”®é—®é¢˜                             â”‚
â”‚  - è¾“å‡ºè¦æ±‚                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BASE_REFLECTION_USER_TEMPLATE          â”‚
â”‚  - ä»»åŠ¡ç›®æ ‡: {task_description}         â”‚
â”‚  - å½“å‰è½®æ¬¡: {current_round}            â”‚
â”‚  - å·²æˆåŠŸæ­¥éª¤: {successful_steps}       â”‚
â”‚  - ç²¾ç‚¼ä¸Šä¸‹æ–‡: {refined_context}        â”‚
â”‚  - åŸå§‹è®¡åˆ’: {original_plan}            â”‚
â”‚  - è¯„ä¼°ç»“æœ: {evaluation_result}        â”‚
â”‚  {scene_specific_guidance}              â”‚ â† åŠ¨æ€æ³¨å…¥
â”‚  - åæ€ä»»åŠ¡è¯´æ˜                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### é‡æ–°è§„åˆ’é˜¶æ®µ (Replanning)

**æ–‡ä»¶ä½ç½®**: `src/llm/replanning_prompts.rs:83-190`

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BASE_REPLANNING_SYSTEM_PROMPT          â”‚  â† åŸºç¡€æ¨¡æ¿,ä¸å˜
â”‚  - æ ¸å¿ƒèŒè´£                             â”‚
â”‚  - å¹¶è¡Œæ‰§è¡Œè§„åˆ’                         â”‚
â”‚  - Actionsæ ¼å¼                         â”‚
â”‚  - å…³é”®çº¦æŸ                             â”‚
â”‚  - è¾“å‡ºJSON Schema                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BASE_REPLANNING_USER_TEMPLATE          â”‚
â”‚  - å·²æˆåŠŸæ­¥éª¤: {successful_steps}       â”‚
â”‚  - ç²¾ç‚¼ä¸Šä¸‹æ–‡: {refined_context}        â”‚
â”‚  - å¤±è´¥åŸå› : {failure_reason}           â”‚
â”‚  - å¯ç”¨å·¥å…·: {available_tools}          â”‚
â”‚  - å…ƒæ•°æ®: {metadata}                   â”‚
â”‚  - å·¥ä½œæµæç¤º: {workflow_hint}          â”‚
â”‚  {scene_specific_guidance}              â”‚ â† åŠ¨æ€æ³¨å…¥
â”‚  - é‡æ–°è§„åˆ’ä»»åŠ¡è¯´æ˜                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. å„é˜¶æ®µæç¤ºè¯è¯¦è§£

æœ¬ç³»ç»Ÿå°†ä»»åŠ¡æ‰§è¡Œæµç¨‹åˆ†ä¸ºå…­ä¸ªæ ¸å¿ƒé˜¶æ®µ,æ¯ä¸ªé˜¶æ®µéƒ½æœ‰ä¸“é—¨çš„æç¤ºè¯æ¨¡å—å’ŒBuilderã€‚

### 6.1 å·¥å…·ç­›é€‰é˜¶æ®µ (Selection Phase)

**æ¨¡å—**: `src/llm/selection_prompts.rs`
**Builder**: `SelectionPromptBuilder`

#### åŠŸèƒ½æ¦‚è¿°
ä»å¤§é‡å·¥å…·ä¸­å¿«é€Ÿç­›é€‰å‡ºä¸ä»»åŠ¡ç›¸å…³çš„å·¥å…·å­é›†,æ˜¯ä¸¤é˜¶æ®µè§„åˆ’çš„ç¬¬ä¸€æ­¥ã€‚

#### æ ¸å¿ƒæç¤ºè¯
- **TOOL_SELECTION_SYSTEM_PROMPT** (16è¡Œ-106è¡Œ)
  - æ„å›¾è¯†åˆ«ä¼˜å…ˆçº§(æœ€é«˜ä¼˜å…ˆçº§)
  - ä¸¥æ ¼åŒ¹é…åŸåˆ™
  - æ‹’ç»æ¨¡ç³Šä»»åŠ¡
  - ç›¸å…³æ€§ç­‰çº§åˆ’åˆ†

- **TOOL_SELECTION_USER_TEMPLATE** (108è¡Œ-168è¡Œ)
  - ä»»åŠ¡ä¿¡æ¯å±•ç¤º
  - å¯ç”¨å·¥å…·åˆ—è¡¨
  - ç­›é€‰ä¸¥æ ¼åº¦é…ç½®(åŠ¨æ€é˜ˆå€¼æŒ‡å¯¼)
  - åœºæ™¯ç‰¹å®šæŒ‡å¯¼æ³¨å…¥ç‚¹: `{scene_specific_guidance}`

#### å…³é”®ç‰¹æ€§
1. **æ„å›¾è¯†åˆ«æœ€é«˜ä¼˜å…ˆçº§**: å¦‚æœä»»åŠ¡åŒ…å«"æ„å›¾: XXX",å¿…é¡»ç›´æ¥ä½¿ç”¨è¯¥æ„å›¾
2. **åŠ¨æ€é˜ˆå€¼æŒ‡å¯¼**: æ ¹æ® `selection_threshold` å‚æ•°ç”Ÿæˆä¸åŒä¸¥æ ¼åº¦çš„ç­›é€‰æŒ‡å¯¼
3. **åœºæ™¯æ„ŸçŸ¥**: é€šè¿‡ `SceneManager::get_selection_guidance()` è·å–åœºæ™¯ç‰¹å®šæŒ‡å¯¼

#### Builderæ–¹æ³•
```rust
pub fn build_tool_selection_prompt(
    &self,
    task_description: &str,
    available_tools: &str,
    tool_count: usize,
    metadata: &HashMap<String, String>,
    selection_threshold: f32,
    task_type: Option<&str>,
) -> (String, String)
```

### 6.2 ä»»åŠ¡è§„åˆ’é˜¶æ®µ (Planning Phase)

**æ¨¡å—**: `src/llm/planning_prompts.rs`
**Builder**: `PlanningPromptBuilder`

#### åŠŸèƒ½æ¦‚è¿°
åŸºäºç­›é€‰å‡ºçš„å·¥å…·å­é›†,ç”Ÿæˆè¯¦ç»†çš„æ‰§è¡Œæ­¥éª¤è®¡åˆ’,æ”¯æŒå¹¶è¡Œæ‰§è¡Œè§„åˆ’ã€‚

#### æ ¸å¿ƒæç¤ºè¯
è¯¦ç»†å†…å®¹å‚è§åŸæœ‰æ–‡æ¡£(ä¿æŒä¸å˜)ã€‚

#### åœºæ™¯æŒ‡å¯¼æ³¨å…¥ç‚¹
- ç”¨æˆ·æç¤ºè¯ä¸­çš„ `{scene_guidance}` å ä½ç¬¦
- é€šè¿‡ `SceneManager::get_planning_guidance()` è·å–

### 6.3 æ‰§è¡Œè¯„ä¼°é˜¶æ®µ (Evaluation Phase)

**æ¨¡å—**: `src/llm/evaluation_prompts.rs`
**Builder**: `EvaluationPromptBuilder`

#### åŠŸèƒ½æ¦‚è¿°
è¯„ä¼°ä»»åŠ¡æ‰§è¡Œçš„è´¨é‡å’Œæ•ˆæœ,ç”Ÿæˆå››ç»´åº¦è¯„åˆ†å’Œæ”¹è¿›å»ºè®®ã€‚

#### æ ¸å¿ƒæç¤ºè¯
- **EVALUATION_SYSTEM_PROMPT** (16è¡Œ-99è¡Œ)
  - é€æ­¥è¯„ä¼°æ¯ä¸ªæ­¥éª¤çš„æ‰§è¡Œè´¨é‡
  - å››ç»´åº¦è¯„åˆ†(å®Œæ•´æ€§/æ­£ç¡®æ€§/æ•ˆç‡/å¯é æ€§)
  - æˆåŠŸ/å¤±è´¥åˆ†æ
  - æ”¹è¿›å»ºè®®ç”Ÿæˆ

- **EVALUATION_USER_TEMPLATE** (101è¡Œ-161è¡Œ)
  - ä»»åŠ¡ä¿¡æ¯ã€æ‰§è¡Œè®¡åˆ’ã€æ‰§è¡Œç»“æœ
  - åœºæ™¯ç‰¹å®šæŒ‡å¯¼æ³¨å…¥ç‚¹: `{scene_specific_guidance}`
  - é€æ­¥åˆ†æè¦æ±‚

#### è¯„åˆ†ç»´åº¦
1. **å®Œæ•´æ€§**(0-100): æ˜¯å¦æ‰§è¡Œæ‰€æœ‰å¿…è¦æ­¥éª¤
2. **æ­£ç¡®æ€§**(0-100): æ¯ä¸ªæ­¥éª¤ç»“æœæ˜¯å¦æ­£ç¡®
3. **æ•ˆç‡**(0-100): ä»»åŠ¡åˆ†è§£å’Œæ­¥éª¤é¡ºåºæ˜¯å¦ä¼˜åŒ–
4. **å¯é æ€§**(0-100): æ‰§è¡Œè¿‡ç¨‹æ˜¯å¦ç¨³å®š

#### Builderæ–¹æ³•
```rust
pub fn build_evaluation_prompt(
    &self,
    task_description: &str,
    execution_plan: &str,
    execution_results: &str,
    task_type: Option<&str>,
) -> (String, String)
```

### 6.4 åæ€é˜¶æ®µ (Reflection Phase)

**æ¨¡å—**: `src/llm/reflection_prompts.rs`
**Builder**: `ReflectionPromptBuilder`

è¯¦ç»†å†…å®¹å‚è§åŸæœ‰æ–‡æ¡£(ä¿æŒä¸å˜)ã€‚

### 6.5 é‡æ–°è§„åˆ’é˜¶æ®µ (Replanning Phase)

**æ¨¡å—**: `src/llm/replanning_prompts.rs`
**Builder**: `ReplanningPromptBuilder`

è¯¦ç»†å†…å®¹å‚è§åŸæœ‰æ–‡æ¡£(ä¿æŒä¸å˜)ã€‚

### 6.6 ç”¨æˆ·æ¶ˆæ¯ç”Ÿæˆé˜¶æ®µ (Message Generation Phase)

**æ¨¡å—**: `src/llm/message_templates.rs`
**Builder**: `MessageTemplateBuilder`

#### åŠŸèƒ½æ¦‚è¿°
å°†æŠ€æœ¯æ€§è¾“å‡ºè½¬æ¢ä¸ºç”¨æˆ·å‹å¥½çš„å™äº‹é£æ ¼æ¶ˆæ¯,æå‡ç”¨æˆ·ä½“éªŒã€‚

#### æ ¸å¿ƒæ¨¡æ¿

1. **OUTPUT_STYLE_TEMPLATE** (16è¡Œ-34è¡Œ)
   - æŠ€æœ¯å†…å®¹ â†’ ç”¨æˆ·å‹å¥½é£æ ¼è½¬æ¢
   - emojiæ§åˆ¶ã€æ ¼å¼è§„èŒƒã€ä¿¡æ¯ä¿ç•™

2. **TOOL_SELECTION_MESSAGE_TEMPLATE** (36è¡Œ-62è¡Œ)
   - å·¥å…·ç­›é€‰é˜¶æ®µçš„ç”¨æˆ·æ¶ˆæ¯
   - åœºæ™¯æŒ‡å¯¼æ³¨å…¥ç‚¹: `{scene_specific_guidance}`

3. **TASK_PLANNING_MESSAGE_TEMPLATE** (64è¡Œ-85è¡Œ)
   - ä»»åŠ¡è§„åˆ’é˜¶æ®µçš„ç”¨æˆ·æ¶ˆæ¯

4. **STEP_COMPLETED_MESSAGE_TEMPLATE** (105è¡Œ-189è¡Œ)
   - æ­¥éª¤å®Œæˆè¿›åº¦æŠ¥å‘Š
   - **å…³é”®è¦æ±‚**: å¿…é¡»è¯¦ç»†åˆ†ææ­¥éª¤è¾“å‡º,ä»¥åˆ—è¡¨å½¢å¼å±•ç¤ºç»“æœ
   - åœºæ™¯æŒ‡å¯¼æ³¨å…¥ç‚¹: `{scene_specific_guidance}`

5. **EVALUATION_RESULT_MESSAGE_TEMPLATE** (191è¡Œ-252è¡Œ)
   - è¯„ä¼°ç»“æœæ¶ˆæ¯
   - **æ ‡å‡†æ ¼å¼**: ã€Œæ­¥éª¤åç§°ã€è¯„ä¼°å¾—åˆ† X/100,[å…³é”®æ•°æ®]ã€‚æ¥ä¸‹æ¥å°†è¿›è¡Œã€Œä¸‹ä¸€æ­¥éª¤åç§°ã€
   - åœºæ™¯æŒ‡å¯¼æ³¨å…¥ç‚¹: `{scene_specific_guidance}`

6. **MESSAGE_POLISH_SYSTEM_PROMPT & USER_TEMPLATE** (275è¡Œ-302è¡Œ)
   - æ¶ˆæ¯æ¶¦è‰²åŠŸèƒ½

#### Builderæ–¹æ³•ç¤ºä¾‹
```rust
pub fn build_tool_selection_message(
    &self,
    task_description: &str,
    tool_count: usize,
    task_type: Option<&str>,
) -> String

pub fn build_step_completed_message(
    &self,
    task_description: &str,
    completed_step_name: &str,
    step_output: &str,
    step_index: usize,
    total_steps: usize,
    next_step_name: &str,
    task_type: Option<&str>,
) -> String
```

---

## 7. åœºæ™¯ä¸“å±æŒ‡å¯¼å†…å®¹

### 7.1 å·¥å…·ç®¡ç†åœºæ™¯ (ToolManagement)

**åœºæ™¯å®šä¹‰ä½ç½®**: `src/llm/scene_guidance.rs:124-169`

#### å·¥å…·ç­›é€‰é˜¶æ®µæŒ‡å¯¼ (126è¡Œ-131è¡Œ)
```markdown
âš ï¸ **å·¥å…·ç®¡ç†ä»»åŠ¡çš„ç­›é€‰è¦ç‚¹**
- âœ… ä¼˜å…ˆé€‰æ‹© tool_management åˆ†ç±»çš„å·¥å…·
- âœ… å…³æ³¨å·¥å…·è®¾è®¡ã€ä»£ç ç”Ÿæˆç›¸å…³çš„å·¥å…·
- âŒ æ’é™¤ä¸å·¥å…·ç®¡ç†æ— å…³çš„ä¸šåŠ¡å·¥å…·
```

#### è§„åˆ’é˜¶æ®µæŒ‡å¯¼ (133è¡Œ-144è¡Œ)
```markdown
âš ï¸ **åˆ›å»ºå·¥å…·çš„ç‰¹æ®Šè§„åˆ™ - æå…¶é‡è¦**
å½“ä»»åŠ¡æ˜¯"åˆ›å»ºå·¥å…·"ã€"ç”Ÿæˆå·¥å…·"ã€"è®¾è®¡å·¥å…·"ç­‰æ—¶:
- âŒ ç¦æ­¢: ç¼–å†™ä»£ç 
- âŒ ç¦æ­¢: æ‰§è¡Œå®ç°æ­¥éª¤
- âœ… åªéœ€: ç”Ÿæˆ"å·¥å…·è®¾è®¡æ–¹æ¡ˆ"çš„å•ä¸ªæ­¥éª¤

**åŸå› è¯´æ˜**: åˆ›å»ºå·¥å…·éœ€è¦ç”¨æˆ·æ‰‹åŠ¨ç¡®è®¤è®¾è®¡æ–¹æ¡ˆåæ‰èƒ½å®æ–½
1. åªè§„åˆ’ä¸€ä¸ªæ­¥éª¤: ç”Ÿæˆå·¥å…·è®¾è®¡æ–¹æ¡ˆ
2. ç­‰å¾…ç”¨æˆ·ç¡®è®¤: æ–¹æ¡ˆç”Ÿæˆåéœ€è¦å®¡æ ¸æ‰¹å‡†
3. åç»­å®æ–½: ç¡®è®¤åç”±ç”¨æˆ·å‘èµ·æ–°ä»»åŠ¡
```

#### è¯„ä¼°é˜¶æ®µæŒ‡å¯¼ (146è¡Œ-150è¡Œ)
```markdown
âš ï¸ **å·¥å…·ç®¡ç†ä»»åŠ¡çš„è¯„ä¼°è¦ç‚¹**
- é‡ç‚¹è¯„ä¼°å·¥å…·è®¾è®¡æ–¹æ¡ˆçš„å®Œæ•´æ€§å’Œå¯è¡Œæ€§
- æ£€æŸ¥æ˜¯å¦åŒ…å«å¿…è¦å…ƒç´ (åç§°ã€åŠŸèƒ½ã€å‚æ•°ã€è¾“å‡º)
- å¦‚æœæ˜¯æ–¹æ¡ˆç”Ÿæˆä»»åŠ¡,æˆåŠŸç”Ÿæˆæ–¹æ¡ˆå³è§†ä¸ºå®Œæˆ
```

#### åæ€é˜¶æ®µæŒ‡å¯¼ (152è¡Œ-160è¡Œ)
```markdown
âš ï¸ **ç‰¹æ®Šåœºæ™¯å¤„ç†(ä¼˜å…ˆåˆ¤æ–­)**:
- å¦‚æœé”™è¯¯ä¿¡æ¯æ˜¯ "æ‰¾ä¸åˆ° tool_id å¯¹åº”çš„å·¥å…·"
  â†’ è¿™è¡¨ç¤ºéœ€è¦ç”¨æˆ·æ‰‹åŠ¨ç¡®è®¤æ–¹æ¡ˆé€‰æ‹©
  â†’ **ç»“è®º**: æ— éœ€å•æ­¥åæ€ä¹Ÿæ— éœ€é‡æ–°è§„åˆ’
  â†’ åæ€ç»“æœä¸ºæç¤ºç”¨æˆ·æ‰‹åŠ¨ç¡®è®¤ä½¿ç”¨å“ªä¸ªç”Ÿæˆçš„æ–¹æ¡ˆå³å¯
```

#### ç”¨æˆ·æ¶ˆæ¯ç”ŸæˆæŒ‡å¯¼ (164è¡Œ-168è¡Œ)
```markdown
âš ï¸ **å·¥å…·ç®¡ç†ä»»åŠ¡çš„æ¶ˆæ¯ç”Ÿæˆè¦ç‚¹**
- æ¸…æ™°è¯´æ˜å·¥å…·è®¾è®¡æ–¹æ¡ˆå·²ç”Ÿæˆ
- æé†’ç”¨æˆ·éœ€è¦ç¡®è®¤æ–¹æ¡ˆåæ‰èƒ½å®æ–½
- é¿å…ä½¿ç”¨è¿‡äºæŠ€æœ¯åŒ–çš„æœ¯è¯­
```

### 7.2 å…¶ä»–åœºæ™¯

**è‡ªç„¶è¯­è¨€å»ºæ¨¡åœºæ™¯** (110è¡Œ-122è¡Œ): å½“å‰æ‰€æœ‰å…­ä¸ªé˜¶æ®µçš„æŒ‡å¯¼éƒ½ä¸ºç©ºå­—ç¬¦ä¸²
**PLCæ§åˆ¶å™¨åœºæ™¯** (171è¡Œ-184è¡Œ): å½“å‰æ‰€æœ‰å…­ä¸ªé˜¶æ®µçš„æŒ‡å¯¼éƒ½ä¸ºç©ºå­—ç¬¦ä¸²
**å®¢æˆ·ç«¯ç®¡ç†åœºæ™¯** (186è¡Œ-199è¡Œ): å½“å‰æ‰€æœ‰å…­ä¸ªé˜¶æ®µçš„æŒ‡å¯¼éƒ½ä¸ºç©ºå­—ç¬¦ä¸²
**é€šç”¨åœºæ™¯** (201è¡Œ-214è¡Œ): å½“å‰æ‰€æœ‰å…­ä¸ªé˜¶æ®µçš„æŒ‡å¯¼éƒ½ä¸ºç©ºå­—ç¬¦ä¸²

---

## 8. å®é™…æ‰§è¡Œæµç¨‹

### 8.1 ä»ä»»åŠ¡æäº¤åˆ°åœºæ™¯åŒ¹é…

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ç”¨æˆ·æäº¤ä»»åŠ¡                                              â”‚
â”‚    ä»»åŠ¡æè¿°: "æ„å›¾: å·¥å…·ç®¡ç†, ç”¨æˆ·è¾“å…¥: åˆ›å»ºè®¡ç®—å™¨å·¥å…·"      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Planner::plan() - è§„åˆ’å™¨å¤„ç†                              â”‚
â”‚    â”œâ”€> extract_intent_from_task()                           â”‚
â”‚    â”‚   æå–æ„å›¾: "å·¥å…·ç®¡ç†"                                   â”‚
â”‚    â”‚                                                         â”‚
â”‚    â”œâ”€> å·¥å…·ç­›é€‰é˜¶æ®µ(å¦‚æœå¯ç”¨ä¸¤é˜¶æ®µè§„åˆ’)                       â”‚
â”‚    â”‚   â””â”€> LLMè¿”å› task_type: "å·¥å…·ç®¡ç†"                     â”‚
â”‚    â”‚                                                         â”‚
â”‚    â””â”€> PlanningPromptBuilder::build_enhanced_planning_prompt() â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. SceneManager::get_planning_guidance()                    â”‚
â”‚    â”œâ”€> match_scene(Some("å·¥å…·ç®¡ç†"))                         â”‚
â”‚    â”‚   â””â”€> ç²¾ç¡®åŒ¹é…åˆ«å: "å·¥å…·ç®¡ç†" â†’ ToolManagement         â”‚
â”‚    â”‚                                                         â”‚
â”‚    â”œâ”€> get_scene_guidance(ToolManagement)                   â”‚
â”‚    â”‚   â””â”€> è¿”å› TOOL_MANAGEMENT_GUIDANCE                    â”‚
â”‚    â”‚                                                         â”‚
â”‚    â””â”€> è¿”å› planning_guidance å­—æ®µ                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. æç¤ºè¯ç»„è£…                                                â”‚
â”‚    â”œâ”€> ç³»ç»Ÿæç¤ºè¯: PLANNING_SYSTEM_PROMPT (åŸºç¡€æ¨¡æ¿)        â”‚
â”‚    â”‚                                                         â”‚
â”‚    â””â”€> ç”¨æˆ·æç¤ºè¯: PLANNING_USER_TEMPLATE                   â”‚
â”‚        â”œâ”€> æ›¿æ¢ {task_description}                          â”‚
â”‚        â”œâ”€> æ›¿æ¢ {available_tools}                           â”‚
â”‚        â”œâ”€> ...                                              â”‚
â”‚        â””â”€> æ›¿æ¢ {scene_guidance}                            â”‚
â”‚            â””â”€> "âš ï¸ åˆ›å»ºå·¥å…·çš„ç‰¹æ®Šè§„åˆ™..."                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. LLMè°ƒç”¨                                                   â”‚
â”‚    â””â”€> LLMçœ‹åˆ°åœºæ™¯ä¸“å±æŒ‡å¯¼,åªè§„åˆ’å•ä¸ª"ç”Ÿæˆå·¥å…·è®¾è®¡æ–¹æ¡ˆ"æ­¥éª¤ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.2 åæ€é˜¶æ®µçš„åœºæ™¯è·¯ç”±

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ä»»åŠ¡æ‰§è¡Œå¤±è´¥                                              â”‚
â”‚    é”™è¯¯: "æ‰¾ä¸åˆ° tool_id å¯¹åº”çš„å·¥å…·"                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Reflector::reflect() - åæ€å™¨å¤„ç†                         â”‚
â”‚    â””â”€> ReflectionPromptBuilder::build_reflection_prompt()   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. SceneManager::get_reflection_guidance()                  â”‚
â”‚    â”œâ”€> match_scene(Some("å·¥å…·ç®¡ç†"))                         â”‚
â”‚    â”‚   â””â”€> ToolManagement                                   â”‚
â”‚    â”‚                                                         â”‚
â”‚    â””â”€> è¿”å› reflection_guidance                             â”‚
â”‚        â””â”€> "ç‰¹æ®Šåœºæ™¯å¤„ç†:å¦‚æœé”™è¯¯æ˜¯'æ‰¾ä¸åˆ°tool_id'..."        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. LLMè°ƒç”¨                                                   â”‚
â”‚    â””â”€> LLMè¯†åˆ«åˆ°ç‰¹æ®Šåœºæ™¯,è¾“å‡º:                               â”‚
â”‚        "æ— éœ€é‡æ–°è§„åˆ’,æç¤ºç”¨æˆ·æ‰‹åŠ¨ç¡®è®¤ä½¿ç”¨å“ªä¸ªç”Ÿæˆçš„æ–¹æ¡ˆ"      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.3 é‡æ–°è§„åˆ’é˜¶æ®µçš„åœºæ™¯è·¯ç”±

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. åæ€å™¨å†³å®šéœ€è¦é‡æ–°è§„åˆ’                                    â”‚
â”‚    should_replan: true                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Planner::replan() - é‡æ–°è§„åˆ’                              â”‚
â”‚    â””â”€> ReplanningPromptBuilder::build_replanning_prompt()   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. SceneManager::get_replanning_guidance()                  â”‚
â”‚    â”œâ”€> match_scene(Some("å·¥å…·ç®¡ç†"))                         â”‚
â”‚    â”‚   â””â”€> ToolManagement                                   â”‚
â”‚    â”‚                                                         â”‚
â”‚    â””â”€> è¿”å› replanning_guidance (å½“å‰ä¸ºç©º)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. LLMè°ƒç”¨                                                   â”‚
â”‚    â””â”€> ä½¿ç”¨åŸºç¡€æ¨¡æ¿é‡æ–°ç”Ÿæˆè®¡åˆ’                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 9. æ‰©å±•æŒ‡å—

### 9.1 æ–°å¢åœºæ™¯ç±»å‹

#### Step 1: å®šä¹‰åœºæ™¯æšä¸¾

ç¼–è¾‘ `src/llm/scene_guidance.rs`

```rust
pub enum SceneType {
    // ... ç°æœ‰åœºæ™¯
    DataAnalysis,  // ğŸ†• æ–°å¢:æ•°æ®åˆ†æåœºæ™¯
}
```

#### Step 2: å®ç°åœºæ™¯æ–¹æ³•

```rust
impl SceneType {
    pub fn primary_name(&self) -> &'static str {
        match self {
            // ... ç°æœ‰åœºæ™¯
            Self::DataAnalysis => "æ•°æ®åˆ†æ",
        }
    }

    pub fn aliases(&self) -> Vec<&'static str> {
        match self {
            // ... ç°æœ‰åœºæ™¯
            Self::DataAnalysis => vec![
                "æ•°æ®åˆ†æ",
                "æ•°æ®å¤„ç†",
                "ç»Ÿè®¡åˆ†æ",
                "data_analysis",
                "analytics",
            ],
        }
    }

    pub fn keywords(&self) -> Vec<&'static str> {
        match self {
            // ... ç°æœ‰åœºæ™¯
            Self::DataAnalysis => vec!["æ•°æ®", "åˆ†æ", "ç»Ÿè®¡", "æŠ¥è¡¨"],
        }
    }
}
```

#### Step 3: å®šä¹‰åœºæ™¯æŒ‡å¯¼å†…å®¹

```rust
const DATA_ANALYSIS_GUIDANCE: SceneGuidance = SceneGuidance {
    selection_guidance: r#"
âš ï¸ **æ•°æ®åˆ†æä»»åŠ¡çš„ç­›é€‰è¦ç‚¹**
- âœ… ä¼˜å…ˆé€‰æ‹©æ•°æ®å¤„ç†ã€ç»Ÿè®¡åˆ†æç›¸å…³å·¥å…·
- âœ… å…³æ³¨æ•°æ®æ¸…æ´—ã€å¯è§†åŒ–å·¥å…·
"#,

    planning_guidance: r#"
âš ï¸ **æ•°æ®åˆ†æä»»åŠ¡ç‰¹æ®Šè¦æ±‚**
1. å¿…é¡»å…ˆéªŒè¯æ•°æ®æºçš„å¯ç”¨æ€§å’Œæ ¼å¼
2. è§„åˆ’æ­¥éª¤:
   - Step 1: æ•°æ®åŠ è½½ä¸æ¸…æ´—
   - Step 2: æ•°æ®æ¢ç´¢æ€§åˆ†æ
   - Step 3: ç»Ÿè®¡å»ºæ¨¡æˆ–å¯è§†åŒ–
3. æ¯ä¸ªæ­¥éª¤è¾“å‡ºå¿…é¡»åŒ…å«æ•°æ®è´¨é‡æ£€æŸ¥ç»“æœ
"#,

    evaluation_guidance: r#"
âš ï¸ **æ•°æ®åˆ†æè¯„ä¼°é‡ç‚¹**
- æ•°æ®å¤„ç†æ­¥éª¤æ˜¯å¦å®Œæ•´
- åˆ†æç»“æœæ˜¯å¦ç¬¦åˆç»Ÿè®¡è§„èŒƒ
"#,

    reflection_guidance: r#"
âš ï¸ **æ•°æ®åˆ†æåæ€é‡ç‚¹**
- æ•°æ®è´¨é‡é—®é¢˜æ˜¯å¦å¯¼è‡´åˆ†æåå·®?
- ç»Ÿè®¡æ–¹æ³•é€‰æ‹©æ˜¯å¦åˆç†?
- ç»“æœè§£é‡Šæ˜¯å¦ç¬¦åˆä¸šåŠ¡é€»è¾‘?
"#,

    replanning_guidance: r#"
âš ï¸ **æ•°æ®åˆ†æé‡æ–°è§„åˆ’å»ºè®®**
- å¦‚æœæ•°æ®ç¼ºå¤±ä¸¥é‡,è€ƒè™‘ä½¿ç”¨æ’è¡¥æ–¹æ³•
- å¦‚æœæ¨¡å‹æ•ˆæœä¸ä½³,å°è¯•ç‰¹å¾å·¥ç¨‹æˆ–å…¶ä»–ç®—æ³•
"#,

    message_guidance: r#"
âš ï¸ **æ•°æ®åˆ†ææ¶ˆæ¯ç”Ÿæˆè¦ç‚¹**
- ç”¨ç®€å•è¯­è¨€è§£é‡Šç»Ÿè®¡ç»“æœ
- é¿å…ä¸“ä¸šæœ¯è¯­
"#,
};
```

#### Step 4: æ³¨å†Œåˆ°åœºæ™¯ç®¡ç†å™¨

```rust
impl SceneManager {
    pub fn new() -> Self {
        let mut alias_map = HashMap::new();

        for scene_type in [
            // ... ç°æœ‰åœºæ™¯
            SceneType::DataAnalysis,  // ğŸ†• æ–°å¢
        ] {
            for alias in scene_type.aliases() {
                alias_map.insert(alias.to_lowercase(), scene_type);
            }
        }

        Self { alias_map }
    }

    fn get_scene_guidance(&self, scene_type: SceneType) -> &SceneGuidance {
        match scene_type {
            // ... ç°æœ‰åœºæ™¯
            SceneType::DataAnalysis => &DATA_ANALYSIS_GUIDANCE,  // ğŸ†• æ–°å¢
        }
    }

    pub fn match_scene(&self, task_type: Option<&str>) -> SceneType {
        // ... ç²¾ç¡®åŒ¹é…é€»è¾‘ä¸å˜

        // æ¨¡ç³ŠåŒ¹é…æ—¶éœ€è¦åŒ…å«æ–°åœºæ™¯
        for scene_type in [
            // ... ç°æœ‰åœºæ™¯
            SceneType::DataAnalysis,  // ğŸ†• æ–°å¢
        ] {
            // ... æ¨¡ç³ŠåŒ¹é…é€»è¾‘
        }

        SceneType::General
    }

    pub fn all_scene_types(&self) -> Vec<SceneType> {
        vec![
            // ... ç°æœ‰åœºæ™¯
            SceneType::DataAnalysis,  // ğŸ†• æ–°å¢
        ]
    }
}
```

#### Step 5: ç¼–å†™å•å…ƒæµ‹è¯•

```rust
#[test]
fn test_data_analysis_scene() {
    let manager = SceneManager::new();

    // æµ‹è¯•ç²¾ç¡®åŒ¹é…
    assert_eq!(
        manager.match_scene(Some("æ•°æ®åˆ†æ")),
        SceneType::DataAnalysis
    );

    // æµ‹è¯•æ¨¡ç³ŠåŒ¹é…
    assert_eq!(
        manager.match_scene(Some("ç»Ÿè®¡æ•°æ®å¤„ç†")),
        SceneType::DataAnalysis
    );

    // æµ‹è¯•è§„åˆ’æŒ‡å¯¼
    let guidance = manager.get_planning_guidance(Some("æ•°æ®åˆ†æ"));
    assert!(guidance.contains("æ•°æ®åŠ è½½ä¸æ¸…æ´—"));
}
```

### 9.2 ä¿®æ”¹ç°æœ‰åœºæ™¯çš„æŒ‡å¯¼å†…å®¹

åªéœ€ç¼–è¾‘ `src/llm/scene_guidance.rs` ä¸­å¯¹åº”çš„å¸¸é‡å®šä¹‰:

```rust
const TOOL_MANAGEMENT_GUIDANCE: SceneGuidance = SceneGuidance {
    selection_guidance: r#"
    // ğŸ”§ ä¿®æ”¹ç­›é€‰é˜¶æ®µæŒ‡å¯¼
    "#,

    planning_guidance: r#"
    // ğŸ”§ ä¿®æ”¹è§„åˆ’é˜¶æ®µæŒ‡å¯¼
    âš ï¸ **åˆ›å»ºå·¥å…·çš„æ–°è§„åˆ™**
    1. æ–°å¢:å¿…é¡»éªŒè¯å·¥å…·åç§°çš„å”¯ä¸€æ€§
    2. ...
    "#,

    evaluation_guidance: r#"
    // ğŸ”§ ä¿®æ”¹è¯„ä¼°é˜¶æ®µæŒ‡å¯¼
    "#,

    reflection_guidance: r#"
    // ğŸ”§ ä¿®æ”¹åæ€é˜¶æ®µæŒ‡å¯¼
    "#,

    replanning_guidance: r#"
    // ğŸ”§ ä¿®æ”¹é‡æ–°è§„åˆ’é˜¶æ®µæŒ‡å¯¼
    "#,

    message_guidance: r#"
    // ğŸ”§ ä¿®æ”¹æ¶ˆæ¯ç”ŸæˆæŒ‡å¯¼
    "#,
};
```

**é‡è¦æç¤º**: ä¿®æ”¹åéœ€è¦é‡æ–°ç¼–è¯‘é¡¹ç›®,å› ä¸ºè¿™äº›æ˜¯ç¼–è¯‘æ—¶å¸¸é‡ã€‚

---

## 10. æœ€ä½³å®è·µ

### 10.1 åœºæ™¯åˆ’åˆ†åŸåˆ™

âœ… **åº”è¯¥åˆ›å»ºæ–°åœºæ™¯çš„æƒ…å†µ**:
- è¯¥ç±»ä»»åŠ¡æœ‰æ˜æ˜¾ä¸åŒäºå…¶ä»–ä»»åŠ¡çš„æ‰§è¡Œæ¨¡å¼
- éœ€è¦ç‰¹æ®Šçš„é”™è¯¯å¤„ç†é€»è¾‘
- æœ‰ç‰¹å®šçš„çº¦æŸæ¡ä»¶æˆ–æœ€ä½³å®è·µ
- ç”¨æˆ·ç»å¸¸æäº¤è¯¥ç±»ä»»åŠ¡

âŒ **ä¸åº”è¯¥åˆ›å»ºæ–°åœºæ™¯çš„æƒ…å†µ**:
- åªæœ‰å¾®å°å·®å¼‚çš„ä»»åŠ¡(å¯ä»¥ç”¨å…ƒæ•°æ®åŒºåˆ†)
- æå°‘å‡ºç°çš„ä»»åŠ¡ç±»å‹
- å¯ä»¥é€šè¿‡è°ƒæ•´é€šç”¨æ¨¡æ¿è§£å†³çš„æƒ…å†µ

### 10.2 æç¤ºè¯ç¼–å†™åŸåˆ™

1. **ç®€æ´æ˜ç¡®**: ç›´æ¥è¯´æ˜è¦åšä»€ä¹ˆ/ä¸åšä»€ä¹ˆ
2. **ä¼˜å…ˆçº§æ ‡æ³¨**: ç”¨âš ï¸ã€âœ…ã€âŒç­‰ç¬¦å·æ ‡æ³¨é‡è¦æ€§
3. **å…·ä½“åŒ–**: ç»™å‡ºå…·ä½“çš„æ­¥éª¤æˆ–ä¾‹å­,é¿å…æ¨¡ç³Šæè¿°
4. **é¿å…å†—ä½™**: ä¸è¦é‡å¤åŸºç¡€æ¨¡æ¿å·²æœ‰çš„å†…å®¹
5. **æ ¼å¼è§„èŒƒ**: ä½¿ç”¨Markdownæ ¼å¼,ä¾¿äºLLMç†è§£

### 10.3 æµ‹è¯•è¦†ç›–

æ¯ä¸ªæ–°åœºæ™¯éƒ½åº”è¯¥æœ‰å®Œæ•´çš„æµ‹è¯•:

```rust
#[test]
fn test_new_scene_complete() {
    let manager = SceneManager::new();

    // 1. æµ‹è¯•ç²¾ç¡®åŒ¹é…
    assert_eq!(manager.match_scene(Some("æ–°åœºæ™¯")), SceneType::NewScene);

    // 2. æµ‹è¯•åˆ«ååŒ¹é…
    assert_eq!(manager.match_scene(Some("new_scene")), SceneType::NewScene);

    // 3. æµ‹è¯•æ¨¡ç³ŠåŒ¹é…
    assert_eq!(manager.match_scene(Some("åŒ…å«å…³é”®è¯")), SceneType::NewScene);

    // 4. æµ‹è¯•è§„åˆ’æŒ‡å¯¼
    let planning = manager.get_planning_guidance(Some("æ–°åœºæ™¯"));
    assert!(!planning.is_empty());

    // 5. æµ‹è¯•è¯„ä¼°æŒ‡å¯¼
    let evaluation = manager.get_evaluation_guidance(Some("æ–°åœºæ™¯"));
    assert!(!evaluation.is_empty());

    // 6. æµ‹è¯•åæ€æŒ‡å¯¼
    let reflection = manager.get_reflection_guidance(Some("æ–°åœºæ™¯"));
    assert!(!reflection.is_empty());

    // 7. æµ‹è¯•é‡æ–°è§„åˆ’æŒ‡å¯¼
    let replanning = manager.get_replanning_guidance(Some("æ–°åœºæ™¯"));
    assert!(!replanning.is_empty());

    // 8. æµ‹è¯•æ¶ˆæ¯ç”ŸæˆæŒ‡å¯¼
    let message = manager.get_message_guidance(Some("æ–°åœºæ™¯"));
    assert!(!message.is_empty());
}
```

### 10.4 æ„å›¾æ ‡è®°ä½¿ç”¨è§„èŒƒ

**æ¨èæ ¼å¼** (ç”¨äºéœ€è¦æ˜ç¡®åœºæ™¯çš„ä»»åŠ¡):

```
æ„å›¾: <åœºæ™¯åç§°>, ç”¨æˆ·è¾“å…¥: <å®é™…ä»»åŠ¡æè¿°>
```

**ç¤ºä¾‹**:
- âœ… `æ„å›¾: å·¥å…·ç®¡ç†, ç”¨æˆ·è¾“å…¥: åˆ›å»ºä¸€ä¸ªè®¡ç®—ä¸¤æ•°ä¹‹å’Œçš„å·¥å…·`
- âœ… `Intent: PLCæ§åˆ¶å™¨, user_input: è¿æ¥192.168.1.100çš„PLCè®¾å¤‡`
- âŒ `åˆ›å»ºè®¡ç®—å™¨å·¥å…·` (æ— æ„å›¾æ ‡è®°,å¯èƒ½åŒ¹é…é”™è¯¯åœºæ™¯)

**ä½•æ—¶ä½¿ç”¨æ„å›¾æ ‡è®°**:
- ä»»åŠ¡æè¿°å¯èƒ½æœ‰æ­§ä¹‰æ—¶(ä¾‹å¦‚"åˆ›å»º"æ—¢å¯èƒ½æ˜¯å·¥å…·ç®¡ç†,ä¹Ÿå¯èƒ½æ˜¯å»ºæ¨¡)
- éœ€è¦å¼ºåˆ¶è·¯ç”±åˆ°ç‰¹å®šåœºæ™¯æ—¶
- æµ‹è¯•ç‰¹å®šåœºæ™¯çš„è¡Œä¸ºæ—¶

---

## 11. å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆæœ‰äº›åœºæ™¯çš„æŒ‡å¯¼å†…å®¹æ˜¯ç©ºå­—ç¬¦ä¸²?

**A**: ç©ºå­—ç¬¦ä¸²è¡¨ç¤ºè¯¥åœºæ™¯åœ¨è¯¥é˜¶æ®µä½¿ç”¨é»˜è®¤çš„é€šç”¨è¡Œä¸º,ä¸éœ€è¦ç‰¹æ®ŠæŒ‡å¯¼ã€‚è¿™æ˜¯æ¸è¿›å¼è®¾è®¡çš„ä½“ç°:
- åˆæœŸåªä¸ºæ˜ç¡®éœ€è¦ç‰¹æ®Šå¤„ç†çš„åœºæ™¯æ·»åŠ æŒ‡å¯¼
- éšç€ä¸šåŠ¡å‘å±•,é€æ­¥å®Œå–„å…¶ä»–åœºæ™¯çš„æŒ‡å¯¼

### Q2: åœºæ™¯åŒ¹é…å¤±è´¥ä¼šæ€æ ·?

**A**: åœºæ™¯åŒ¹é…å¤±è´¥æ—¶ä¼šè¿”å› `SceneType::General`,ä½¿ç”¨é€šç”¨çš„æç¤ºè¯æ¨¡æ¿,ä¸ä¼šæŠ¥é”™æˆ–ä¸­æ–­æ‰§è¡Œã€‚

### Q3: å¦‚ä½•è°ƒè¯•åœºæ™¯åŒ¹é…é€»è¾‘?

**A**: åœ¨ `SceneManager::match_scene()` å’Œå„ä¸ª `get_*_guidance()` æ–¹æ³•ä¸­å·²ç»æ·»åŠ äº† `eprintln!` è°ƒè¯•è¾“å‡º:

```rust
eprintln!("ğŸ” DEBUG: task_type = {:?}", task_type);
eprintln!("ğŸ” DEBUG: matched scene = {:?}", scene_type);
eprintln!("ğŸ” DEBUG: guidance length = {}", guidance.len());
```

æŸ¥çœ‹æ—¥å¿—å³å¯äº†è§£åŒ¹é…è¿‡ç¨‹ã€‚

### Q4: åœºæ™¯æŒ‡å¯¼çš„ä¼˜å…ˆçº§æ˜¯ä»€ä¹ˆ?

**A**: åœ¨ç”¨æˆ·æç¤ºè¯ä¸­,åœºæ™¯æŒ‡å¯¼çš„ä½ç½®å†³å®šäº†ä¼˜å…ˆçº§:

```
è§„åˆ’/è¯„ä¼°/åæ€/é‡æ–°è§„åˆ’é˜¶æ®µç”¨æˆ·æç¤ºè¯:
1. ä»»åŠ¡æè¿°/æ‰§è¡Œç»“æœ
2. å¯ç”¨å·¥å…·/å…ƒæ•°æ®
3. ä¸Šä¸‹æ–‡ä¿¡æ¯
4. â­â­â­ ã€åœºæ™¯ä¸“å±æŒ‡å¯¼ - æœ€é«˜ä¼˜å…ˆçº§ã€‘â­â­â­  â† è¿™é‡Œ
5. é€šç”¨è¦æ±‚
6. ç¤ºä¾‹
```

LLMä¼šæŒ‰ç…§ä»ä¸Šåˆ°ä¸‹çš„é¡ºåºç†è§£æç¤ºè¯,è¶Šé åçš„å†…å®¹è¶Šæ–°é²œ,å¯¹LLMçš„å½±å“è¶Šå¤§ã€‚å› æ­¤åœºæ™¯æŒ‡å¯¼è¢«æ”¾åœ¨é€šç”¨è¦æ±‚ä¹‹å‰,ç¡®ä¿ä¼˜å…ˆæ‰§è¡Œã€‚

### Q5: èƒ½å¦åœ¨è¿è¡Œæ—¶åŠ¨æ€ä¿®æ”¹åœºæ™¯æŒ‡å¯¼?

**A**: ä¸èƒ½ã€‚å½“å‰è®¾è®¡ä½¿ç”¨é™æ€å­—ç¬¦ä¸²å¸¸é‡ (`&'static str`),ç¼–è¯‘æ—¶ç¡®å®šã€‚å¦‚æœéœ€è¦è¿è¡Œæ—¶åŠ¨æ€è°ƒæ•´,éœ€è¦é‡æ„ä¸º:

```rust
pub struct SceneGuidance {
    pub selection_guidance: String,
    pub planning_guidance: String,
    pub evaluation_guidance: String,
    pub reflection_guidance: String,
    pub replanning_guidance: String,
    pub message_guidance: String,
}
```

ä½†è¿™ä¼šå¢åŠ è¿è¡Œæ—¶å¼€é”€å’Œå¤æ‚åº¦,ä¸æ¨èã€‚

### Q6: å¦‚ä½•ç¡®ä¿æ„å›¾æ ‡è®°ä¸è¢«è¯¯è§£?

**A**: ç³»ç»Ÿä¼šä¸¥æ ¼æå–æ„å›¾æ ‡è®°:
1. åªè¯†åˆ«å›ºå®šæ ¼å¼: `æ„å›¾:` / `Intent:`
2. æå–åˆ°ç¬¬ä¸€ä¸ªåˆ†éš”ç¬¦(`,` / `\n`)ä¹‹å‰çš„å†…å®¹
3. å»é™¤é¦–å°¾ç©ºæ ¼åè¿”å›

å»ºè®®åœ¨å‰ç«¯æˆ–è°ƒç”¨æ–¹ç»Ÿä¸€è§„èŒƒæ„å›¾æ ‡è®°æ ¼å¼ã€‚

### Q7: åœºæ™¯æŒ‡å¯¼å†…å®¹å¯ä»¥æœ‰å¤šé•¿?

**A**: æŠ€æœ¯ä¸Šæ²¡æœ‰é™åˆ¶,ä½†å»ºè®®:
- ç­›é€‰æŒ‡å¯¼: â‰¤ 300 tokens
- è§„åˆ’æŒ‡å¯¼: â‰¤ 500 tokens
- è¯„ä¼°æŒ‡å¯¼: â‰¤ 300 tokens
- åæ€æŒ‡å¯¼: â‰¤ 300 tokens
- é‡æ–°è§„åˆ’æŒ‡å¯¼: â‰¤ 300 tokens
- æ¶ˆæ¯ç”ŸæˆæŒ‡å¯¼: â‰¤ 200 tokens

è¿‡é•¿çš„æŒ‡å¯¼ä¼š:
1. å¢åŠ LLMè°ƒç”¨æˆæœ¬
2. å¯èƒ½æ·¹æ²¡å…¶ä»–é‡è¦ä¿¡æ¯
3. é™ä½LLMçš„æ‰§è¡Œç²¾åº¦

### Q8: å…­ä¸ªé˜¶æ®µçš„åœºæ™¯æŒ‡å¯¼æ˜¯å¦å¿…é¡»éƒ½æä¾›?

**A**: ä¸æ˜¯å¿…é¡»çš„ã€‚å¯ä»¥åªä¸ºæŸäº›é˜¶æ®µæä¾›åœºæ™¯æŒ‡å¯¼,å…¶ä»–é˜¶æ®µç•™ç©ºå­—ç¬¦ä¸²å³å¯ã€‚ç³»ç»Ÿä¼šè‡ªåŠ¨ä½¿ç”¨åŸºç¡€æ¨¡æ¿çš„é€šç”¨è¡Œä¸ºã€‚å»ºè®®ä¼˜å…ˆä¸ºæœ€å…³é”®çš„é˜¶æ®µæ·»åŠ æŒ‡å¯¼ã€‚

---

## é™„å½•A: å®Œæ•´çš„è°ƒç”¨é“¾è·¯å›¾

```
ç”¨æˆ·ä»»åŠ¡æäº¤
     â”‚
     â”œâ”€> Orchestrator::orchestrate_with_id_and_metadata()
     â”‚   â””â”€> æå–æ„å›¾(å¦‚æœ‰)
     â”‚
     â”œâ”€> Planner::plan()
     â”‚   â”œâ”€> (å¯é€‰)å·¥å…·ç­›é€‰é˜¶æ®µ
     â”‚   â”‚   â””â”€> LLMè¿”å› task_type
     â”‚   â”‚
     â”‚   â””â”€> PlanningPromptBuilder::build_enhanced_planning_prompt()
     â”‚       â”œâ”€> SceneManager::get_planning_guidance(task_type)
     â”‚       â”‚   â”œâ”€> match_scene(task_type)
     â”‚       â”‚   â”‚   â”œâ”€> 1. ç²¾ç¡®åŒ¹é…åˆ«å
     â”‚       â”‚   â”‚   â”œâ”€> 2. æ¨¡ç³ŠåŒ¹é…å…³é”®è¯
     â”‚       â”‚   â”‚   â””â”€> 3. è¿”å› General
     â”‚       â”‚   â”‚
     â”‚       â”‚   â””â”€> get_scene_guidance(scene_type).planning_guidance
     â”‚       â”‚
     â”‚       â””â”€> ç»„è£…ç”¨æˆ·æç¤ºè¯
     â”‚           â””â”€> æ›¿æ¢ {scene_guidance}
     â”‚
     â”œâ”€> Executor::execute()
     â”‚   â””â”€> å¹¶è¡Œæ‰§è¡Œå„æ­¥éª¤
     â”‚
     â”œâ”€> Evaluator::evaluate()
     â”‚   â””â”€> LLMè¯„ä¼°æ‰§è¡Œç»“æœ
     â”‚
     â”œâ”€> (å¦‚å¤±è´¥)Reflector::reflect()
     â”‚   â””â”€> ReflectionPromptBuilder::build_reflection_prompt()
     â”‚       â””â”€> SceneManager::get_reflection_guidance(task_type)
     â”‚           â””â”€> åŒè§„åˆ’é˜¶æ®µçš„åŒ¹é…é€»è¾‘
     â”‚
     â””â”€> (å¦‚éœ€é‡æ–°è§„åˆ’)Planner::replan()
         â””â”€> ReplanningPromptBuilder::build_replanning_prompt()
             â””â”€> SceneManager::get_replanning_guidance(task_type)
                 â””â”€> åŒè§„åˆ’é˜¶æ®µçš„åŒ¹é…é€»è¾‘
```

---

## é™„å½•B: å…³é”®æ–‡ä»¶ç´¢å¼•

| æ–‡ä»¶è·¯å¾„ | è¡Œå·èŒƒå›´ | åŠŸèƒ½è¯´æ˜ |
|---------|---------|---------|
| `src/llm/scene_guidance.rs` | 10-86 | `SceneType` æšä¸¾å®šä¹‰ |
| `src/llm/scene_guidance.rs` | 91-105 | `SceneGuidance` ç»“æ„å®šä¹‰(6ä¸ªé˜¶æ®µ) |
| `src/llm/scene_guidance.rs` | 110-214 | å„åœºæ™¯æŒ‡å¯¼å†…å®¹å¸¸é‡å®šä¹‰ |
| `src/llm/scene_guidance.rs` | 218-382 | `SceneManager` å®ç° |
| `src/llm/selection_prompts.rs` | 16-168 | å·¥å…·ç­›é€‰é˜¶æ®µåŸºç¡€æ¨¡æ¿ |
| `src/llm/selection_prompts.rs` | 170-279 | `SelectionPromptBuilder` å®ç° |
| `src/llm/planning_prompts.rs` | 33-200 | è§„åˆ’é˜¶æ®µåŸºç¡€æ¨¡æ¿ |
| `src/llm/planning_prompts.rs` | 352-560 | `PlanningPromptBuilder` å®ç° |
| `src/llm/evaluation_prompts.rs` | 16-161 | è¯„ä¼°é˜¶æ®µåŸºç¡€æ¨¡æ¿ |
| `src/llm/evaluation_prompts.rs` | 163-208 | `EvaluationPromptBuilder` å®ç° |
| `src/llm/reflection_prompts.rs` | 80-154 | åæ€é˜¶æ®µåŸºç¡€æ¨¡æ¿ |
| `src/llm/reflection_prompts.rs` | 160-240 | `ReflectionPromptBuilder` å®ç° |
| `src/llm/replanning_prompts.rs` | 83-190 | é‡æ–°è§„åˆ’åŸºç¡€æ¨¡æ¿ |
| `src/llm/replanning_prompts.rs` | 206-300 | `ReplanningPromptBuilder` å®ç° |
| `src/llm/message_templates.rs` | 16-302 | ç”¨æˆ·æ¶ˆæ¯ç”Ÿæˆæ¨¡æ¿ |
| `src/llm/message_templates.rs` | 304-463 | `MessageTemplateBuilder` å®ç° |
| `src/core/planner.rs` | 53-87 | `extract_intent_from_task()` æ„å›¾æå– |
| `src/core/orchestrator.rs` | 1-300 | ç¼–æ’å™¨ä¸»æµç¨‹ |

---

## é™„å½•C: å˜æ›´å†å²

| æ—¥æœŸ | ç‰ˆæœ¬ | å˜æ›´å†…å®¹ |
|------|------|---------|
| 2025-12-29 | v1.0 | åˆå§‹ç‰ˆæœ¬,è®°å½•è¯­ä¹‰è·¯ç”±æœºåˆ¶ä¸åœºæ™¯æ„ŸçŸ¥æç¤ºè¯ç³»ç»Ÿçš„å®Œæ•´è®¾è®¡ |
| 2025-12-30 | v2.0 | é‡å¤§æ›´æ–°:<br>1. æ–°å¢å·¥å…·ç­›é€‰(Selection)ã€è¯„ä¼°(Evaluation)ã€æ¶ˆæ¯ç”Ÿæˆ(Message)ä¸‰ä¸ªé˜¶æ®µ<br>2. `SceneGuidance`ä»3ä¸ªé˜¶æ®µæ‰©å±•ä¸º6ä¸ªé˜¶æ®µ<br>3. æ–°å¢`selection_prompts.rs`ã€`evaluation_prompts.rs`ã€`message_templates.rs`æ¨¡å—<br>4. æ›´æ–°æ–‡æ¡£ç»“æ„,æ–°å¢ç¬¬6ç« "å„é˜¶æ®µæç¤ºè¯è¯¦è§£"å’Œç¬¬7ç« "åœºæ™¯ä¸“å±æŒ‡å¯¼å†…å®¹"<br>5. æ›´æ–°æ‰€æœ‰åœºæ™¯æŒ‡å¯¼å†…å®¹,åŒ…å«6ä¸ªé˜¶æ®µçš„å®Œæ•´å®šä¹‰<br>6. æ›´æ–°å…³é”®æ–‡ä»¶ç´¢å¼•,åŒ…å«æ‰€æœ‰æ–°å¢æ¨¡å— |

---

**æ–‡æ¡£ç»´æŠ¤è€…**: ç³»ç»Ÿæ¶æ„å›¢é˜Ÿ
**æœ€åæ›´æ–°**: 2025-12-30
**ä¸‹æ¬¡å®¡æŸ¥**: å»ºè®®æ¯æ¬¡æ–°å¢åœºæ™¯æˆ–ä¿®æ”¹æ ¸å¿ƒé€»è¾‘åæ›´æ–°æœ¬æ–‡æ¡£

---

## é™„å½•D: v2.0ç‰ˆæœ¬é‡è¦å˜æ›´è¯´æ˜

### æ–°å¢çš„ä¸‰ä¸ªé˜¶æ®µ

1. **å·¥å…·ç­›é€‰é˜¶æ®µ (Selection Phase)**
   - æ¨¡å—: `src/llm/selection_prompts.rs`
   - åŠŸèƒ½: ä»å¤§é‡å·¥å…·ä¸­å¿«é€Ÿç­›é€‰ç›¸å…³å·¥å…·å­é›†
   - ç‰¹æ€§: æ„å›¾è¯†åˆ«æœ€é«˜ä¼˜å…ˆçº§ã€åŠ¨æ€é˜ˆå€¼æŒ‡å¯¼ã€æ‹’ç»æ¨¡ç³Šä»»åŠ¡

2. **æ‰§è¡Œè¯„ä¼°é˜¶æ®µ (Evaluation Phase)**
   - æ¨¡å—: `src/llm/evaluation_prompts.rs`
   - åŠŸèƒ½: è¯„ä¼°ä»»åŠ¡æ‰§è¡Œè´¨é‡,ç”Ÿæˆå››ç»´åº¦è¯„åˆ†
   - ç‰¹æ€§: é€æ­¥è¯„ä¼°ã€æˆåŠŸ/å¤±è´¥åˆ†æã€æ”¹è¿›å»ºè®®

3. **ç”¨æˆ·æ¶ˆæ¯ç”Ÿæˆé˜¶æ®µ (Message Generation Phase)**
   - æ¨¡å—: `src/llm/message_templates.rs`
   - åŠŸèƒ½: å°†æŠ€æœ¯æ€§è¾“å‡ºè½¬æ¢ä¸ºç”¨æˆ·å‹å¥½æ¶ˆæ¯
   - ç‰¹æ€§: é£æ ¼è½¬æ¢ã€è¿›åº¦æŠ¥å‘Šã€è¯„ä¼°ç»“æœå‘ˆç°

### åœºæ™¯æŒ‡å¯¼ç»“æ„å˜åŒ–

**v1.0**: 3ä¸ªé˜¶æ®µ
```rust
pub struct SceneGuidance {
    pub planning_guidance: &'static str,
    pub reflection_guidance: &'static str,
    pub replanning_guidance: &'static str,
}
```

**v2.0**: 6ä¸ªé˜¶æ®µ
```rust
pub struct SceneGuidance {
    pub selection_guidance: &'static str,
    pub planning_guidance: &'static str,
    pub evaluation_guidance: &'static str,
    pub reflection_guidance: &'static str,
    pub replanning_guidance: &'static str,
    pub message_guidance: &'static str,
}
```

### è¿ç§»æŒ‡å—(v1.0 â†’ v2.0)

å¦‚æœæ‚¨åŸºäºv1.0æ–‡æ¡£å®ç°äº†è‡ªå®šä¹‰åœºæ™¯,éœ€è¦è¿›è¡Œä»¥ä¸‹è°ƒæ•´:

1. **æ›´æ–°åœºæ™¯æŒ‡å¯¼å¸¸é‡å®šä¹‰**
   ```rust
   // åœ¨åŸæœ‰3ä¸ªé˜¶æ®µåŸºç¡€ä¸Š,æ–°å¢3ä¸ªé˜¶æ®µçš„æŒ‡å¯¼
   const YOUR_SCENE_GUIDANCE: SceneGuidance = SceneGuidance {
       selection_guidance: r#""#,      // æ–°å¢
       planning_guidance: r#"..."#,    // ä¿æŒåŸæœ‰
       evaluation_guidance: r#""#,     // æ–°å¢
       reflection_guidance: r#"..."#,  // ä¿æŒåŸæœ‰
       replanning_guidance: r#"..."#,  // ä¿æŒåŸæœ‰
       message_guidance: r#""#,        // æ–°å¢
   };
   ```

2. **æ›´æ–°å•å…ƒæµ‹è¯•**
   - ä¸ºæ–°å¢çš„3ä¸ªé˜¶æ®µæ·»åŠ æµ‹è¯•ç”¨ä¾‹
   - éªŒè¯`get_selection_guidance()`ã€`get_evaluation_guidance()`ã€`get_message_guidance()`æ–¹æ³•

3. **å…¼å®¹æ€§è¯´æ˜**
   - æ–°å¢çš„3ä¸ªé˜¶æ®µæŒ‡å¯¼å¯ä»¥ç•™ç©ºå­—ç¬¦ä¸²,ä¸å½±å“åŸæœ‰åŠŸèƒ½
   - å»ºè®®ä¼˜å…ˆä¸ºå·¥å…·ç­›é€‰å’Œè¯„ä¼°é˜¶æ®µæ·»åŠ åœºæ™¯æŒ‡å¯¼,æå‡ç³»ç»Ÿæ™ºèƒ½åŒ–æ°´å¹³
