# ä»»åŠ¡åè¯„ä¼°åŠŸèƒ½å®ç°è¯¦è§£

## æ–‡æ¡£æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†è®°å½•äº†ä»»åŠ¡ç¼–æ’æœåŠ¡ä¸­**ä»»åŠ¡åè¯„ä¼°ï¼ˆPost-Task Evaluationï¼‰**åŠŸèƒ½çš„å®ç°æ€è·¯ã€æ¶æ„è®¾è®¡ã€ä»£ç æ˜ å°„ä»¥åŠå…³é”®å®ç°ç»†èŠ‚ã€‚è¯¥åŠŸèƒ½åœ¨ä»»åŠ¡æ‰§è¡Œå®Œæˆåå¯¹æ•´ä¸ªä»»åŠ¡è¿›è¡Œå…¨å±€æ€§çš„ç»éªŒæç‚¼å’Œè¯„ä¼°ï¼Œç”¨äºç§¯ç´¯å¯å¤ç”¨çš„æ‰§è¡Œç»éªŒï¼Œä¼˜åŒ–åç»­ä»»åŠ¡çš„æ‰§è¡Œç­–ç•¥ã€‚

---

## 1. åŠŸèƒ½æ¦‚è¿°

### 1.1 åŠŸèƒ½å®šä½

ä»»åŠ¡åè¯„ä¼°æ˜¯ä¸€ä¸ª**å¼‚æ­¥ã€éé˜»å¡çš„ç»éªŒç§¯ç´¯æ¨¡å—**ï¼Œåœ¨ä»»åŠ¡å®Œæˆåå¯¹æ•´ä¸ªä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹è¿›è¡Œæ·±åº¦åˆ†æï¼Œç›®çš„æ˜¯ï¼š

1. **ç»éªŒæç‚¼**ï¼šä»å·²å®Œæˆä»»åŠ¡ä¸­æå–å¯å¤ç”¨çš„æˆåŠŸæ¨¡å¼å’Œå¤±è´¥æ•™è®­
2. **è´¨é‡è¯„ä¼°**ï¼šå¤šç»´åº¦è¯„ä¼°ä»»åŠ¡æ‰§è¡Œçš„å®Œæˆåº¦ã€åˆ†è§£è´¨é‡ã€å·¥å…·é€‰æ‹©ç­‰
3. **æŒç»­ä¼˜åŒ–**ï¼šä¸ºåç»­ç±»ä¼¼ä»»åŠ¡æä¾›å‚è€ƒï¼ŒæŒ‡å¯¼ç³»ç»Ÿæ”¹è¿›
4. **çŸ¥è¯†æ²‰æ·€**ï¼šå°†éšæ€§çš„æ‰§è¡Œç»éªŒè½¬åŒ–ä¸ºæ˜¾æ€§çš„çŸ¥è¯†åº“

### 1.2 è§¦å‘æ—¶æœº

ä»»åŠ¡åè¯„ä¼°åœ¨ä»¥ä¸‹æ—¶æœºè§¦å‘ï¼š

- âœ… **ä»»åŠ¡æˆåŠŸå®Œæˆæ—¶**ï¼šåœ¨ `generate_final_output` æ–¹æ³•ä¸­
- âœ… **ä»»åŠ¡å¤±è´¥æ—¶ä¹Ÿè§¦å‘**ï¼šä»å¤±è´¥ä¸­å­¦ä¹ ç»éªŒæ•™è®­ï¼ˆv1.1 æ–°å¢ï¼‰
- ğŸ›ï¸ **å¯é…ç½®å¼€å…³**ï¼šé€šè¿‡ `config.dev.toml` çš„ `debug.enable_post_task_evaluation` æ§åˆ¶

**é‡è¦è¯´æ˜**ï¼šä» v1.1 ç‰ˆæœ¬å¼€å§‹ï¼Œå¤±è´¥ä»»åŠ¡ä¹Ÿä¼šè¿›è¡Œåè¯„ä¼°ï¼Œè¿™æ ·å¯ä»¥ï¼š
- ğŸ” åˆ†æå¤±è´¥çš„æ ¹æœ¬åŸå› 
- ğŸ“š ç§¯ç´¯å¤±è´¥æ•™è®­åº“
- ğŸ›¡ï¸ é¿å…é‡å¤ç›¸åŒçš„é”™è¯¯
- ğŸ’¡ ä¸ºç³»ç»Ÿæ”¹è¿›æä¾›æ–¹å‘

### 1.3 æ ¸å¿ƒç‰¹æ€§

| ç‰¹æ€§ | æè¿° |
|-----|------|
| **å¼‚æ­¥éé˜»å¡** | ä½¿ç”¨ `tokio::spawn` åœ¨åå°æ‰§è¡Œï¼Œä¸å½±å“ä»»åŠ¡è¿”å› |
| **JSONL æ ¼å¼** | è¯„ä¼°ç»“æœä»¥ JSONL æ ¼å¼è¿½åŠ å†™å…¥æ–‡ä»¶ï¼Œä¾¿äºæ‰¹é‡åˆ†æ |
| **å¤šç»´åº¦è¯„ä¼°** | ä» 5 ä¸ªç»´åº¦è¯„ä¼°ä»»åŠ¡è´¨é‡ï¼ˆè¯¦è§è¯„ä¼°ç»´åº¦ç« èŠ‚ï¼‰ |
| **ç»“æ„åŒ–è¾“å‡º** | ä½¿ç”¨ JSON Schema è§„èŒƒ LLM è¾“å‡ºï¼Œç¡®ä¿æ•°æ®å¯è§£æ |
| **å®¹é”™è®¾è®¡** | è¯„ä¼°å¤±è´¥ä¸å½±å“ä»»åŠ¡ç»“æœï¼Œæä¾›é»˜è®¤å€¼å…œåº• |

---

## 2. æ¶æ„è®¾è®¡

### 2.1 æ¨¡å—ç»„æˆ

ä»»åŠ¡åè¯„ä¼°åŠŸèƒ½ç”±ä»¥ä¸‹æ ¸å¿ƒæ¨¡å—ç»„æˆï¼š

```
src/
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ orchestrator.rs           # ä¸»ç¼–æ’å™¨ï¼Œè´Ÿè´£è§¦å‘è¯„ä¼°
â”‚   â””â”€â”€ post_task_evaluator.rs    # ä»»åŠ¡åè¯„ä¼°å™¨ï¼ˆæ ¸å¿ƒé€»è¾‘ï¼‰
â”œâ”€â”€ llm/
â”‚   â”œâ”€â”€ mod.rs                     # LLM æ¨¡å—å…¥å£
â”‚   â””â”€â”€ post_task_evaluation_prompts.rs  # æç¤ºè¯ä¸æ•°æ®ç»“æ„
â””â”€â”€ config/
    â””â”€â”€ mod.rs                     # é…ç½®åŠ è½½
```

### 2.2 æ•°æ®æµå‘

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. Orchestrator.generate_final_output()                    â”‚
â”‚     â””â”€ æ£€æŸ¥é…ç½®ï¼šenable_post_task_evaluation = true         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. tokio::spawn (å¼‚æ­¥ä»»åŠ¡)                                  â”‚
â”‚     â””â”€ PostTaskEvaluator.evaluate_completed_task()          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. æ”¶é›†ä»»åŠ¡æ‰§è¡Œæ•°æ®                                          â”‚
â”‚     â”œâ”€ æ‰§è¡Œå†å²ï¼ˆformat_execution_historyï¼‰                  â”‚
â”‚     â”œâ”€ è½®æ¬¡ç»Ÿè®¡ï¼ˆformat_round_statisticsï¼‰                   â”‚
â”‚     â””â”€ å…³é”®äº‹ä»¶ï¼ˆextract_key_eventsï¼‰                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. æ„å»ºæç¤ºè¯                                                â”‚
â”‚     â””â”€ PostTaskEvaluationPromptBuilder.build_prompt()       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. è°ƒç”¨ LLM è¿›è¡Œè¯„ä¼°                                         â”‚
â”‚     â””â”€ UnifiedLlmClient.call()                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  6. è§£æ LLM å“åº”                                             â”‚
â”‚     â””â”€ parse_evaluation_response()                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  7. ä¿å­˜è¯„ä¼°ç»“æœ                                              â”‚
â”‚     â””â”€ å†™å…¥ post_task_evaluations.jsonl (JSONL æ ¼å¼)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. æ ¸å¿ƒä»£ç æ˜ å°„

### 3.1 è§¦å‘å…¥å£

#### 3.1.1 æˆåŠŸä»»åŠ¡è§¦å‘å…¥å£

**æ–‡ä»¶**: [src/core/orchestrator.rs](src/core/orchestrator.rs#L2989-L3090)

```rust
fn generate_final_output(&self, task: &Task) -> Result<String> {
    // ... ç”Ÿæˆä»»åŠ¡è¾“å‡º ...

    // ğŸ¯ ã€å…³é”®ã€‘æ£€æŸ¥é…ç½®æ˜¯å¦å¯ç”¨ä»»åŠ¡åè¯„ä¼°
    if self.app_config.debug.enable_post_task_evaluation {
        let task_clone = task.clone();
        let post_task_evaluator = Arc::clone(&self.post_task_evaluator);
        let evaluation_file = self.app_config.debug.post_task_evaluation_file.clone();
        let task_id = task.task_id.clone();

        // ğŸš€ åœ¨åå°å¼‚æ­¥æ‰§è¡Œä»»åŠ¡åè¯„ä¼°ï¼Œä¸é˜»å¡ä¸»æµç¨‹
        tokio::spawn(async move {
            match post_task_evaluator.evaluate_completed_task(&task_clone).await {
                Ok(evaluation) => {
                    // åºåˆ—åŒ–ä¸º JSONL æ ¼å¼ï¼ˆæ¯è¡Œä¸€ä¸ª JSON å¯¹è±¡ï¼‰
                    let json_line = serde_json::to_string(&evaluation)?;

                    // è¿½åŠ å†™å…¥æ–‡ä»¶
                    let mut file = OpenOptions::new()
                        .create(true)
                        .append(true)
                        .open(&evaluation_file)
                        .await?;

                    file.write_all(json_line.as_bytes()).await?;
                    file.write_all(b"\n").await?;
                    file.flush().await?;
                }
                Err(e) => error!("ä»»åŠ¡åè¯„ä¼°å¤±è´¥: {:?}", e),
            }
        });
    }

    // è¿”å›ä»»åŠ¡è¾“å‡º
    Ok(/* ... */)
}
```

**å…³é”®è®¾è®¡ç‚¹**ï¼š
- âœ… ä½¿ç”¨ `tokio::spawn` ç¡®ä¿å¼‚æ­¥éé˜»å¡
- âœ… å…‹éš†æ‰€éœ€æ•°æ®é¿å…å€Ÿç”¨å†²çª
- âœ… é”™è¯¯ä¸å½±å“ä»»åŠ¡ç»“æœï¼Œä»…è®°å½•æ—¥å¿—

---

#### 3.1.2 å¤±è´¥ä»»åŠ¡è§¦å‘å…¥å£ï¼ˆv1.1 æ–°å¢ï¼‰

**æ–‡ä»¶**: [src/core/orchestrator.rs](src/core/orchestrator.rs#L757-L862)

```rust
Err(e) => {
    task.fail(e.to_string());
    self.state_manager.update_task(task.clone());

    // è®°å½•é”™è¯¯åˆ° Kafka
    let mut fields = HashMap::new();
    fields.insert("task_id".to_string(), task.task_id.clone());
    fields.insert("error".to_string(), e.to_string());
    let _ = self.kafka_logger.error("orchestrator", "ä»»åŠ¡æ‰§è¡Œå¤±è´¥", fields).await;

    // ğŸ¯ ã€æ–°å¢ã€‘å¯¹å¤±è´¥ä»»åŠ¡ä¹Ÿè¿›è¡Œä»»åŠ¡åè¯„ä¼°ï¼ˆä»å¤±è´¥ä¸­å­¦ä¹ ï¼‰
    if self.app_config.debug.enable_post_task_evaluation {
        info!(
            task_id = task.task_id,
            "ä»»åŠ¡å¤±è´¥ï¼Œå¯ç”¨ä»»åŠ¡åè¯„ä¼°ä»¥åˆ†æå¤±è´¥åŸå› "
        );

        // å…‹éš†å¿…è¦æ•°æ®ä»¥ä¾›å¼‚æ­¥ä»»åŠ¡ä½¿ç”¨
        let task_clone = task.clone();
        let post_task_evaluator = Arc::clone(&self.post_task_evaluator);
        let evaluation_file = self.app_config.debug.post_task_evaluation_file.clone();
        let task_id_clone = task.task_id.clone();

        // åœ¨åå°å¼‚æ­¥æ‰§è¡Œä»»åŠ¡åè¯„ä¼°ï¼Œä¸é˜»å¡ä¸»æµç¨‹
        tokio::spawn(async move {
            match post_task_evaluator.evaluate_completed_task(&task_clone).await {
                Ok(evaluation) => {
                    info!(
                        task_id = %task_id_clone,
                        overall_score = evaluation.overall_score,
                        "å¤±è´¥ä»»åŠ¡åè¯„ä¼°å®Œæˆï¼Œå¼€å§‹ä¿å­˜åˆ°æ–‡ä»¶"
                    );

                    // åºåˆ—åŒ–ä¸º JSONL æ ¼å¼ï¼ˆæ¯è¡Œä¸€ä¸ª JSON å¯¹è±¡ï¼‰
                    match serde_json::to_string(&evaluation) {
                        Ok(json_line) => {
                            // è¿½åŠ å†™å…¥æ–‡ä»¶
                            use tokio::io::AsyncWriteExt;
                            match tokio::fs::OpenOptions::new()
                                .create(true)
                                .append(true)
                                .open(&evaluation_file)
                                .await
                            {
                                Ok(mut file) => {
                                    let _ = file.write_all(json_line.as_bytes()).await;
                                    let _ = file.write_all(b"\n").await;
                                    let _ = file.flush().await;
                                    info!(
                                        task_id = %task_id_clone,
                                        "å¤±è´¥ä»»åŠ¡åè¯„ä¼°ç»“æœå·²ä¿å­˜åˆ°æ–‡ä»¶"
                                    );
                                }
                                Err(e) => {
                                    error!(
                                        task_id = %task_id_clone,
                                        error = %e,
                                        "æ‰“å¼€å¤±è´¥ä»»åŠ¡åè¯„ä¼°ç»“æœæ–‡ä»¶å¤±è´¥"
                                    );
                                }
                            }
                        }
                        Err(e) => {
                            error!(
                                task_id = %task_id_clone,
                                error = %e,
                                "åºåˆ—åŒ–å¤±è´¥ä»»åŠ¡åè¯„ä¼°ç»“æœå¤±è´¥"
                            );
                        }
                    }
                }
                Err(e) => {
                    error!(
                        task_id = %task_id_clone,
                        error = %e,
                        "å¤±è´¥ä»»åŠ¡åè¯„ä¼°å¤±è´¥"
                    );
                }
            }
        });
    }

    // å‘é€ä¸Šä¸‹æ–‡å·¥ç¨‹äº‹ä»¶ï¼ˆå³ä½¿ä»»åŠ¡å¤±è´¥ä¹Ÿè¦å‘é€ï¼‰
    // ...
}
```

**å¤±è´¥ä»»åŠ¡è¯„ä¼°çš„è®¾è®¡äº®ç‚¹**ï¼š
- ğŸ” **ä»å¤±è´¥ä¸­å­¦ä¹ **ï¼šå³ä½¿ä»»åŠ¡å¤±è´¥ä¹Ÿèƒ½ç§¯ç´¯ç»éªŒ
- ğŸ“Š **å¤±è´¥åŸå› åˆ†æ**ï¼šLLM ä¼šåˆ†æå¤±è´¥çš„æ ¹æœ¬åŸå› 
- ğŸ’¡ **é¿å…é‡å¤é”™è¯¯**ï¼šå°†å¤±è´¥æ•™è®­è®°å½•åˆ°çŸ¥è¯†åº“
- ğŸ›¡ï¸ **ä¸å½±å“é”™è¯¯å¤„ç†**ï¼šå¼‚æ­¥æ‰§è¡Œï¼Œä¸å¹²æ‰°é”™è¯¯è¿”å›æµç¨‹

---

### 3.2 è¯„ä¼°å™¨æ ¸å¿ƒé€»è¾‘

**æ–‡ä»¶**: [src/core/post_task_evaluator.rs](src/core/post_task_evaluator.rs#L26-L112)

```rust
pub async fn evaluate_completed_task(&self, task: &Task) -> Result<PostTaskEvaluation> {
    // 1ï¸âƒ£ æ”¶é›†æ‰§è¡Œå†å²
    let execution_history = self.format_execution_history(task);

    // 2ï¸âƒ£ ç”Ÿæˆè½®æ¬¡ç»Ÿè®¡
    let round_statistics = self.format_round_statistics(task);

    // 3ï¸âƒ£ æå–å…³é”®äº‹ä»¶
    let key_events = self.extract_key_events(task);

    // 4ï¸âƒ£ è·å–ä»»åŠ¡ç±»å‹
    let task_type = task.metadata.get("task_type").map(|s| s.as_str());

    // 5ï¸âƒ£ è·å–ä»»åŠ¡ä¸Šä¸‹æ–‡
    let task_context = task.context.as_ref().map(|ctx| {
        ctx.additional_info
            .iter()
            .map(|(k, v)| format!("{}: {}", k, v))
            .collect::<Vec<_>>()
            .join("\n")
    });

    // 6ï¸âƒ£ æ„å»ºæç¤ºè¯
    let (system_prompt, user_prompt) = PostTaskEvaluationPromptBuilder::build_prompt(
        &task.task_id,
        &task.description,
        task_type,
        task_context.as_deref(),
        &execution_history,
        task.current_round,
        &format!("{:?}", task.status),
        &round_statistics,
        &key_events,
    );

    // 7ï¸âƒ£ è°ƒç”¨ LLM è¿›è¡Œè¯„ä¼°
    let llm_response = self
        .llm_client
        .call(&system_prompt, &user_prompt, None)
        .await?;

    // 8ï¸âƒ£ è§£æè¯„ä¼°ç»“æœ
    let evaluation = self.parse_evaluation_response(&llm_response, &task.task_id)?;

    Ok(evaluation)
}
```

---

### 3.3 æ•°æ®æ”¶é›†æ–¹æ³•

#### 3.3.1 æ‰§è¡Œå†å²æ ¼å¼åŒ–

**æ–¹æ³•**: [format_execution_history](src/core/post_task_evaluator.rs#L114-L164)

```rust
fn format_execution_history(&self, task: &Task) -> String {
    let mut history = String::new();

    for (round_idx, round) in task.reflection_rounds.iter().enumerate() {
        history.push_str(&format!("\nã€ç¬¬ {} è½®ã€‘\n", round_idx + 1));
        history.push_str(&format!("è¯„åˆ†: {}\n", round.score.unwrap_or(0.0)));

        // è®¡åˆ’
        if !round.plan.is_empty() {
            history.push_str(&format!("\nè®¡åˆ’:\n{}\n", round.plan));
        }

        // æ‰§è¡Œæ­¥éª¤
        for exec in &round.executions {
            let status = if exec.is_success { "âœ…" } else { "âŒ" };
            history.push_str(&format!(
                "  {} [{}] {} (å·¥å…·: {})\n",
                status, exec.step_id, exec.step_name, exec.tool_id
            ));
            // ... è¾“å‡ºå’Œé”™è¯¯ä¿¡æ¯ ...
        }

        // è¯„ä¼°å’Œåæ€
        // ...
    }

    history
}
```

#### 3.3.2 è½®æ¬¡ç»Ÿè®¡

**æ–¹æ³•**: [format_round_statistics](src/core/post_task_evaluator.rs#L166-L186)

```rust
fn format_round_statistics(&self, task: &Task) -> String {
    for (round_idx, round) in task.reflection_rounds.iter().enumerate() {
        let success_count = round.executions.iter().filter(|e| e.is_success).count();
        let failure_count = round.executions.iter().filter(|e| !e.is_success).count();

        stats.push_str(&format!(
            "ç¬¬ {} è½®: æ€»æ­¥éª¤ {}, æˆåŠŸ {}, å¤±è´¥ {}, è¯„åˆ† {:.1}\n",
            round_idx + 1,
            total_steps,
            success_count,
            failure_count,
            round.score.unwrap_or(0.0)
        ));
    }
}
```

#### 3.3.3 å…³é”®äº‹ä»¶æå–

**æ–¹æ³•**: [extract_key_events](src/core/post_task_evaluator.rs#L188-L236)

```rust
fn extract_key_events(&self, task: &Task) -> String {
    // ç»Ÿè®¡æ€»ä½“æƒ…å†µ
    let total_rounds = task.reflection_rounds.len();
    let mut total_steps = 0;
    let mut total_successes = 0;
    let mut total_failures = 0;

    // æå–å¤±è´¥å·¥å…·ç»Ÿè®¡
    let mut failure_tools = HashMap::new();
    for round in &task.reflection_rounds {
        for exec in &round.executions {
            if !exec.is_success {
                *failure_tools.entry(exec.tool_id.clone()).or_insert(0) += 1;
            }
        }
    }

    // æ ¼å¼åŒ–è¾“å‡º
    events.push(format!("- æ€»å…±æ‰§è¡Œ {} è½®ï¼Œ{} ä¸ªæ­¥éª¤", total_rounds, total_steps));
    events.push(format!("- æˆåŠŸæ­¥éª¤: {}ï¼Œå¤±è´¥æ­¥éª¤: {}", total_successes, total_failures));
    // ...
}
```

---

### 3.4 æç¤ºè¯å·¥ç¨‹

**æ–‡ä»¶**: [src/llm/post_task_evaluation_prompts.rs](src/llm/post_task_evaluation_prompts.rs)

#### 3.4.1 ç³»ç»Ÿæç¤ºè¯

```rust
pub const POST_TASK_EVALUATION_SYSTEM_PROMPT: &str = r#"ä½ æ˜¯ä»»åŠ¡æ‰§è¡Œç»éªŒæç‚¼ä¸“å®¶ï¼Œä¸“æ³¨äºä»å·²å®Œæˆä»»åŠ¡ä¸­æå–å¯å¤ç”¨çš„ç»éªŒå’Œæ•™è®­ã€‚

ã€æ ¸å¿ƒèŒè´£ã€‘
1. ä»å…¨å±€è§†è§’è¯„ä¼°æ•´ä¸ªä»»åŠ¡çš„æ‰§è¡Œè¿‡ç¨‹
2. è¯†åˆ«æˆåŠŸçš„å…³é”®å› ç´ å’Œå¤±è´¥çš„æ ¹æœ¬åŸå› 
3. æ€»ç»“å¯å¤ç”¨çš„æ‰§è¡Œæ¨¡å¼å’Œç­–ç•¥
4. ä¸ºåç»­ç±»ä¼¼ä»»åŠ¡æä¾›ä¼˜åŒ–å»ºè®®

ã€è¯„ä¼°ç»´åº¦ã€‘

ğŸ“Š **ä»»åŠ¡å®Œæˆåº¦**ï¼ˆ0-100åˆ†ï¼‰
- æ˜¯å¦è¾¾æˆäº†ç”¨æˆ·çš„æ ¸å¿ƒç›®æ ‡ï¼Ÿ
- æ˜¯å¦å®Œæˆäº†æ‰€æœ‰é¢„æœŸåŠŸèƒ½ï¼Ÿ
- æœ€ç»ˆç»“æœçš„è´¨é‡å¦‚ä½•ï¼Ÿ

ğŸ¯ **ä»»åŠ¡åˆ†è§£è´¨é‡**ï¼ˆ0-100åˆ†ï¼‰
- ä»»åŠ¡æ‹†è§£æ˜¯å¦åˆç†ï¼Ÿ
- æ­¥éª¤ä¹‹é—´çš„ä¾èµ–å…³ç³»æ˜¯å¦æ¸…æ™°ï¼Ÿ
- æ˜¯å¦æœ‰å†—ä½™æˆ–é—æ¼çš„æ­¥éª¤ï¼Ÿ

ğŸ”§ **å·¥å…·é€‰æ‹©é€‚é…æ€§**ï¼ˆ0-100åˆ†ï¼‰
- é€‰æ‹©çš„å·¥å…·æ˜¯å¦é€‚åˆä»»åŠ¡éœ€æ±‚ï¼Ÿ
- æ˜¯å¦å­˜åœ¨æ›´ä¼˜çš„å·¥å…·é€‰æ‹©ï¼Ÿ
- å·¥å…·ç»„åˆæ˜¯å¦é«˜æ•ˆï¼Ÿ

ğŸ’¡ **æ‰§è¡Œç­–ç•¥æœ‰æ•ˆæ€§**ï¼ˆ0-100åˆ†ï¼‰
- æ‰§è¡Œé¡ºåºæ˜¯å¦åˆç†ï¼Ÿ
- é”™è¯¯å¤„ç†æ˜¯å¦åŠæ—¶æœ‰æ•ˆï¼Ÿ
- é‡è¯•å’Œæ¢å¤ç­–ç•¥æ˜¯å¦å¾—å½“ï¼Ÿ

ğŸ”„ **è¿­ä»£ä¼˜åŒ–æ•ˆæœ**ï¼ˆ0-100åˆ†ï¼‰
- åæ€å’Œé‡æ–°è§„åˆ’æ˜¯å¦æœ‰æ•ˆï¼Ÿ
- æ¯æ¬¡è¿­ä»£æ˜¯å¦æœ‰å®è´¨æ€§æ”¹è¿›ï¼Ÿ
- å¤±è´¥æ­¥éª¤çš„å¤„ç†æ˜¯å¦åˆç†ï¼Ÿ

ã€ç»éªŒæå–é‡ç‚¹ã€‘

âœ… **æˆåŠŸæ¨¡å¼è¯†åˆ«**
- å“ªäº›åšæ³•å€¼å¾—åœ¨åç»­ä»»åŠ¡ä¸­å¤ç”¨ï¼Ÿ
- å“ªäº›å·¥å…·ç»„åˆç‰¹åˆ«æœ‰æ•ˆï¼Ÿ
- å“ªäº›æ‰§è¡Œç­–ç•¥è¡¨ç°ä¼˜å¼‚ï¼Ÿ

âŒ **å¤±è´¥æ•™è®­æ€»ç»“**
- å“ªäº›é”™è¯¯åº”è¯¥é¿å…ï¼Ÿ
- å“ªäº›å·¥å…·é€‰æ‹©ä¸å½“ï¼Ÿ
- å“ªäº›å‡è®¾è¢«è¯æ˜æ˜¯é”™è¯¯çš„ï¼Ÿ

ğŸ“ **é€šç”¨ç»éªŒå½’çº³**
- è¿™ç±»ä»»åŠ¡çš„é€šç”¨æ‰§è¡Œæ¨¡å¼æ˜¯ä»€ä¹ˆï¼Ÿ
- æœ‰å“ªäº›å¯ä»¥æ²‰æ·€çš„æœ€ä½³å®è·µï¼Ÿ
- å¯¹äºç±»ä¼¼ä»»åŠ¡æœ‰ä»€ä¹ˆå»ºè®®ï¼Ÿ

ã€è¾“å‡ºè¦æ±‚ã€‘
ä»¥ç»“æ„åŒ–çš„æ–¹å¼æ€»ç»“ä»»åŠ¡æ‰§è¡Œç»éªŒï¼Œé‡ç‚¹çªå‡ºï¼š
1. å¯æ“ä½œçš„æ”¹è¿›å»ºè®®
2. å¯å¤ç”¨çš„æˆåŠŸæ¨¡å¼
3. åº”è¯¥é¿å…çš„å¤±è´¥é™·é˜±
4. å¯¹åç»­ä»»åŠ¡çš„æŒ‡å¯¼æ„ä¹‰

è¾“å‡ºæ ¼å¼ä¸º JSONï¼ŒåŒ…å«å„ç»´åº¦è¯„åˆ†ã€å…³é”®å‘ç°ã€ç»éªŒæ€»ç»“å’Œæ”¹è¿›å»ºè®®ã€‚"#;
```

**è®¾è®¡äº®ç‚¹**ï¼š
- ğŸ¯ æ˜ç¡®è§’è‰²å®šä½ï¼š"ä»»åŠ¡æ‰§è¡Œç»éªŒæç‚¼ä¸“å®¶"
- ğŸ“Š äº”ä¸ªç»´åº¦æ¸…æ™°å¯é‡åŒ–
- âœ… åŒºåˆ†æˆåŠŸæ¨¡å¼å’Œå¤±è´¥æ•™è®­
- ğŸ“ å¼ºè°ƒé€šç”¨æ€§å’Œå¯å¤ç”¨æ€§

#### 3.4.2 ç”¨æˆ·æç¤ºè¯æ¨¡æ¿

```rust
pub const POST_TASK_EVALUATION_USER_TEMPLATE: &str = r#"
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ã€ä»»åŠ¡åŸºæœ¬ä¿¡æ¯ã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“‹ ä»»åŠ¡æè¿°ï¼š
{task_description}

ğŸ¯ ä»»åŠ¡ç±»å‹ï¼š{task_type}

â±ï¸  æ€»æ‰§è¡Œè½®æ¬¡ï¼š{total_rounds} è½®
âœ… æœ€ç»ˆçŠ¶æ€ï¼š{final_status}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ã€ä»»åŠ¡ä¸Šä¸‹æ–‡ã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

{task_context}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ã€å®Œæ•´æ‰§è¡Œå†å²ã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

{execution_history}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ã€å„è½®æ¬¡ç»Ÿè®¡ã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

{round_statistics}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ã€å…³é”®äº‹ä»¶æ‘˜è¦ã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

{key_events}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ã€è¯„ä¼°ä»»åŠ¡ã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

è¯·åŸºäºä»¥ä¸Šä¿¡æ¯ï¼Œå¯¹æ•´ä¸ªä»»åŠ¡çš„æ‰§è¡Œè¿‡ç¨‹è¿›è¡Œå…¨å±€æ€§è¯„ä¼°åˆ†æï¼š

**ç¬¬ä¸€æ­¥ï¼šæ•´ä½“è¯„ä¼°**
å¯¹ä»»åŠ¡å®Œæˆåº¦ã€ä»»åŠ¡åˆ†è§£è´¨é‡ã€å·¥å…·é€‰æ‹©é€‚é…æ€§ã€æ‰§è¡Œç­–ç•¥æœ‰æ•ˆæ€§ã€è¿­ä»£ä¼˜åŒ–æ•ˆæœäº”ä¸ªç»´åº¦è¿›è¡Œæ‰“åˆ†ï¼ˆ0-100åˆ†ï¼‰

**ç¬¬äºŒæ­¥ï¼šæˆåŠŸç»éªŒæå–**
è¯†åˆ«æœ¬æ¬¡ä»»åŠ¡ä¸­å€¼å¾—å¤ç”¨çš„æˆåŠŸæ¨¡å¼ã€æœ‰æ•ˆçš„å·¥å…·ç»„åˆã€ä¼˜ç§€çš„æ‰§è¡Œç­–ç•¥

**ç¬¬ä¸‰æ­¥ï¼šå¤±è´¥æ•™è®­æ€»ç»“**
åˆ†æå¤±è´¥çš„æ ¹æœ¬åŸå› ã€ä¸å½“çš„å·¥å…·é€‰æ‹©ã€é”™è¯¯çš„å‡è®¾

**ç¬¬å››æ­¥ï¼šé€šç”¨ç»éªŒå½’çº³**
æç‚¼å‡ºå¯¹äºç±»ä¼¼ä»»åŠ¡çš„é€šç”¨æ‰§è¡Œæ¨¡å¼ã€å¯æ²‰æ·€çš„æœ€ä½³å®è·µã€å¯¹åç»­ä»»åŠ¡çš„å»ºè®®

**ç¬¬äº”æ­¥ï¼šæ”¹è¿›å»ºè®®**
é’ˆå¯¹æœ¬æ¬¡ä»»åŠ¡æš´éœ²çš„é—®é¢˜ï¼Œæå‡ºå…·ä½“å¯æ“ä½œçš„æ”¹è¿›æªæ–½

ç°åœ¨è¯·å¼€å§‹è¯„ä¼°ï¼Œè¿”å› JSON æ ¼å¼çš„è¯„ä¼°ç»“æœï¼ˆæŒ‰ç…§ä¸‹æ–¹çš„ schemaï¼‰ã€‚

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ã€è¾“å‡º JSON Schemaã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

{
  "evaluation_id": "string (æ ¼å¼ï¼špost_eval_<uuid>)",
  "task_id": "string",
  "overall_score": "number (0-100)",
  "dimensions": {
    "task_completion": "number (0-100)",
    "task_decomposition": "number (0-100)",
    "tool_selection": "number (0-100)",
    "execution_strategy": "number (0-100)",
    "iteration_effectiveness": "number (0-100)"
  },
  "success_patterns": [
    {
      "pattern": "æˆåŠŸæ¨¡å¼æè¿°",
      "evidence": "æ”¯æ’‘è¯æ®",
      "reusability": "å¯å¤ç”¨æ€§è¯´æ˜"
    }
  ],
  "failure_lessons": [
    {
      "lesson": "å¤±è´¥æ•™è®­æè¿°",
      "root_cause": "æ ¹æœ¬åŸå› ",
      "avoidance_strategy": "é¿å…ç­–ç•¥"
    }
  ],
  "key_findings": [
    "å…³é”®å‘ç°1",
    "å…³é”®å‘ç°2",
    ...
  ],
  "general_insights": [
    "é€šç”¨ç»éªŒ1",
    "é€šç”¨ç»éªŒ2",
    ...
  ],
  "improvement_suggestions": [
    {
      "aspect": "æ”¹è¿›æ–¹é¢",
      "current_issue": "å½“å‰é—®é¢˜",
      "suggestion": "æ”¹è¿›å»ºè®®",
      "expected_benefit": "é¢„æœŸæ”¶ç›Š"
    }
  ],
  "summary": "æ•´ä½“è¯„ä¼°æ‘˜è¦ï¼ˆ2-3å¥è¯ï¼‰"
}"#;
```

**è®¾è®¡äº®ç‚¹**ï¼š
- ğŸ“ ä½¿ç”¨åˆ†éš”çº¿æé«˜å¯è¯»æ€§
- ğŸ”¢ äº”æ­¥è¯„ä¼°æµç¨‹æ¸…æ™°
- ğŸ“‹ æä¾›å®Œæ•´çš„ JSON Schema è§„èŒƒè¾“å‡º
- ğŸ¯ æ¨¡æ¿åŒ–è®¾è®¡ï¼Œæ”¯æŒå˜é‡æ›¿æ¢

---

### 3.5 è¯„ä¼°ç»“æœè§£æ

**æ–¹æ³•**: [parse_evaluation_response](src/core/post_task_evaluator.rs#L238-L327)

```rust
fn parse_evaluation_response(
    &self,
    response: &str,
    task_id: &str,
) -> Result<PostTaskEvaluation> {
    // 1ï¸âƒ£ æå– JSON å†…å®¹ï¼ˆä» Markdown ä»£ç å—æˆ–çº¯æ–‡æœ¬ï¼‰
    let json_str = Self::extract_json(response);

    // 2ï¸âƒ£ è§£æä¸ºé€šç”¨çš„ JSON å€¼
    let parsed: Value = match serde_json::from_str(json_str) {
        Ok(value) => value,
        Err(e) => {
            // âš ï¸ è§£æå¤±è´¥ï¼Œè¿”å›é»˜è®¤è¯„ä¼°
            return Ok(Self::create_default_evaluation(task_id));
        }
    };

    // 3ï¸âƒ£ æ‰‹åŠ¨æ„å»º PostTaskEvaluationï¼ˆå®‰å…¨æå–å„å­—æ®µï¼‰
    let evaluation_id = parsed
        .get("evaluation_id")
        .and_then(|v| v.as_str())
        .unwrap_or(&format!("post_eval_{}", uuid::Uuid::new_v4()))
        .to_string();

    let overall_score = parsed
        .get("overall_score")
        .and_then(|v| v.as_f64())
        .unwrap_or(50.0) as f32;

    let dimensions = /* è§£æ dimensions å¯¹è±¡ */;
    let success_patterns = Self::parse_success_patterns(&parsed);
    let failure_lessons = Self::parse_failure_lessons(&parsed);
    let key_findings = Self::parse_string_array(&parsed, "key_findings");
    let general_insights = Self::parse_string_array(&parsed, "general_insights");
    let improvement_suggestions = Self::parse_improvement_suggestions(&parsed);

    Ok(PostTaskEvaluation {
        evaluation_id,
        task_id: task_id.to_string(),
        overall_score,
        dimensions,
        success_patterns,
        failure_lessons,
        key_findings,
        general_insights,
        improvement_suggestions,
        summary,
    })
}
```

**å®¹é”™è®¾è®¡**ï¼š
- âœ… æ”¯æŒä» Markdown ä»£ç å—æå– JSON
- âœ… è§£æå¤±è´¥è¿”å›é»˜è®¤å€¼ï¼ˆ50 åˆ†ï¼‰
- âœ… ä½¿ç”¨ `unwrap_or` ä¸ºæ¯ä¸ªå­—æ®µæä¾›é»˜è®¤å€¼

---

### 3.6 æ•°æ®ç»“æ„å®šä¹‰

**æ–‡ä»¶**: [src/llm/post_task_evaluation_prompts.rs](src/llm/post_task_evaluation_prompts.rs#L189-L262)

```rust
/// ä»»åŠ¡åè¯„ä¼°ç»“æœ
#[derive(Debug, Clone, Serialize, Deserialize)]
pub struct PostTaskEvaluation {
    /// è¯„ä¼° ID
    pub evaluation_id: String,
    /// ä»»åŠ¡ ID
    pub task_id: String,
    /// æ€»ä½“è¯„åˆ† (0-100)
    pub overall_score: f32,
    /// å„ç»´åº¦è¯„åˆ†
    pub dimensions: PostTaskDimensions,
    /// æˆåŠŸæ¨¡å¼
    pub success_patterns: Vec<SuccessPattern>,
    /// å¤±è´¥æ•™è®­
    pub failure_lessons: Vec<FailureLesson>,
    /// å…³é”®å‘ç°
    pub key_findings: Vec<String>,
    /// é€šç”¨ç»éªŒ
    pub general_insights: Vec<String>,
    /// æ”¹è¿›å»ºè®®
    pub improvement_suggestions: Vec<ImprovementSuggestion>,
    /// æ•´ä½“è¯„ä¼°æ‘˜è¦
    pub summary: String,
}

/// ä»»åŠ¡åè¯„ä¼°ç»´åº¦
#[derive(Debug, Clone, Serialize, Deserialize)]
pub struct PostTaskDimensions {
    /// ä»»åŠ¡å®Œæˆåº¦ (0-100)
    pub task_completion: f32,
    /// ä»»åŠ¡åˆ†è§£è´¨é‡ (0-100)
    pub task_decomposition: f32,
    /// å·¥å…·é€‰æ‹©é€‚é…æ€§ (0-100)
    pub tool_selection: f32,
    /// æ‰§è¡Œç­–ç•¥æœ‰æ•ˆæ€§ (0-100)
    pub execution_strategy: f32,
    /// è¿­ä»£ä¼˜åŒ–æ•ˆæœ (0-100)
    pub iteration_effectiveness: f32,
}

/// æˆåŠŸæ¨¡å¼
#[derive(Debug, Clone, Serialize, Deserialize)]
pub struct SuccessPattern {
    /// æ¨¡å¼æè¿°
    pub pattern: String,
    /// æ”¯æ’‘è¯æ®
    pub evidence: String,
    /// å¯å¤ç”¨æ€§è¯´æ˜
    pub reusability: String,
}

/// å¤±è´¥æ•™è®­
#[derive(Debug, Clone, Serialize, Deserialize)]
pub struct FailureLesson {
    /// æ•™è®­æè¿°
    pub lesson: String,
    /// æ ¹æœ¬åŸå› 
    pub root_cause: String,
    /// é¿å…ç­–ç•¥
    pub avoidance_strategy: String,
}

/// æ”¹è¿›å»ºè®®
#[derive(Debug, Clone, Serialize, Deserialize)]
pub struct ImprovementSuggestion {
    /// æ”¹è¿›æ–¹é¢
    pub aspect: String,
    /// å½“å‰é—®é¢˜
    pub current_issue: String,
    /// æ”¹è¿›å»ºè®®
    pub suggestion: String,
    /// é¢„æœŸæ”¶ç›Š
    pub expected_benefit: String,
}
```

---

## 4. é…ç½®ç®¡ç†

### 4.1 é…ç½®æ–‡ä»¶

**æ–‡ä»¶**: [config.dev.toml](config.dev.toml#L199-L205)

```toml
[debug]
# æ˜¯å¦å¯ç”¨ä»»åŠ¡åè¯„ä¼°ï¼ˆå¯¹å·²å®Œæˆä»»åŠ¡è¿›è¡Œç»éªŒæç‚¼ï¼‰
# true: åœ¨ä»»åŠ¡å®Œæˆåå¯¹æ•´ä¸ªä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹è¿›è¡Œè¯„ä¼°åˆ†æï¼Œç”Ÿæˆç»éªŒæ€»ç»“
# false: ä¸è¿›è¡Œä»»åŠ¡åè¯„ä¼°
enable_post_task_evaluation = true

# ä»»åŠ¡åè¯„ä¼°ç»“æœæ–‡ä»¶è·¯å¾„ï¼ˆJSONLæ ¼å¼ï¼Œæ¯è¡Œä¸€ä¸ªè¯„ä¼°ç»“æœï¼‰
post_task_evaluation_file = "post_task_evaluations.jsonl"
```

### 4.2 é…ç½®åŠ è½½

**æ–‡ä»¶**: [src/config/mod.rs](src/config/mod.rs)

```rust
#[derive(Debug, Clone, Deserialize)]
pub struct DebugConfig {
    /// æ˜¯å¦ä¿å­˜è°ƒè¯•æ—¥å¿—
    pub save_debug_log: bool,
    /// è°ƒè¯•æ—¥å¿—æ–‡ä»¶è·¯å¾„
    pub debug_log_file: String,
    /// æ˜¯å¦ä¿å­˜ä¸Šä¸‹æ–‡å·¥ç¨‹äº‹ä»¶
    pub save_context_engineering_event: bool,
    /// ä¸Šä¸‹æ–‡å·¥ç¨‹äº‹ä»¶æ–‡ä»¶è·¯å¾„
    pub context_engineering_file: String,
    /// æ˜¯å¦å¯ç”¨ä»»åŠ¡åè¯„ä¼°
    pub enable_post_task_evaluation: bool,
    /// ä»»åŠ¡åè¯„ä¼°ç»“æœæ–‡ä»¶è·¯å¾„
    pub post_task_evaluation_file: String,
}
```

---

## 5. è¯„ä¼°ç»´åº¦è¯¦è§£

### 5.1 ä»»åŠ¡å®Œæˆåº¦ (Task Completion)

**è¯„åˆ†æ ‡å‡†**ï¼š

| åˆ†æ•°åŒºé—´ | è¯„ä»· | æ ‡å‡† |
|---------|------|------|
| 90-100  | ä¼˜ç§€ | å®Œå…¨è¾¾æˆç”¨æˆ·ç›®æ ‡ï¼Œæ‰€æœ‰åŠŸèƒ½å®Œæˆï¼Œè´¨é‡è¶…é¢„æœŸ |
| 75-89   | è‰¯å¥½ | æ ¸å¿ƒç›®æ ‡è¾¾æˆï¼Œä¸»è¦åŠŸèƒ½å®Œæˆï¼Œæœ‰å°‘é‡ç‘•ç–µ |
| 60-74   | åŠæ ¼ | éƒ¨åˆ†ç›®æ ‡è¾¾æˆï¼ŒåŸºç¡€åŠŸèƒ½å®Œæˆï¼Œå­˜åœ¨æ˜æ˜¾ä¸è¶³ |
| 0-59    | ä¸åˆæ ¼ | ç›®æ ‡æœªè¾¾æˆï¼ŒåŠŸèƒ½æ®‹ç¼ºï¼Œè´¨é‡ä¸è¾¾æ ‡ |

**è€ƒå¯Ÿç‚¹**ï¼š
- âœ… æ˜¯å¦è¾¾æˆç”¨æˆ·çš„æ ¸å¿ƒç›®æ ‡ï¼Ÿ
- âœ… æ˜¯å¦å®Œæˆäº†æ‰€æœ‰é¢„æœŸåŠŸèƒ½ï¼Ÿ
- âœ… æœ€ç»ˆç»“æœçš„è´¨é‡å¦‚ä½•ï¼Ÿ

---

### 5.2 ä»»åŠ¡åˆ†è§£è´¨é‡ (Task Decomposition)

**è¯„åˆ†æ ‡å‡†**ï¼š

| åˆ†æ•°åŒºé—´ | è¯„ä»· | æ ‡å‡† |
|---------|------|------|
| 90-100  | ä¼˜ç§€ | æ­¥éª¤æ‹†è§£åˆç†ï¼Œä¾èµ–å…³ç³»æ¸…æ™°ï¼Œæ— å†—ä½™æˆ–é—æ¼ |
| 75-89   | è‰¯å¥½ | æ­¥éª¤åŸºæœ¬åˆç†ï¼Œä¾èµ–åŸºæœ¬æ¸…æ™°ï¼Œæœ‰å°‘é‡å†—ä½™ |
| 60-74   | åŠæ ¼ | æ­¥éª¤æ‹†è§£ä¸€èˆ¬ï¼Œä¾èµ–å…³ç³»æ¨¡ç³Šï¼Œå­˜åœ¨å†—ä½™æˆ–é—æ¼ |
| 0-59    | ä¸åˆæ ¼ | æ­¥éª¤æ‹†è§£æ··ä¹±ï¼Œä¾èµ–å…³ç³»é”™è¯¯ï¼Œä¸¥é‡å†—ä½™æˆ–é—æ¼ |

**è€ƒå¯Ÿç‚¹**ï¼š
- ğŸ¯ ä»»åŠ¡æ‹†è§£æ˜¯å¦åˆç†ï¼Ÿ
- ğŸ”— æ­¥éª¤ä¹‹é—´çš„ä¾èµ–å…³ç³»æ˜¯å¦æ¸…æ™°ï¼Ÿ
- ğŸ“Š æ˜¯å¦æœ‰å†—ä½™æˆ–é—æ¼çš„æ­¥éª¤ï¼Ÿ

---

### 5.3 å·¥å…·é€‰æ‹©é€‚é…æ€§ (Tool Selection)

**è¯„åˆ†æ ‡å‡†**ï¼š

| åˆ†æ•°åŒºé—´ | è¯„ä»· | æ ‡å‡† |
|---------|------|------|
| 90-100  | ä¼˜ç§€ | å·¥å…·é€‰æ‹©å®Œç¾åŒ¹é…éœ€æ±‚ï¼Œç»„åˆé«˜æ•ˆï¼Œæ— æ›´ä¼˜æ–¹æ¡ˆ |
| 75-89   | è‰¯å¥½ | å·¥å…·é€‰æ‹©åŸºæœ¬åˆç†ï¼Œç»„åˆå¯è¡Œï¼Œæœ‰å°ä¼˜åŒ–ç©ºé—´ |
| 60-74   | åŠæ ¼ | å·¥å…·é€‰æ‹©å‹‰å¼ºå¯ç”¨ï¼Œç»„åˆä½æ•ˆï¼Œæœ‰æ˜æ˜¾æ›´ä¼˜æ–¹æ¡ˆ |
| 0-59    | ä¸åˆæ ¼ | å·¥å…·é€‰æ‹©ä¸å½“ï¼Œç»„åˆæ··ä¹±ï¼Œä¸¥é‡å½±å“æ•ˆæœ |

**è€ƒå¯Ÿç‚¹**ï¼š
- ğŸ”§ é€‰æ‹©çš„å·¥å…·æ˜¯å¦é€‚åˆä»»åŠ¡éœ€æ±‚ï¼Ÿ
- ğŸ’¡ æ˜¯å¦å­˜åœ¨æ›´ä¼˜çš„å·¥å…·é€‰æ‹©ï¼Ÿ
- ğŸ”„ å·¥å…·ç»„åˆæ˜¯å¦é«˜æ•ˆï¼Ÿ

---

### 5.4 æ‰§è¡Œç­–ç•¥æœ‰æ•ˆæ€§ (Execution Strategy)

**è¯„åˆ†æ ‡å‡†**ï¼š

| åˆ†æ•°åŒºé—´ | è¯„ä»· | æ ‡å‡† |
|---------|------|------|
| 90-100  | ä¼˜ç§€ | æ‰§è¡Œé¡ºåºæœ€ä¼˜ï¼Œé”™è¯¯å¤„ç†å®Œç¾ï¼Œé‡è¯•ç­–ç•¥å¾—å½“ |
| 75-89   | è‰¯å¥½ | æ‰§è¡Œé¡ºåºåˆç†ï¼Œé”™è¯¯å¤„ç†åŠæ—¶ï¼Œé‡è¯•ç­–ç•¥å¯è¡Œ |
| 60-74   | åŠæ ¼ | æ‰§è¡Œé¡ºåºä¸€èˆ¬ï¼Œé”™è¯¯å¤„ç†å»¶è¿Ÿï¼Œé‡è¯•ç­–ç•¥ç²—ç³™ |
| 0-59    | ä¸åˆæ ¼ | æ‰§è¡Œé¡ºåºæ··ä¹±ï¼Œé”™è¯¯å¤„ç†ç¼ºå¤±ï¼Œé‡è¯•ç­–ç•¥å¤±æ•ˆ |

**è€ƒå¯Ÿç‚¹**ï¼š
- â±ï¸ æ‰§è¡Œé¡ºåºæ˜¯å¦åˆç†ï¼Ÿ
- ğŸ›¡ï¸ é”™è¯¯å¤„ç†æ˜¯å¦åŠæ—¶æœ‰æ•ˆï¼Ÿ
- ğŸ”„ é‡è¯•å’Œæ¢å¤ç­–ç•¥æ˜¯å¦å¾—å½“ï¼Ÿ

---

### 5.5 è¿­ä»£ä¼˜åŒ–æ•ˆæœ (Iteration Effectiveness)

**è¯„åˆ†æ ‡å‡†**ï¼š

| åˆ†æ•°åŒºé—´ | è¯„ä»· | æ ‡å‡† |
|---------|------|------|
| 90-100  | ä¼˜ç§€ | åæ€æ·±åˆ»ï¼Œé‡è§„åˆ’æœ‰æ•ˆï¼Œæ¯æ¬¡è¿­ä»£æ˜¾è‘—æ”¹è¿› |
| 75-89   | è‰¯å¥½ | åæ€å‡†ç¡®ï¼Œé‡è§„åˆ’åˆç†ï¼Œè¿­ä»£æœ‰å®è´¨æ”¹è¿› |
| 60-74   | åŠæ ¼ | åæ€æµ…æ˜¾ï¼Œé‡è§„åˆ’å‹‰å¼ºï¼Œè¿­ä»£æ”¹è¿›æœ‰é™ |
| 0-59    | ä¸åˆæ ¼ | åæ€å¤±æ•ˆï¼Œé‡è§„åˆ’æ— ç”¨ï¼Œè¿­ä»£æ— æ”¹è¿› |

**è€ƒå¯Ÿç‚¹**ï¼š
- ğŸ¤” åæ€å’Œé‡æ–°è§„åˆ’æ˜¯å¦æœ‰æ•ˆï¼Ÿ
- ğŸ“ˆ æ¯æ¬¡è¿­ä»£æ˜¯å¦æœ‰å®è´¨æ€§æ”¹è¿›ï¼Ÿ
- ğŸ› ï¸ å¤±è´¥æ­¥éª¤çš„å¤„ç†æ˜¯å¦åˆç†ï¼Ÿ

---

## 6. å…³é”®å®ç°ç»†èŠ‚

### 6.1 å¼‚æ­¥éé˜»å¡è®¾è®¡

**é—®é¢˜**ï¼šä»»åŠ¡åè¯„ä¼°å¯èƒ½è€—æ—¶è¾ƒé•¿ï¼ˆè°ƒç”¨ LLMï¼‰ï¼Œå¦‚æœåŒæ­¥æ‰§è¡Œä¼šé˜»å¡ä»»åŠ¡è¿”å›ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š
```rust
// âœ… ä½¿ç”¨ tokio::spawn åœ¨åå°å¼‚æ­¥æ‰§è¡Œ
tokio::spawn(async move {
    match post_task_evaluator.evaluate_completed_task(&task_clone).await {
        Ok(evaluation) => {
            // ä¿å­˜è¯„ä¼°ç»“æœ
        }
        Err(e) => {
            // è®°å½•é”™è¯¯æ—¥å¿—ï¼Œä¸å½±å“ä»»åŠ¡ç»“æœ
        }
    }
});
```

**ä¼˜ç‚¹**ï¼š
- âš¡ ä»»åŠ¡ç«‹å³è¿”å›ï¼Œç”¨æˆ·ä½“éªŒæµç•…
- ğŸ›¡ï¸ è¯„ä¼°å¤±è´¥ä¸å½±å“ä»»åŠ¡ç»“æœ
- ğŸ”„ é€‚åˆé«˜å¹¶å‘åœºæ™¯

---

### 6.2 JSONL æ ¼å¼å­˜å‚¨

**é—®é¢˜**ï¼šå¤šä¸ªä»»åŠ¡çš„è¯„ä¼°ç»“æœéœ€è¦å­˜å‚¨åˆ°åŒä¸€ä¸ªæ–‡ä»¶ï¼Œå¦‚ä½•é¿å…æ ¼å¼æ··ä¹±ï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**ï¼šä½¿ç”¨ JSONLï¼ˆJSON Linesï¼‰æ ¼å¼ï¼Œæ¯è¡Œä¸€ä¸ª JSON å¯¹è±¡ã€‚

```rust
// å†™å…¥å•ä¸ªè¯„ä¼°ç»“æœ
let json_line = serde_json::to_string(&evaluation)?;
file.write_all(json_line.as_bytes()).await?;
file.write_all(b"\n").await?;  // è¿½åŠ æ¢è¡Œç¬¦
```

**JSONL æ ¼å¼ç¤ºä¾‹**ï¼š
```jsonl
{"evaluation_id":"post_eval_123","task_id":"task_123","overall_score":85.5,...}
{"evaluation_id":"post_eval_456","task_id":"task_456","overall_score":92.3,...}
{"evaluation_id":"post_eval_789","task_id":"task_789","overall_score":78.1,...}
```

**ä¼˜ç‚¹**ï¼š
- âœ… è¿½åŠ å†™å…¥æ— éœ€è§£ææ•´ä¸ªæ–‡ä»¶
- âœ… æ‰¹é‡åˆ†ææ–¹ä¾¿ï¼ˆé€è¡Œè¯»å–ï¼‰
- âœ… æ ¼å¼ç®€æ´ï¼Œæ˜“äºå¤„ç†

---

### 6.3 å®¹é”™ä¸é»˜è®¤å€¼è®¾è®¡

**é—®é¢˜**ï¼šLLM è¾“å‡ºå¯èƒ½ä¸ç¬¦åˆé¢„æœŸæ ¼å¼ï¼Œå¦‚ä½•ä¿è¯ç³»ç»Ÿç¨³å®šï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**ï¼šå¤šå±‚å®¹é”™æœºåˆ¶

```rust
// 1ï¸âƒ£ æå– JSON æ—¶æ”¯æŒå¤šç§æ ¼å¼
fn extract_json(response: &str) -> &str {
    // æ”¯æŒä» Markdown ä»£ç å—æå–
    if let Some(start) = response.find("```json") { /* ... */ }
    // æ”¯æŒä»æ™®é€šä»£ç å—æå–
    if let Some(start) = response.find("```") { /* ... */ }
    // æ”¯æŒç›´æ¥æŸ¥æ‰¾ JSON å¯¹è±¡
    if let Some(start) = response.find('{') { /* ... */ }
    response.trim()
}

// 2ï¸âƒ£ è§£ææ—¶æä¾›é»˜è®¤å€¼
let overall_score = parsed
    .get("overall_score")
    .and_then(|v| v.as_f64())
    .unwrap_or(50.0) as f32;  // é»˜è®¤ 50 åˆ†

// 3ï¸âƒ£ è§£æå¤±è´¥è¿”å›é»˜è®¤è¯„ä¼°
fn create_default_evaluation(task_id: &str) -> PostTaskEvaluation {
    PostTaskEvaluation {
        evaluation_id: format!("post_eval_{}", uuid::Uuid::new_v4()),
        task_id: task_id.to_string(),
        overall_score: 50.0,
        dimensions: /* é»˜è®¤ 50 åˆ† */,
        success_patterns: vec![],
        failure_lessons: vec![],
        key_findings: vec!["è¯„ä¼°è§£æå¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤ç»“æœ".to_string()],
        // ...
    }
}
```

---

### 6.4 è°ƒè¯•æ—¥å¿—è®°å½•

**é—®é¢˜**ï¼šLLM çš„å“åº”éœ€è¦è®°å½•ä»¥ä¾¿è°ƒè¯•å’Œé—®é¢˜æ’æŸ¥ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼šä½¿ç”¨ `DebugLogger` è®°å½•äº¤äº’æ—¥å¿—

```rust
// å†™å…¥è°ƒè¯•æ—¥å¿—
let _ = crate::utils::DebugLogger::log_llm_interaction(
    "ä»»åŠ¡åè¯„ä¼°",
    &system_prompt,
    &user_prompt,
    &llm_response,
);
```

**æ—¥å¿—æ ¼å¼**ï¼š
```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ã€ä»»åŠ¡åè¯„ä¼°ã€‘LLM äº¤äº’è®°å½•
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
æ—¶é—´: 2025-01-06 15:23:45

ã€ç³»ç»Ÿæç¤ºè¯ã€‘
ä½ æ˜¯ä»»åŠ¡æ‰§è¡Œç»éªŒæç‚¼ä¸“å®¶...

ã€ç”¨æˆ·æç¤ºè¯ã€‘
ä»»åŠ¡æè¿°: åˆ›å»ºå»ºç­‘å‡ ä½•æ¨¡å‹...

ã€LLM å“åº”ã€‘
{
  "evaluation_id": "post_eval_123",
  "overall_score": 85.5,
  ...
}
```

---

## 7. ä½¿ç”¨åœºæ™¯ä¸ä»·å€¼

### 7.1 é€‚ç”¨åœºæ™¯

| åœºæ™¯ | æè¿° | ä»·å€¼ |
|-----|------|------|
| **ç»éªŒç§¯ç´¯** | åˆ†ææˆåŠŸä»»åŠ¡çš„æ‰§è¡Œæ¨¡å¼ | æ²‰æ·€æœ€ä½³å®è·µ |
| **é—®é¢˜è¯Šæ–­** | è¯†åˆ«å¤±è´¥ä»»åŠ¡çš„æ ¹æœ¬åŸå›  | é¿å…é‡å¤é”™è¯¯ |
| **æ€§èƒ½ä¼˜åŒ–** | å‘ç°æ‰§è¡Œæ•ˆç‡ä½çš„ç¯èŠ‚ | æŒ‡å¯¼ç³»ç»Ÿæ”¹è¿› |
| **è´¨é‡ç›‘æ§** | ç»Ÿè®¡ä»»åŠ¡å®Œæˆåº¦è¶‹åŠ¿ | è¯„ä¼°ç³»ç»Ÿå¥åº·åº¦ |
| **çŸ¥è¯†åº“æ„å»º** | æå–å¯å¤ç”¨çš„æˆåŠŸæ¨¡å¼ | è¾…åŠ©åç»­ä»»åŠ¡è§„åˆ’ |

### 7.2 è¾“å‡ºä»·å€¼

1. **æˆåŠŸæ¨¡å¼åº“**ï¼š
   - æå–é«˜æ•ˆçš„å·¥å…·ç»„åˆ
   - æ€»ç»“ä¼˜ç§€çš„æ‰§è¡Œç­–ç•¥
   - è¯†åˆ«å¯å¤ç”¨çš„æ­¥éª¤æ¨¡å¼

2. **å¤±è´¥æ•™è®­åº“**ï¼š
   - è®°å½•å¸¸è§é”™è¯¯åŠåŸå› 
   - æ€»ç»“é¿å…å¤±è´¥çš„ç­–ç•¥
   - æŒ‡å¯¼é”™è¯¯å¤„ç†ä¼˜åŒ–

3. **é€šç”¨ç»éªŒåº“**ï¼š
   - å½’çº³ä»»åŠ¡ç±»å‹çš„æ‰§è¡Œè§„å¾‹
   - æç‚¼é¢†åŸŸçŸ¥è¯†
   - æŒ‡å¯¼æ–°ä»»åŠ¡çš„è§„åˆ’

4. **æ”¹è¿›å»ºè®®åº“**ï¼š
   - è¯†åˆ«ç³»ç»ŸçŸ­æ¿
   - æå‡ºä¼˜åŒ–æ–¹å‘
   - æŒ‡å¯¼åŠŸèƒ½è¿­ä»£

---

## 8. æœªæ¥ä¼˜åŒ–æ–¹å‘

### 8.1 çŸ­æœŸä¼˜åŒ–ï¼ˆ1-2 å‘¨ï¼‰

- [ ] **è¯„ä¼°ç»“æœå¯è§†åŒ–**ï¼šæä¾› Web ç•Œé¢å±•ç¤ºè¯„ä¼°æŠ¥å‘Š
- [ ] **è¯„ä¼°å†å²å¯¹æ¯”**ï¼šå¯¹æ¯”ä¸åŒç‰ˆæœ¬çš„è¯„ä¼°ç»“æœ
- [ ] **è‡ªåŠ¨è§¦å‘ä¼˜åŒ–**ï¼šæ ¹æ®è¯„ä¼°ç»“æœè‡ªåŠ¨è°ƒæ•´ç³»ç»Ÿå‚æ•°

### 8.2 ä¸­æœŸä¼˜åŒ–ï¼ˆ1-2 æœˆï¼‰

- [ ] **ç»éªŒåº“æ£€ç´¢**ï¼šåœ¨æ–°ä»»åŠ¡è§„åˆ’æ—¶æ£€ç´¢ç›¸ä¼¼ä»»åŠ¡çš„ç»éªŒ
- [ ] **æ¨¡å¼è‡ªåŠ¨åº”ç”¨**ï¼šè‡ªåŠ¨åº”ç”¨æˆåŠŸæ¨¡å¼åˆ°æ–°ä»»åŠ¡
- [ ] **å¤±è´¥é¢„æµ‹**ï¼šæ ¹æ®å†å²æ•™è®­é¢„æµ‹æ½œåœ¨å¤±è´¥ç‚¹

### 8.3 é•¿æœŸä¼˜åŒ–ï¼ˆ3-6 æœˆï¼‰

- [ ] **å¼ºåŒ–å­¦ä¹ é›†æˆ**ï¼šå°†è¯„ä¼°ç»“æœä½œä¸ºå¥–åŠ±ä¿¡å·è®­ç»ƒç­–ç•¥æ¨¡å‹
- [ ] **çŸ¥è¯†å›¾è°±æ„å»º**ï¼šæ„å»ºä»»åŠ¡-å·¥å…·-æ¨¡å¼çš„çŸ¥è¯†å›¾è°±
- [ ] **è‡ªé€‚åº”ä¼˜åŒ–**ï¼šç³»ç»Ÿè‡ªåŠ¨æ ¹æ®è¯„ä¼°ç»“æœè°ƒæ•´æ‰§è¡Œç­–ç•¥

---

## 9. æ•°æ®åˆ†æä¸åº”ç”¨

### 9.1 è¯„ä¼°ç»“æœåˆ†æ

#### 9.1.1 åŸºç¡€ç»Ÿè®¡åˆ†æ

```bash
# ç»Ÿè®¡æˆåŠŸä»»åŠ¡å¹³å‡åˆ†ï¼ˆå‡è®¾æˆåŠŸä»»åŠ¡è¯„åˆ† >= 60ï¼‰
jq 'select(.overall_score >= 60) | .overall_score' post_task_evaluations.jsonl | jq -s 'add/length'

# ç»Ÿè®¡å¤±è´¥ä»»åŠ¡å¹³å‡åˆ†ï¼ˆå‡è®¾å¤±è´¥ä»»åŠ¡è¯„åˆ† < 60ï¼‰
jq 'select(.overall_score < 60) | .overall_score' post_task_evaluations.jsonl | jq -s 'add/length'

# æŸ¥çœ‹è¯„åˆ†åˆ†å¸ƒ
jq '.overall_score' post_task_evaluations.jsonl | sort -n | uniq -c

# ç»Ÿè®¡ä»»åŠ¡æ€»æ•°
wc -l post_task_evaluations.jsonl
```

#### 9.1.2 å¤±è´¥ä»»åŠ¡åˆ†æ

```bash
# æå–å¤±è´¥ä»»åŠ¡çš„è¯„ä¼°ç»“æœ
jq 'select(.overall_score < 60)' post_task_evaluations.jsonl > failed_tasks.jsonl

# ç»Ÿè®¡å¤±è´¥åŸå› 
jq '.failure_lessons[].root_cause' post_task_evaluations.jsonl | sort | uniq -c | sort -rn

# æå–å¤±è´¥æ•™è®­å’Œé¿å…ç­–ç•¥
jq '.failure_lessons[] | {lesson: .lesson, avoidance: .avoidance_strategy}' post_task_evaluations.jsonl

# æŸ¥çœ‹å¤±è´¥ä»»åŠ¡çš„å·¥å…·é€‰æ‹©é—®é¢˜
jq 'select(.overall_score < 60) | {task_id, tool_selection: .dimensions.tool_selection, failures: .failure_lessons}' post_task_evaluations.jsonl
```

#### 9.1.3 æˆåŠŸæ¨¡å¼æå–

```bash
# æå–é«˜åˆ†ä»»åŠ¡çš„æˆåŠŸæ¨¡å¼
jq 'select(.overall_score >= 85) | .success_patterns' post_task_evaluations.jsonl

# ç»Ÿè®¡æœ€å¸¸è§çš„æˆåŠŸæ¨¡å¼
jq '.success_patterns[].pattern' post_task_evaluations.jsonl | sort | uniq -c | sort -rn

# æŸ¥çœ‹é«˜æ•ˆå·¥å…·ç»„åˆ
jq 'select(.dimensions.tool_selection >= 90) | {task_id, score: .overall_score, patterns: .success_patterns}' post_task_evaluations.jsonl
```

#### 9.1.4 ç»´åº¦å¯¹æ¯”åˆ†æ

```bash
# æŸ¥çœ‹å„ç»´åº¦å¹³å‡åˆ†
jq '{
  task_completion: .dimensions.task_completion,
  task_decomposition: .dimensions.task_decomposition,
  tool_selection: .dimensions.tool_selection,
  execution_strategy: .dimensions.execution_strategy,
  iteration_effectiveness: .dimensions.iteration_effectiveness
}' post_task_evaluations.jsonl | jq -s 'add | to_entries | map({key, value: (.value / length)}) | from_entries'

# æ‰¾å‡ºçŸ­æ¿ç»´åº¦ï¼ˆè¯„åˆ†æœ€ä½çš„ç»´åº¦ï¼‰
jq '.dimensions | to_entries | min_by(.value)' post_task_evaluations.jsonl

# å¯¹æ¯”æˆåŠŸä¸å¤±è´¥ä»»åŠ¡çš„å„ç»´åº¦å·®å¼‚
echo "=== æˆåŠŸä»»åŠ¡ç»´åº¦å¹³å‡åˆ† ==="
jq 'select(.overall_score >= 60) | .dimensions' post_task_evaluations.jsonl | jq -s 'add | to_entries | map({key, value: (.value / length)}) | from_entries'

echo "=== å¤±è´¥ä»»åŠ¡ç»´åº¦å¹³å‡åˆ† ==="
jq 'select(.overall_score < 60) | .dimensions' post_task_evaluations.jsonl | jq -s 'add | to_entries | map({key, value: (.value / length)}) | from_entries'
```

### 9.2 æ”¹è¿›å»ºè®®æå–

```bash
# æå–æ‰€æœ‰æ”¹è¿›å»ºè®®
jq '.improvement_suggestions[]' post_task_evaluations.jsonl

# æŒ‰æ”¹è¿›æ–¹é¢åˆ†ç±»ç»Ÿè®¡
jq '.improvement_suggestions[].aspect' post_task_evaluations.jsonl | sort | uniq -c | sort -rn

# æå–é«˜ä¼˜å…ˆçº§æ”¹è¿›å»ºè®®ï¼ˆæ¥è‡ªä½åˆ†ä»»åŠ¡ï¼‰
jq 'select(.overall_score < 70) | {task_id, score: .overall_score, suggestions: .improvement_suggestions}' post_task_evaluations.jsonl
```

### 9.3 è¶‹åŠ¿åˆ†æ

```bash
# æŒ‰æ—¶é—´é¡ºåºæŸ¥çœ‹è¯„åˆ†è¶‹åŠ¿ï¼ˆéœ€è¦ä»»åŠ¡IDåŒ…å«æ—¶é—´æˆ³æˆ–æ·»åŠ æ—¶é—´å­—æ®µï¼‰
jq '{task_id, overall_score}' post_task_evaluations.jsonl

# æŸ¥çœ‹æœ€è¿‘Nä¸ªä»»åŠ¡çš„å¹³å‡åˆ†
tail -10 post_task_evaluations.jsonl | jq '.overall_score' | jq -s 'add/length'

# å¯¹æ¯”å‰åæœŸä»»åŠ¡è´¨é‡
echo "=== å‰50ä¸ªä»»åŠ¡å¹³å‡åˆ† ==="
head -50 post_task_evaluations.jsonl | jq '.overall_score' | jq -s 'add/length'

echo "=== æœ€è¿‘50ä¸ªä»»åŠ¡å¹³å‡åˆ† ==="
tail -50 post_task_evaluations.jsonl | jq '.overall_score' | jq -s 'add/length'
```

### 9.4 çŸ¥è¯†åº“æ„å»º

åŸºäºè¯„ä¼°ç»“æœæ„å»ºçŸ¥è¯†åº“çš„å»ºè®®ï¼š

#### 9.4.1 æˆåŠŸæ¨¡å¼åº“ç»“æ„

```json
{
  "pattern_id": "pattern_001",
  "pattern_type": "å·¥å…·ç»„åˆ",
  "pattern_description": "ä½¿ç”¨ tool_A + tool_B å¤„ç† XX ç±»ä»»åŠ¡",
  "evidence_count": 15,
  "average_score": 88.5,
  "applicable_scenarios": ["åœºæ™¯1", "åœºæ™¯2"],
  "reusability_notes": "é€‚ç”¨äºæ‰€æœ‰éœ€è¦XXçš„ä»»åŠ¡"
}
```

#### 9.4.2 å¤±è´¥æ•™è®­åº“ç»“æ„

```json
{
  "lesson_id": "lesson_001",
  "failure_type": "å·¥å…·é€‰æ‹©é”™è¯¯",
  "root_cause": "é€‰æ‹©äº†ä¸æ”¯æŒXXåŠŸèƒ½çš„å·¥å…·",
  "occurrence_count": 8,
  "avoidance_strategy": "åœ¨è§„åˆ’é˜¶æ®µæ£€æŸ¥å·¥å…·èƒ½åŠ›",
  "related_tasks": ["task_123", "task_456"]
}
```

#### 9.4.3 æ”¹è¿›å»ºè®®åº“ç»“æ„

```json
{
  "suggestion_id": "suggestion_001",
  "aspect": "æç¤ºè¯ä¼˜åŒ–",
  "priority": "é«˜",
  "current_issue": "ä»»åŠ¡åˆ†è§£ä¸å¤Ÿç»†è‡´",
  "suggestion": "åœ¨è§„åˆ’æç¤ºè¯ä¸­å¢åŠ æ­¥éª¤æ‹†è§£ç¤ºä¾‹",
  "expected_benefit": "æå‡ä»»åŠ¡åˆ†è§£è´¨é‡è¯„åˆ†10-15åˆ†",
  "implementation_status": "å¾…å®æ–½"
}
```

### 9.5 å®é™…åº”ç”¨åœºæ™¯

#### åœºæ™¯1ï¼šç³»ç»Ÿå¥åº·åº¦ç›‘æ§

```bash
# ç”Ÿæˆæ¯æ—¥è´¨é‡æŠ¥å‘Š
TODAY=$(date +%Y-%m-%d)
echo "=== $TODAY ä»»åŠ¡è´¨é‡æŠ¥å‘Š ==="
grep "$TODAY" post_task_evaluations.jsonl | jq '{
  total_tasks: length,
  average_score: (map(.overall_score) | add / length),
  success_rate: (map(select(.overall_score >= 60)) | length),
  failure_rate: (map(select(.overall_score < 60)) | length)
}'
```

#### åœºæ™¯2ï¼šé—®é¢˜é¢„è­¦

```bash
# è¯†åˆ«è¿ç»­ä½åˆ†ä»»åŠ¡ï¼ˆå¯èƒ½è¡¨ç¤ºç³»ç»Ÿé—®é¢˜ï¼‰
tail -20 post_task_evaluations.jsonl | jq 'select(.overall_score < 50) | {task_id, score: .overall_score, key_findings}'
```

#### åœºæ™¯3ï¼šä¼˜åŒ–ä¼˜å…ˆçº§æ’åº

```bash
# æ ¹æ®æ”¹è¿›å»ºè®®çš„æœŸæœ›æ”¶ç›Šæ’åº
jq '.improvement_suggestions[] | select(.expected_benefit | contains("æå‡")) | {aspect, suggestion, expected_benefit}' post_task_evaluations.jsonl | jq -s 'sort_by(.expected_benefit) | reverse'
```

---

## 10. å¸¸è§é—®é¢˜

### Q1: ä»»åŠ¡åè¯„ä¼°ä¼šå½±å“ä»»åŠ¡è¿”å›é€Ÿåº¦å—ï¼Ÿ

**A**: ä¸ä¼šã€‚è¯„ä¼°ä½¿ç”¨ `tokio::spawn` åœ¨åå°å¼‚æ­¥æ‰§è¡Œï¼Œä»»åŠ¡ç«‹å³è¿”å›ç»™ç”¨æˆ·ã€‚

### Q2: è¯„ä¼°å¤±è´¥ä¼šå¯¼è‡´ä»»åŠ¡å¤±è´¥å—ï¼Ÿ

**A**: ä¸ä¼šã€‚è¯„ä¼°å¤±è´¥åªä¼šè®°å½•é”™è¯¯æ—¥å¿—ï¼Œä¸å½±å“ä»»åŠ¡çš„æœ€ç»ˆçŠ¶æ€å’Œç»“æœã€‚

### Q3: å¦‚ä½•å…³é—­ä»»åŠ¡åè¯„ä¼°ï¼Ÿ

**A**: åœ¨ `config.dev.toml` ä¸­è®¾ç½®ï¼š
```toml
[debug]
enable_post_task_evaluation = false
```

### Q4: è¯„ä¼°ç»“æœå­˜å‚¨åœ¨å“ªé‡Œï¼Ÿ

**A**: é»˜è®¤å­˜å‚¨åœ¨ `post_task_evaluations.jsonl`ï¼Œå¯é€šè¿‡é…ç½®æ–‡ä»¶ä¿®æ”¹è·¯å¾„ã€‚

### Q5: å¤±è´¥ä»»åŠ¡å’ŒæˆåŠŸä»»åŠ¡çš„è¯„ä¼°æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

**A**:
- **æ•°æ®æ”¶é›†**ï¼šå®Œå…¨ç›¸åŒï¼Œéƒ½æ”¶é›†æ‰§è¡Œå†å²ã€è½®æ¬¡ç»Ÿè®¡å’Œå…³é”®äº‹ä»¶
- **è¯„ä¼°ç»´åº¦**ï¼šä½¿ç”¨ç›¸åŒçš„5ä¸ªè¯„ä¼°ç»´åº¦
- **ä¾§é‡ç‚¹**ï¼šå¤±è´¥ä»»åŠ¡è¯„ä¼°æ›´ä¾§é‡å¤±è´¥åŸå› åˆ†æå’Œé¿å…ç­–ç•¥
- **æ—¥å¿—æ ‡è¯†**ï¼šæ—¥å¿—ä¸­åˆ†åˆ«æ ‡è®°ä¸º"ä»»åŠ¡åè¯„ä¼°å®Œæˆ"å’Œ"å¤±è´¥ä»»åŠ¡åè¯„ä¼°å®Œæˆ"

### Q6: è¯„ä¼°å ç”¨å¤šå°‘å­˜å‚¨ç©ºé—´ï¼Ÿ

**A**: å•ä¸ªè¯„ä¼°ç»“æœçº¦ 2-5 KBï¼Œ1000 ä¸ªä»»åŠ¡çº¦å ç”¨ 2-5 MBã€‚å¯å®šæœŸæ¸…ç†å†å²æ•°æ®ã€‚

### Q7: å¦‚ä½•åŒºåˆ†æˆåŠŸå’Œå¤±è´¥ä»»åŠ¡çš„è¯„ä¼°ç»“æœï¼Ÿ

**A**: å¯ä»¥é€šè¿‡ `overall_score` å­—æ®µåŒºåˆ†ï¼š
- æˆåŠŸä»»åŠ¡é€šå¸¸è¯„åˆ† >= 60
- å¤±è´¥ä»»åŠ¡é€šå¸¸è¯„åˆ† < 60
- ä¹Ÿå¯ä»¥æŸ¥çœ‹ `failure_lessons` å­—æ®µï¼Œå¤±è´¥ä»»åŠ¡ä¼šæœ‰æ›´å¤šå¤±è´¥æ•™è®­

---

## 11. æ€»ç»“

ä»»åŠ¡åè¯„ä¼°åŠŸèƒ½æ˜¯ä»»åŠ¡ç¼–æ’æœåŠ¡çš„**ç»éªŒç§¯ç´¯ä¸æŒç»­ä¼˜åŒ–å¼•æ“**ï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š

âœ… **å¼‚æ­¥éé˜»å¡**ï¼šä¸å½±å“ä»»åŠ¡æ‰§è¡Œæ€§èƒ½
âœ… **å¤šç»´åº¦è¯„ä¼°**ï¼šå…¨é¢è¯„ä¼°ä»»åŠ¡è´¨é‡
âœ… **ç»“æ„åŒ–è¾“å‡º**ï¼šä¾¿äºåç»­åˆ†æå’Œåº”ç”¨
âœ… **å®¹é”™è®¾è®¡**ï¼šä¿è¯ç³»ç»Ÿç¨³å®šæ€§
âœ… **å¯é…ç½®**ï¼šçµæ´»æ§åˆ¶å¼€å¯/å…³é—­
âœ… **å…¨é¢è¦†ç›–**ï¼šæˆåŠŸå’Œå¤±è´¥ä»»åŠ¡éƒ½èƒ½å­¦ä¹ ï¼ˆv1.1+ï¼‰

é€šè¿‡æŒç»­ç§¯ç´¯ä»»åŠ¡æ‰§è¡Œç»éªŒï¼Œç³»ç»Ÿå¯ä»¥ä¸æ–­ä¼˜åŒ–è§„åˆ’ç­–ç•¥ã€å·¥å…·é€‰æ‹©å’Œæ‰§è¡Œæµç¨‹ï¼Œæœ€ç»ˆå®ç°**è‡ªæˆ‘è¿›åŒ–**çš„ç›®æ ‡ã€‚

---

## 12. ç‰ˆæœ¬å†å²

### v1.1 (2025-01-06)
**æ–°å¢åŠŸèƒ½**ï¼š
- âœ… å¤±è´¥ä»»åŠ¡ä¹Ÿè§¦å‘è¯„ä¼°ï¼šä»å¤±è´¥ä¸­å­¦ä¹ ç»éªŒæ•™è®­
- âœ… å¤±è´¥åŸå› æ·±åº¦åˆ†æï¼šLLM åˆ†æå¤±è´¥çš„æ ¹æœ¬åŸå› 
- âœ… å¤±è´¥æ•™è®­åº“ç§¯ç´¯ï¼šé¿å…é‡å¤ç›¸åŒé”™è¯¯
- âœ… æ—¥å¿—åŒºåˆ†æ ‡è¯†ï¼šæˆåŠŸ/å¤±è´¥ä»»åŠ¡è¯„ä¼°æ—¥å¿—åˆ†åˆ«æ ‡è®°

**ä»£ç å˜æ›´**ï¼š
- åœ¨ `orchestrate_with_id_and_metadata` çš„ `Err` åˆ†æ”¯æ·»åŠ è¯„ä¼°è§¦å‘é€»è¾‘
- ä½ç½®ï¼š[src/core/orchestrator.rs:757-862](src/core/orchestrator.rs#L757-L862)

### v1.0 (2025-01-06)
**åˆå§‹ç‰ˆæœ¬**ï¼š
- âœ… æˆåŠŸä»»åŠ¡åè¯„ä¼°
- âœ… 5 ç»´åº¦è´¨é‡è¯„ä¼°
- âœ… JSONL æ ¼å¼å­˜å‚¨
- âœ… å¼‚æ­¥éé˜»å¡æ‰§è¡Œ
- âœ… å®Œæ•´çš„æç¤ºè¯å·¥ç¨‹
- âœ… å®¹é”™ä¸é»˜è®¤å€¼è®¾è®¡

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.1
**åˆ›å»ºæ—¶é—´**: 2025-01-06
**ä½œè€…**: Claude Sonnet 4.5
**æœ€åæ›´æ–°**: 2025-01-06

