# åŠ¨æ€å‚æ•°æ¨æ–­åŠŸèƒ½å®ç°è¯¦è§£

## æ¦‚è¿°

åŠ¨æ€å‚æ•°æ¨æ–­æ˜¯ä»»åŠ¡ç¼–æ’æœåŠ¡çš„ä¸€ä¸ªå¯é€‰å¢å¼ºåŠŸèƒ½ï¼Œå…è®¸åœ¨æ­¥éª¤æ‰§è¡Œæ—¶è°ƒç”¨å¤§æ¨¡å‹ï¼ˆLLMï¼‰æ ¹æ®å½“å‰æ‰§è¡Œä¸Šä¸‹æ–‡åŠ¨æ€ç”Ÿæˆå·¥å…·è°ƒç”¨å‚æ•°ï¼Œè€Œä¸æ˜¯å®Œå…¨ä¾èµ–è§„åˆ’é˜¶æ®µç¡®å®šçš„é™æ€æ§½ä½å‚æ•°ã€‚

### è®¾è®¡èƒŒæ™¯

ä¼ ç»Ÿçš„æ§½ä½å‚æ•°æœºåˆ¶åœ¨è§„åˆ’é˜¶æ®µç¡®å®šå‚æ•°ï¼Œé€šè¿‡å ä½ç¬¦ï¼ˆå¦‚ `{{step_id.outputs.field}}`ï¼‰åœ¨æ‰§è¡Œæ—¶è§£æã€‚è¿™ç§æ–¹å¼åœ¨å¤§å¤šæ•°åœºæ™¯ä¸‹å·¥ä½œè‰¯å¥½ï¼Œä½†åœ¨ä»¥ä¸‹æƒ…å†µå¯èƒ½ä¸å¤Ÿçµæ´»ï¼š

1. **å¤æ‚çš„å‚æ•°ä¾èµ–**ï¼šå½“å‚æ•°éœ€è¦æ ¹æ®å¤šä¸ªå‰ç½®æ­¥éª¤çš„è¾“å‡ºç»¼åˆåˆ¤æ–­æ—¶
2. **æ¡ä»¶æ€§å‚æ•°**ï¼šæ ¹æ®æ‰§è¡Œç»“æœåŠ¨æ€è°ƒæ•´åç»­å‚æ•°
3. **ä¸Šä¸‹æ–‡æ„ŸçŸ¥**ï¼šéœ€è¦ç†è§£æ‰§è¡Œå†å²æ¥ç¡®å®šæœ€ä½³å‚æ•°å€¼

### æ ¸å¿ƒåŸåˆ™

1. **å¯é€‰æ€§**ï¼šé€šè¿‡é…ç½®å¼€å…³æ§åˆ¶ï¼Œé»˜è®¤å…³é—­ï¼Œä¸å½±å“ç°æœ‰åŠŸèƒ½
2. **å‘åå…¼å®¹**ï¼šå…³é—­æ—¶å®Œå…¨ä½¿ç”¨åŸæœ‰çš„æ§½ä½å‚æ•°æœºåˆ¶
3. **å®¹é”™è®¾è®¡**ï¼šLLM è°ƒç”¨å¤±è´¥æ—¶è‡ªåŠ¨å›é€€åˆ°é™æ€å‚æ•°è§£æ

## æ¶æ„è®¾è®¡

### æ•´ä½“æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        æ­¥éª¤æ‰§è¡Œæµç¨‹                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                       â”‚
â”‚  â”‚ 1. è¯»å–é…ç½®å¼€å…³       â”‚                                       â”‚
â”‚  â”‚ enable_dynamic_       â”‚                                       â”‚
â”‚  â”‚ parameter_inference   â”‚                                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                       â”‚
â”‚             â”‚                                                    â”‚
â”‚             â–¼                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚  â”‚           é…ç½®å¼€å…³åˆ¤æ–­                 â”‚                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚             â”‚                                                    â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”                                           â”‚
â”‚     â”‚               â”‚                                           â”‚
â”‚     â–¼               â–¼                                           â”‚
â”‚  å¼€å¯(true)      å…³é—­(false)                                    â”‚
â”‚     â”‚               â”‚                                           â”‚
â”‚     â–¼               â–¼                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚  â”‚ è°ƒç”¨LLM   â”‚   â”‚ ä½¿ç”¨ParameterResolver â”‚                      â”‚
â”‚  â”‚ åŠ¨æ€æ¨æ–­  â”‚   â”‚ é™æ€è§£æå‚æ•°      â”‚                           â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚       â”‚                   â”‚                                      â”‚
â”‚       â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                     â”‚
â”‚       â”‚   â”‚                                                      â”‚
â”‚       â–¼   â–¼                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                       â”‚
â”‚  â”‚ 3. è·å–æœ€ç»ˆå‚æ•°        â”‚                                       â”‚
â”‚  â”‚    HashMap<String,    â”‚                                       â”‚
â”‚  â”‚           String>     â”‚                                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                       â”‚
â”‚             â”‚                                                    â”‚
â”‚             â–¼                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                       â”‚
â”‚  â”‚ 4. æ‰§è¡Œå·¥å…·è°ƒç”¨        â”‚                                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                       â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### åŠ¨æ€æ¨æ–­è¯¦ç»†æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    åŠ¨æ€å‚æ•°æ¨æ–­æµç¨‹                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 1. æ„å»ºæ¨æ–­ä¸Šä¸‹æ–‡ (ParameterInferenceContext)              â”‚   â”‚
â”‚  â”‚    - step_id, step_name, step_description                 â”‚   â”‚
â”‚  â”‚    - tool_id, tool_description                            â”‚   â”‚
â”‚  â”‚    - tool_input_params (å·¥å…·è¾“å…¥å‚æ•°å®šä¹‰)                  â”‚   â”‚
â”‚  â”‚    - tool_output_params (å·¥å…·è¾“å‡ºå‚æ•°å®šä¹‰)                 â”‚   â”‚
â”‚  â”‚    - metadata (ä»»åŠ¡å…ƒæ•°æ®)                                 â”‚   â”‚
â”‚  â”‚    - execution_history (å·²å®Œæˆæ­¥éª¤çš„æ‰§è¡Œå†å²)              â”‚   â”‚
â”‚  â”‚    - planned_parameters (è§„åˆ’é˜¶æ®µçš„å‚æ•°å‚è€ƒ)               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â”‚                                   â”‚
â”‚                              â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 2. æ„å»ºæç¤ºè¯                                              â”‚   â”‚
â”‚  â”‚    - System Prompt: å‚æ•°æ¨æ–­ä¸“å®¶è§’è‰²è®¾å®š                   â”‚   â”‚
â”‚  â”‚    - User Prompt: åŒ…å«ä¸Šä¸‹æ–‡çš„å‚æ•°æ¨æ–­è¯·æ±‚                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â”‚                                   â”‚
â”‚                              â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 3. è°ƒç”¨ LLM                                                â”‚   â”‚
â”‚  â”‚    llm_client.call(system_prompt, user_prompt, None)      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â”‚                                   â”‚
â”‚                              â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 4. è§£æ LLM å“åº”                                           â”‚   â”‚
â”‚  â”‚    - æå– JSON å†…å®¹                                        â”‚   â”‚
â”‚  â”‚    - è§£æä¸º ParameterInferenceResult                      â”‚   â”‚
â”‚  â”‚    - è½¬æ¢ä¸º HashMap<String, String>                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â”‚                                   â”‚
â”‚                              â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 5. è¿”å›æ¨æ–­ç»“æœ                                            â”‚   â”‚
â”‚  â”‚    - æˆåŠŸ: è¿”å›æ¨æ–­å‡ºçš„å‚æ•°                                â”‚   â”‚
â”‚  â”‚    - å¤±è´¥: å›é€€åˆ°é™æ€å‚æ•°è§£æ                              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ä»£ç æ˜ å°„

### 1. é…ç½®æ–‡ä»¶

#### `config.dev.toml` / `config.prod.toml` / `config.local.toml`

```toml
[debug]
# ==================== åŠ¨æ€å‚æ•°æ¨æ–­é…ç½® ====================
# æ˜¯å¦å¯ç”¨åŠ¨æ€å‚æ•°æ¨æ–­ï¼ˆè¿è¡Œæ—¶è°ƒç”¨LLMç”Ÿæˆå‚æ•°ï¼‰
# - true: æ­¥éª¤æ‰§è¡Œæ—¶è°ƒç”¨LLMæ ¹æ®ä¸Šä¸‹æ–‡åŠ¨æ€ç”Ÿæˆå‚æ•°
# - false: ä½¿ç”¨è§„åˆ’é˜¶æ®µç¡®å®šçš„æ§½ä½å‚æ•°ï¼ˆé»˜è®¤è¡Œä¸ºï¼‰
enable_dynamic_parameter_inference = false
```

### 2. é…ç½®ç»“æ„å®šä¹‰

#### `src/config/mod.rs`

```rust
/// è°ƒè¯•é…ç½®
#[derive(Debug, Clone, Deserialize, Serialize)]
pub struct DebugConfig {
    // ... å…¶ä»–å­—æ®µ ...

    // ==================== åŠ¨æ€å‚æ•°æ¨æ–­é…ç½® ====================
    /// æ˜¯å¦å¯ç”¨åŠ¨æ€å‚æ•°æ¨æ–­ï¼ˆè¿è¡Œæ—¶è°ƒç”¨LLMç”Ÿæˆå‚æ•°ï¼‰
    ///
    /// - true: æ­¥éª¤æ‰§è¡Œæ—¶è°ƒç”¨LLMæ ¹æ®ä¸Šä¸‹æ–‡åŠ¨æ€ç”Ÿæˆå‚æ•°
    /// - false: ä½¿ç”¨è§„åˆ’é˜¶æ®µç¡®å®šçš„æ§½ä½å‚æ•°ï¼ˆé»˜è®¤è¡Œä¸ºï¼‰
    #[serde(default = "default_enable_dynamic_parameter_inference")]
    pub enable_dynamic_parameter_inference: bool,
}

fn default_enable_dynamic_parameter_inference() -> bool {
    false  // é»˜è®¤å…³é—­
}
```

### 3. æç¤ºè¯æ¨¡å—

#### `src/llm/parameter_inference_prompts.rs`

è¿™æ˜¯æ–°å¢çš„æ ¸å¿ƒæ¨¡å—ï¼ŒåŒ…å«åŠ¨æ€å‚æ•°æ¨æ–­æ‰€éœ€çš„æ‰€æœ‰æç¤ºè¯å’Œæ•°æ®ç»“æ„ã€‚

##### 3.1 ç³»ç»Ÿæç¤ºè¯

```rust
pub const PARAMETER_INFERENCE_SYSTEM_PROMPT: &str = r#"ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„å·¥å…·å‚æ•°æ¨æ–­ä¸“å®¶...

## æ ¸å¿ƒåŸåˆ™
1. **ç²¾ç¡®æ€§**ï¼šå‚æ•°å€¼å¿…é¡»å®Œå…¨åŒ¹é…å·¥å…·çš„è¾“å…¥å‚æ•°å®šä¹‰
2. **ä¸Šä¸‹æ–‡æ„ŸçŸ¥**ï¼šå……åˆ†åˆ©ç”¨å·²æ‰§è¡Œæ­¥éª¤çš„è¾“å‡ºå’Œå…ƒæ•°æ®
3. **ç±»å‹æ­£ç¡®**ï¼šç¡®ä¿å‚æ•°ç±»å‹ä¸å·¥å…·å®šä¹‰ä¸€è‡´
4. **æœ€å°å¿…è¦**ï¼šåªç”Ÿæˆå¿…éœ€çš„å‚æ•°

## å‚æ•°æ¥æºä¼˜å…ˆçº§
1. **å‰ç½®æ­¥éª¤è¾“å‡º**ï¼šä¼˜å…ˆä»å·²å®Œæˆæ­¥éª¤çš„è¾“å‡ºä¸­æå–å‚æ•°
2. **ä»»åŠ¡å…ƒæ•°æ®**ï¼šä»ä»»åŠ¡åˆå§‹åŒ–æ—¶ä¼ å…¥çš„ metadata ä¸­è·å–
3. **å·¥å…·é»˜è®¤å€¼**ï¼šå½“å·¥å…·å®šä¹‰äº†é»˜è®¤å€¼ä¸”æ— å…¶ä»–æ¥æºæ—¶ä½¿ç”¨
4. **åˆç†æ¨æ–­**ï¼šä»…åœ¨æœ‰è¶³å¤Ÿä¸Šä¸‹æ–‡æ”¯æ’‘æ—¶è¿›è¡Œæ¨æ–­

## è¾“å‡ºæ ¼å¼
{
  "parameters": { ... },
  "reasoning": "ç®€è¦è¯´æ˜å‚æ•°æ¨æ–­çš„ä¾æ®"
}
"#;
```

##### 3.2 ç”¨æˆ·æç¤ºè¯æ¨¡æ¿

```rust
pub const PARAMETER_INFERENCE_USER_TEMPLATE: &str = r#"è¯·ä¸ºä»¥ä¸‹æ­¥éª¤æ¨æ–­å·¥å…·è°ƒç”¨å‚æ•°ã€‚

## å½“å‰æ­¥éª¤ä¿¡æ¯
- **æ­¥éª¤ID**: {step_id}
- **æ­¥éª¤åç§°**: {step_name}
- **æ­¥éª¤æè¿°**: {step_description}
- **è°ƒç”¨å·¥å…·**: {tool_id}

## å·¥å…·ä¿¡æ¯
### å·¥å…·æè¿°
{tool_description}

### è¾“å…¥å‚æ•°å®šä¹‰
{tool_input_params}

### è¾“å‡ºå‚æ•°å®šä¹‰
{tool_output_params}

## æ‰§è¡Œä¸Šä¸‹æ–‡
### ä»»åŠ¡å…ƒæ•°æ® (Metadata)
{metadata}

### å·²å®Œæˆæ­¥éª¤çš„æ‰§è¡Œå†å²
{execution_history}

## è§„åˆ’é˜¶æ®µçš„å‚æ•°å‚è€ƒï¼ˆå¯èƒ½åŒ…å«å ä½ç¬¦ï¼‰
{planned_parameters}
"#;
```

##### 3.3 æ ¸å¿ƒæ•°æ®ç»“æ„

```rust
/// å‚æ•°æ¨æ–­ä¸Šä¸‹æ–‡
#[derive(Debug, Clone)]
pub struct ParameterInferenceContext {
    pub step_id: String,           // æ­¥éª¤ID
    pub step_name: String,         // æ­¥éª¤åç§°
    pub step_description: String,  // æ­¥éª¤æè¿°
    pub tool_id: String,           // å·¥å…·ID
    pub tool_description: String,  // å·¥å…·æè¿°
    pub tool_input_params: String, // å·¥å…·è¾“å…¥å‚æ•°å®šä¹‰ï¼ˆJSONå­—ç¬¦ä¸²ï¼‰
    pub tool_output_params: String,// å·¥å…·è¾“å‡ºå‚æ•°å®šä¹‰ï¼ˆJSONå­—ç¬¦ä¸²ï¼‰
    pub metadata: HashMap<String, String>,  // ä»»åŠ¡å…ƒæ•°æ®
    pub execution_history: Vec<StepExecutionRecord>,  // æ‰§è¡Œå†å²
    pub planned_parameters: String,  // è§„åˆ’é˜¶æ®µçš„å‚æ•°
}

/// æ­¥éª¤æ‰§è¡Œè®°å½•
#[derive(Debug, Clone, Serialize, Deserialize)]
pub struct StepExecutionRecord {
    pub step_id: String,
    pub step_name: String,
    pub tool_id: String,
    pub is_success: bool,
    pub output: String,
    pub parameters: HashMap<String, String>,
}

/// å‚æ•°æ¨æ–­ç»“æœ
#[derive(Debug, Clone, Serialize, Deserialize)]
pub struct ParameterInferenceResult {
    pub parameters: HashMap<String, serde_json::Value>,
    pub reasoning: String,
}
```

##### 3.4 æç¤ºè¯æ„å»ºå™¨

```rust
pub struct ParameterInferencePromptBuilder;

impl ParameterInferencePromptBuilder {
    /// æ„å»ºç”¨æˆ·æç¤ºè¯
    pub fn build_user_prompt(context: &ParameterInferenceContext) -> String { ... }

    /// æ ¼å¼åŒ–æ‰§è¡Œå†å²
    fn format_execution_history(history: &[StepExecutionRecord]) -> String { ... }

    /// è·å–ç³»ç»Ÿæç¤ºè¯
    pub fn get_system_prompt() -> &'static str { ... }

    /// è§£æLLMå“åº”
    pub fn parse_response(response: &str) -> Result<ParameterInferenceResult, String> { ... }

    /// ä»å“åº”ä¸­æå–JSON
    fn extract_json_from_response(response: &str) -> Result<String, String> { ... }

    /// å°†æ¨æ–­ç»“æœè½¬æ¢ä¸ºHashMap<String, String>
    pub fn result_to_string_map(result: &ParameterInferenceResult) -> HashMap<String, String> { ... }
}
```

### 4. æ‰§è¡Œå™¨ä¿®æ”¹

#### `src/core/executor.rs`

##### 4.1 ç»“æ„ä½“æ–°å¢å­—æ®µ

```rust
pub struct Executor {
    // ... åŸæœ‰å­—æ®µ ...

    // ==================== ã€æ–°å¢ã€‘åŠ¨æ€å‚æ•°æ¨æ–­é…ç½® ====================
    /// æ˜¯å¦å¯ç”¨åŠ¨æ€å‚æ•°æ¨æ–­
    enable_dynamic_parameter_inference: bool,
    /// LLM å®¢æˆ·ç«¯ï¼ˆç”¨äºåŠ¨æ€å‚æ•°æ¨æ–­ï¼‰
    llm_client: Option<UnifiedLlmClient>,
}
```

##### 4.2 æ–°å¢æ„é€ å‡½æ•°

```rust
/// åˆ›å»ºæ”¯æŒåŠ¨æ€å‚æ•°æ¨æ–­çš„æ‰§è¡Œå™¨
#[allow(clippy::too_many_arguments)]
pub fn new_with_parameter_inference(
    tool_client: Arc<UnifiedToolServiceClient>,
    timeout_secs: u64,
    kafka_logger: Arc<KafkaLogger>,
    enable_parallel: bool,
    parallel_max_concurrent: usize,
    parallel_min_steps: usize,
    enable_dynamic_parameter_inference: bool,
    llm_client: Option<UnifiedLlmClient>,
) -> Self {
    // ... åˆå§‹åŒ–é€»è¾‘ ...
}
```

##### 4.3 åŠ¨æ€å‚æ•°æ¨æ–­æ–¹æ³•

```rust
/// ä½¿ç”¨ LLM åŠ¨æ€æ¨æ–­æ­¥éª¤å‚æ•°
async fn infer_parameters_with_llm(
    &self,
    step: &PlanStep,
    tool_info: &ToolInfo,
    context: &ExecutionContext,
    available_tools: &[ToolInfo],
) -> Result<HashMap<String, String>> {
    // 1. æ£€æŸ¥ LLM å®¢æˆ·ç«¯
    let llm_client = match &self.llm_client {
        Some(client) => client,
        None => return Ok(ParameterResolver::resolve_parameters(...)),  // å›é€€
    };

    // 2. æ„å»ºæ‰§è¡Œå†å²
    let execution_history = self.build_execution_history(context, available_tools);

    // 3. æ„å»ºæ¨æ–­ä¸Šä¸‹æ–‡
    let inference_context = ParameterInferenceContext { ... };

    // 4. æ„å»ºæç¤ºè¯å¹¶è°ƒç”¨ LLM
    let system_prompt = ParameterInferencePromptBuilder::get_system_prompt();
    let user_prompt = ParameterInferencePromptBuilder::build_user_prompt(&inference_context);

    match llm_client.call(system_prompt, &user_prompt, None).await {
        Ok(response) => {
            // è§£æå“åº”å¹¶è¿”å›å‚æ•°
            match ParameterInferencePromptBuilder::parse_response(&response) {
                Ok(result) => Ok(ParameterInferencePromptBuilder::result_to_string_map(&result)),
                Err(_) => Ok(ParameterResolver::resolve_parameters(...)),  // å›é€€
            }
        }
        Err(_) => Ok(ParameterResolver::resolve_parameters(...)),  // å›é€€
    }
}
```

##### 4.4 ç»Ÿä¸€å‚æ•°è§£æå…¥å£

```rust
/// è§£ææ­¥éª¤å‚æ•°ï¼ˆæ ¹æ®é…ç½®é€‰æ‹©é™æ€æˆ–åŠ¨æ€æ¨æ–­ï¼‰
pub async fn resolve_step_parameters(
    &self,
    step: &PlanStep,
    tool_info: &ToolInfo,
    context: &ExecutionContext,
    available_tools: &[ToolInfo],
) -> Result<HashMap<String, String>> {
    if self.enable_dynamic_parameter_inference {
        self.infer_parameters_with_llm(step, tool_info, context, available_tools).await
    } else {
        Ok(ParameterResolver::resolve_parameters(step, tool_info, context))
    }
}
```

### 5. å…¥å£æ–‡ä»¶ä¿®æ”¹

#### `src/main_grpc.rs` å’Œ `src/main.rs`

```rust
// ==================== åˆ›å»ºExecutorï¼ˆæ”¯æŒå¹¶è¡Œæ‰§è¡Œå’ŒåŠ¨æ€å‚æ•°æ¨æ–­ï¼‰ ====================
let executor = if app_config.debug.enable_dynamic_parameter_inference {
    info!("ğŸ§  åŠ¨æ€å‚æ•°æ¨æ–­å·²å¯ç”¨ï¼ŒExecutor å°†ä½¿ç”¨ LLM å®¢æˆ·ç«¯");
    Arc::new(Executor::new_with_parameter_inference(
        tool_client.clone(),
        app_config.orchestrator.task_timeout_secs,
        kafka_logger.clone(),
        app_config.orchestrator.enable_parallel_execution,
        app_config.orchestrator.parallel_max_concurrent,
        app_config.orchestrator.parallel_min_steps,
        true,                            // å¯ç”¨åŠ¨æ€å‚æ•°æ¨æ–­
        Some((*llm_client).clone()),     // LLM å®¢æˆ·ç«¯
    ))
} else {
    Arc::new(Executor::new(
        tool_client.clone(),
        app_config.orchestrator.task_timeout_secs,
        kafka_logger.clone(),
        app_config.orchestrator.enable_parallel_execution,
        app_config.orchestrator.parallel_max_concurrent,
        app_config.orchestrator.parallel_min_steps,
    ))
};
```

### 6. æ¨¡å—å¯¼å‡º

#### `src/llm/mod.rs`

```rust
pub mod parameter_inference_prompts;

pub use parameter_inference_prompts::{
    ParameterInferenceContext,
    ParameterInferencePromptBuilder,
    ParameterInferenceResult,
    StepExecutionRecord,
};
```

## ä½¿ç”¨æŒ‡å—

### å¯ç”¨åŠ¨æ€å‚æ•°æ¨æ–­

1. ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼ˆå¦‚ `config.dev.toml`ï¼‰ï¼š

```toml
[debug]
enable_dynamic_parameter_inference = true
```

2. é‡å¯æœåŠ¡

### æ—¥å¿—æ ‡è¯†

å¯ç”¨åï¼Œå¯ä»¥é€šè¿‡æ—¥å¿—è§‚å¯ŸåŠ¨æ€å‚æ•°æ¨æ–­çš„æ‰§è¡Œï¼š

```
ğŸ§  å¼€å§‹åŠ¨æ€å‚æ•°æ¨æ–­
âœ… LLM å‚æ•°æ¨æ–­å“åº”å·²æ”¶åˆ°
âœ… åŠ¨æ€å‚æ•°æ¨æ–­æˆåŠŸ
ğŸ§  æ¨æ–­å‡ºçš„å‚æ•°: key=value
```

### å›é€€åœºæ™¯

ä»¥ä¸‹æƒ…å†µä¼šè‡ªåŠ¨å›é€€åˆ°é™æ€å‚æ•°è§£æï¼š

1. LLM å®¢æˆ·ç«¯æœªé…ç½®
2. LLM è°ƒç”¨å¤±è´¥ï¼ˆç½‘ç»œã€è¶…æ—¶ç­‰ï¼‰
3. LLM å“åº”è§£æå¤±è´¥

## æ³¨æ„äº‹é¡¹

### æ€§èƒ½è€ƒè™‘

- åŠ¨æ€å‚æ•°æ¨æ–­ä¼šå¢åŠ æ¯ä¸ªæ­¥éª¤çš„æ‰§è¡Œæ—¶é—´ï¼ˆLLM è°ƒç”¨å¼€é”€ï¼‰
- å»ºè®®ä»…åœ¨éœ€è¦å¤æ‚å‚æ•°æ¨æ–­çš„åœºæ™¯ä¸‹å¯ç”¨

### å¹¶è¡Œæ‰§è¡Œæ”¯æŒ

åŠ¨æ€å‚æ•°æ¨æ–­æ”¯æŒä»¥ä¸‹æ‰§è¡Œæ¨¡å¼ï¼š

| æ‰§è¡Œæ¨¡å¼ | æ”¯æŒçŠ¶æ€ | è¯´æ˜ |
|---------|---------|------|
| ä¸²è¡Œæ‰§è¡Œ (`execute_plan_serial`) | âœ… æ”¯æŒ | æ¯ä¸ªæ­¥éª¤æ‰§è¡Œå‰è°ƒç”¨ LLM æ¨æ–­å‚æ•° |
| å•æ­¥æ‰§è¡Œ (`execute_single_step_with_overrides`) | âœ… æ”¯æŒ | ä½¿ç”¨ `resolve_step_parameters` æ–¹æ³• |
| æ­¥éª¤å†…å¹¶è¡Œæ‰§è¡Œ (`execute_step_with_actions`) | âœ… æ”¯æŒ | åœ¨å¹¶è¡Œæ‰§è¡Œå‰ç»Ÿä¸€ä¸ºæ‰€æœ‰ actions æ¨æ–­å‚æ•° |
| DAG å¹¶è¡Œæ‰§è¡Œ (`ParallelExecutor`) | âŒ ä¸æ”¯æŒ | ä¿æŒä½¿ç”¨é™æ€å‚æ•°è§£æ |

**æ­¥éª¤å†…å¹¶è¡Œæ‰§è¡Œçš„ç‰¹æ®Šå¤„ç†**ï¼š

ç”±äºæ­¥éª¤å†…çš„ actions é€šå¸¸è°ƒç”¨åŒä¸€ä¸ªå·¥å…·ï¼Œå®ç°é‡‡ç”¨ä»¥ä¸‹ç­–ç•¥ï¼š
1. åœ¨å¹¶è¡Œæ‰§è¡Œä»»åŠ¡å¯åŠ¨å‰ï¼Œä¸²è¡Œåœ°ä¸ºæ¯ä¸ª action è°ƒç”¨ LLM æ¨æ–­å‚æ•°
2. å°†æ¨æ–­ç»“æœå­˜å…¥ `HashMap<action_id, HashMap<String, String>>`
3. å¹¶è¡Œæ‰§è¡Œæ—¶ï¼Œå„ä»»åŠ¡ä»é¢„å…ˆæ¨æ–­çš„ç»“æœä¸­è·å–å‚æ•°

```rust
// æ­¥éª¤å†…å¹¶è¡Œæ‰§è¡Œçš„å‚æ•°æ¨æ–­é€»è¾‘
let inferred_params_map: HashMap<String, HashMap<String, String>> =
    if self.enable_dynamic_parameter_inference {
        self.infer_action_parameters(step, context, tool_map).await
    } else {
        HashMap::new()  // ç©º HashMapï¼Œå›é€€åˆ°é™æ€è§£æ
    };
```

### é€‚ç”¨åœºæ™¯

æ¨èåœ¨ä»¥ä¸‹åœºæ™¯å¯ç”¨ï¼š

1. å‚æ•°ä¾èµ–å…³ç³»å¤æ‚ï¼Œéš¾ä»¥ç”¨ç®€å•å ä½ç¬¦è¡¨è¾¾
2. éœ€è¦æ ¹æ®æ‰§è¡Œç»“æœåŠ¨æ€è°ƒæ•´å‚æ•°
3. è°ƒè¯•å’Œå¼€å‘é˜¶æ®µï¼Œè§‚å¯Ÿ LLM çš„å‚æ•°ç†è§£èƒ½åŠ›

### ä¸æ¨èåœºæ™¯

1. ç”Ÿäº§ç¯å¢ƒç¨³å®šè¿è¡Œæ—¶ï¼ˆå¢åŠ å»¶è¿Ÿå’Œæˆæœ¬ï¼‰
2. å‚æ•°å…³ç³»ç®€å•æ˜ç¡®æ—¶
3. å¯¹å“åº”æ—¶é—´è¦æ±‚ä¸¥æ ¼æ—¶

## æ–‡ä»¶å˜æ›´æ¸…å•

| æ–‡ä»¶è·¯å¾„ | å˜æ›´ç±»å‹ | è¯´æ˜ |
|---------|---------|------|
| `config.dev.toml` | ä¿®æ”¹ | æ·»åŠ  `enable_dynamic_parameter_inference` é…ç½®é¡¹ |
| `config.prod.toml` | ä¿®æ”¹ | æ·»åŠ  `enable_dynamic_parameter_inference` é…ç½®é¡¹ |
| `config.local.toml` | ä¿®æ”¹ | æ·»åŠ  `enable_dynamic_parameter_inference` é…ç½®é¡¹ |
| `src/config/mod.rs` | ä¿®æ”¹ | `DebugConfig` æ·»åŠ æ–°å­—æ®µå’Œé»˜è®¤å€¼å‡½æ•° |
| `src/llm/parameter_inference_prompts.rs` | æ–°å¢ | æç¤ºè¯æ¨¡å—ï¼ŒåŒ…å«ä¸Šä¸‹æ–‡ã€ç»“æœç»“æ„å’Œæ„å»ºå™¨ |
| `src/llm/mod.rs` | ä¿®æ”¹ | å¯¼å‡ºæ–°æ¨¡å—å’Œç›¸å…³ç±»å‹ |
| `src/core/executor.rs` | ä¿®æ”¹ | æ·»åŠ åŠ¨æ€å‚æ•°æ¨æ–­ç›¸å…³å­—æ®µã€æ–¹æ³•å’Œé€»è¾‘ |
| `src/main_grpc.rs` | ä¿®æ”¹ | æ ¹æ®é…ç½®åˆ›å»ºæ”¯æŒåŠ¨æ€å‚æ•°æ¨æ–­çš„ Executor |
| `src/main.rs` | ä¿®æ”¹ | æ ¹æ®é…ç½®åˆ›å»ºæ”¯æŒåŠ¨æ€å‚æ•°æ¨æ–­çš„ Executor |

## Executor æ–°å¢æ–¹æ³•ä¸€è§ˆ

| æ–¹æ³•å | å¯è§æ€§ | è¯´æ˜ |
|-------|--------|------|
| `new_with_parameter_inference()` | pub | åˆ›å»ºæ”¯æŒåŠ¨æ€å‚æ•°æ¨æ–­çš„ Executor |
| `infer_parameters_with_llm()` | async fn | ä½¿ç”¨ LLM æ¨æ–­å•ä¸ªæ­¥éª¤çš„å‚æ•° |
| `build_execution_history()` | fn | ä»æ‰§è¡Œä¸Šä¸‹æ–‡æ„å»ºå†å²è®°å½• |
| `resolve_step_parameters()` | pub async | ç»Ÿä¸€å…¥å£ï¼šæ ¹æ®é…ç½®é€‰æ‹©é™æ€/åŠ¨æ€å‚æ•°è§£æ |
| `infer_action_parameters()` | async fn | ä¸ºæ­¥éª¤å†…æ‰€æœ‰ actions æ¨æ–­å‚æ•°ï¼ˆæ­¥éª¤å†…å¹¶è¡Œæ‰§è¡Œï¼‰ |
| `parse_action_parameters_static()` | fn | é™æ€è§£æ action å‚æ•°ï¼Œå¤„ç†æ§½ä½å ä½ç¬¦ |

## ç‰ˆæœ¬ä¿¡æ¯

- **åŠŸèƒ½ç‰ˆæœ¬**: v1.1.0
- **åˆ›å»ºæ—¥æœŸ**: 2026-01-08
- **æœ€åæ›´æ–°**: 2026-01-08
- **æ›´æ–°è¯´æ˜**: æ·»åŠ æ­¥éª¤å†…å¹¶è¡Œæ‰§è¡Œï¼ˆexecute_step_with_actionsï¼‰çš„åŠ¨æ€å‚æ•°æ¨æ–­æ”¯æŒ
- **ä½œè€…**: Claude Code
