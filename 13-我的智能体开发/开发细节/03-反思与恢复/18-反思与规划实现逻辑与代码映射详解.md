# åæ€ä¸è§„åˆ’å®ç°é€»è¾‘ä¸ä»£ç æ˜ å°„è¯¦è§£

## 1. æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†æè¿°ä»»åŠ¡ç¼–æ’æœåŠ¡ä¸­**åæ€(Reflection)**ä¸**è§„åˆ’(Planning)**çš„å®Œæ•´å®ç°é€»è¾‘ï¼ŒåŒ…æ‹¬æ ¸å¿ƒæ•°æ®ç»“æ„ã€è°ƒç”¨æµç¨‹ã€æç¤ºè¯ç³»ç»Ÿå’Œä»£ç ä½ç½®æ˜ å°„ã€‚

### 1.1 æ ¸å¿ƒæ¶æ„

ç³»ç»Ÿé‡‡ç”¨ **Reflective Planning Loopï¼ˆåæ€å‹è§„åˆ’å¾ªç¯ï¼‰** æ¶æ„ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Orchestrator                            â”‚
â”‚                    (åæ€å‹è§„åˆ’å¾ªç¯)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚             â”‚                     â”‚
        â–¼             â–¼                     â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚Planner â”‚    â”‚Executorâ”‚          â”‚Evaluatorâ”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚             â”‚                    â”‚
        â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
        â”‚      â–¼               â–¼           â”‚
        â”‚    å•æ­¥æ‰§è¡Œ    å•æ­¥åæ€(å¤±è´¥æ—¶)    â”‚
        â”‚                                  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚  Reflector   â”‚
                   â”‚ (ä»»åŠ¡çº§åæ€)  â”‚
                   â”‚ should_replanâ”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                  â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
                  â”‚ should_     â”‚
                  â”‚ replan?     â”‚
                  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                    yes/ â”‚ \no
                   /     â”‚  \
                  â–¼      â–¼   â–¼
              [é‡è§„åˆ’]  [å®Œæˆ]
```

### 1.2 æ ¸å¿ƒè®¾è®¡å“²å­¦

**ç”±å¤§æ¨¡å‹è‡ªä¸»å†³ç­–**ï¼šç³»ç»Ÿå·²ç§»é™¤æ‰€æœ‰äººä¸ºçš„è½®æ•°é™åˆ¶ï¼Œæ˜¯å¦ç»§ç»­åæ€/é‡è¯•å®Œå…¨ç”±å¤§æ¨¡å‹æ ¹æ®å®é™…æƒ…å†µæ™ºèƒ½åˆ¤æ–­ï¼Œé€šè¿‡ `should_replan` å­—æ®µè¡¨è¾¾å†³ç­–ã€‚

---

## 2. åæ€å™¨ (Reflector) è¯¦ç»†å®ç°

**æ–‡ä»¶ä½ç½®**: [src/core/reflector.rs](src/core/reflector.rs)

### 2.1 æ ¸å¿ƒæ•°æ®ç»“æ„

#### 2.1.1 ä»»åŠ¡çº§åæ€ç»“æœ - ReflectionResult

**ä»£ç ä½ç½®**: [src/core/reflector.rs:31-47](src/core/reflector.rs#L31-L47)

```rust
pub struct ReflectionResult {
    /// åæ€ ID
    pub reflection_id: String,
    /// æ ¹æœ¬åŸå› åˆ†æ
    pub root_causes: Vec<String>,
    /// é”™è¯¯å‡è®¾
    pub incorrect_assumptions: Vec<String>,
    /// æ›¿ä»£æ–¹æ³•
    pub alternative_approaches: Vec<String>,
    /// ä¼˜åŒ–å»ºè®®
    pub optimization_suggestions: Vec<OptimizationSuggestion>,
    /// ç»éªŒæ•™è®­
    pub lessons_learned: Vec<String>,
    /// â˜…æ ¸å¿ƒå†³ç­–ï¼šæ˜¯å¦éœ€è¦é‡æ–°è§„åˆ’
    pub should_replan: bool,
}
```

#### 2.1.2 å•æ­¥åæ€ç»“æœ - StepReflection

**ä»£ç ä½ç½®**: [src/core/reflector.rs:78-99](src/core/reflector.rs#L78-L99)

```rust
pub struct StepReflection {
    /// åæ€ ID
    pub reflection_id: String,
    /// æ­¥éª¤ ID
    pub step_id: String,
    /// æ ¹æœ¬åŸå› ï¼ˆæœ€ä¸»è¦çš„å¤±è´¥åŸå› ï¼‰
    pub root_cause: String,
    /// æ ¹æœ¬åŸå› åˆ†ç±»
    pub root_cause_category: String,
    /// â˜…å»ºè®®çš„æ‰§è¡Œè¡ŒåŠ¨
    pub suggested_action: StepAction,
    /// å¯ä¿¡åº¦è¯„åˆ†ï¼ˆ0-100ï¼‰
    pub confidence: f32,
    /// è¯¦ç»†åˆ†æ
    pub analysis: String,
    /// å¤‡é€‰æ–¹æ¡ˆåˆ—è¡¨
    pub alternative_solutions: Vec<String>,
    /// æ˜¯å¦å¯æ¢å¤
    pub is_recoverable: bool,
}
```

#### 2.1.3 å•æ­¥è¡ŒåŠ¨å†³ç­– - StepAction

**ä»£ç ä½ç½®**: [src/core/reflector.rs:49-60](src/core/reflector.rs#L49-L60)

```rust
pub enum StepAction {
    /// ä½¿ç”¨è°ƒæ•´åçš„å‚æ•°é‡æ–°æ‰§è¡Œæœ¬æ­¥
    RetryWithAdjustedParams(HashMap<String, String>),
    /// ä½¿ç”¨å¤‡é€‰å·¥å…·é‡æ–°æ‰§è¡Œæœ¬æ­¥
    RetryWithAlternativeTool(String),
    /// é‡æ–°è§„åˆ’æ•´ä¸ªä»»åŠ¡
    ReplanEntireTask,
    /// åœæ­¢æ‰§è¡Œ
    StopExecution,
}
```

### 2.2 åæ€å™¨ç»“æ„

**ä»£ç ä½ç½®**: [src/core/reflector.rs:206-218](src/core/reflector.rs#L206-L218)

```rust
pub struct Reflector {
    /// LLM å®¢æˆ·ç«¯
    llm_client: Arc<UnifiedLlmClient>,
    /// æ˜¯å¦å¯ç”¨æµå¼
    enable_streaming: bool,
    /// æµå¼è¿›åº¦å›¾æ ‡çš„æœ€å¤§å¾ªç¯æ•°é‡
    max_streaming_indicators: usize,
    /// å“åº”æ¶ˆæ¯æ¨¡å¼
    response_mode: ResponseMode,
    /// åæ€æç¤ºè¯æ„å»ºå™¨
    reflection_prompt_builder: ReflectionPromptBuilder,
}
```

### 2.3 æ ¸å¿ƒæ–¹æ³•

#### 2.3.1 ä»»åŠ¡çº§åæ€ - reflect_with_context

**ä»£ç ä½ç½®**: [src/core/reflector.rs:429-483](src/core/reflector.rs#L429-L483)

```rust
pub async fn reflect_with_context(
    &self,
    task_description: &str,          // ä»»åŠ¡æè¿°
    original_plan_text: &str,         // åŸå§‹è®¡åˆ’æ–‡æœ¬
    evaluation: &EvaluationResult,    // è¯„ä¼°ç»“æœ
    current_round: u32,               // å½“å‰è½®æ¬¡
    max_rounds: u32,                  // å·²å¼ƒç”¨ï¼Œä¿ç•™ç”¨äºå‘åå…¼å®¹
    context: &ReflectionContext,      // åæ€ä¸Šä¸‹æ–‡
    event_sender: Option<&Arc<dyn EventSender>>,
) -> Result<ReflectionResult>
```

**æ‰§è¡Œæµç¨‹**ï¼š
1. æ ¼å¼åŒ–è¯„ä¼°ç»“æœä¸ºæ–‡æœ¬
2. ä½¿ç”¨ `ReflectionPromptBuilder` æ„å»ºåæ€æç¤ºè¯ï¼ˆåŒ…å«åœºæ™¯ç‰¹å®šæŒ‡å¯¼ï¼‰
3. è°ƒç”¨ LLM è¿›è¡Œæ·±åº¦åæ€ï¼ˆæ”¯æŒæµå¼è¾“å‡ºï¼‰
4. è§£æ LLM å“åº”ï¼ˆæ”¯æŒ JSON å’Œè‡ªç„¶è¯­è¨€æ ¼å¼ï¼‰
5. è¿”å›åæ€ç»“æœï¼Œ`should_replan` å­—æ®µç”±å¤§æ¨¡å‹å†³å®š

#### 2.3.2 å•æ­¥åæ€ - reflect_on_step_with_events

**ä»£ç ä½ç½®**: [src/core/reflector.rs:817-881](src/core/reflector.rs#L817-L881)

```rust
pub async fn reflect_on_step_with_events(
    &self,
    step_id: &str,                    // æ­¥éª¤ ID
    tool_id: &str,                    // å·¥å…· ID
    error_message: &str,              // é”™è¯¯ä¿¡æ¯
    step_description: &str,           // æ­¥éª¤æè¿°
    metadata: &HashMap<String, String>,
    available_tools: Option<&str>,    // â˜…çº¦æŸå·¥å…·é€‰æ‹©èŒƒå›´
    event_sender: Option<&Arc<dyn EventSender>>,
    task_type: Option<&str>,          // ä»»åŠ¡ç±»å‹ï¼ˆç”¨äºåœºæ™¯æŒ‡å¯¼ï¼‰
    execution_history: Option<&str>,  // â˜…æ‰§è¡Œå†å²ï¼ˆé˜²æ­¢é‡å¤åæ€ï¼‰
    retry_count: Option<u32>,         // å½“å‰é‡è¯•æ¬¡æ•°
) -> Result<StepReflection>
```

**æ‰§è¡Œæµç¨‹**ï¼š
1. æ„å»ºåŒ…å«æ‰§è¡Œå†å²çš„åæ€æç¤ºè¯
2. è°ƒç”¨ LLM è¿›è¡Œæ ¹å› åˆ†æ
3. è§£æ JSON æ ¼å¼çš„å“åº”
4. éªŒè¯å»ºè®®çš„å·¥å…·å¿…é¡»åœ¨å¯ç”¨å·¥å…·åˆ—è¡¨ä¸­
5. è¿”å›å•æ­¥åæ€ç»“æœ

#### 2.3.3 è§£æå•æ­¥åæ€å“åº”

**ä»£ç ä½ç½®**: [src/core/reflector.rs:883-983](src/core/reflector.rs#L883-L983)

å…³é”®è§£æé€»è¾‘ï¼š
- `root_cause_category`: é”™è¯¯åˆ†ç±»ï¼ˆparameter_error/tool_error/dependency_error/server_errorç­‰ï¼‰
- `suggested_action.type`: å»ºè®®çš„è¡ŒåŠ¨ç±»å‹
- `is_recoverable`: æ˜¯å¦å¯é€šè¿‡è°ƒæ•´æ¢å¤

### 2.4 é”™è¯¯åˆ†ç±»ä¸å¤„ç†ç­–ç•¥

| é”™è¯¯ç±»å‹ | root_cause_category | is_recoverable | suggested_action |
|---------|---------------------|----------------|------------------|
| å‚æ•°é”™è¯¯ | parameter_error | true | retry_with_params |
| å·¥å…·é”™è¯¯ | tool_error | true | retry_with_tool |
| ä¾èµ–é”™è¯¯ | dependency_error | true | retry_with_params |
| åˆ†è§£é”™è¯¯ | decomposition_error | false | replan |
| æœåŠ¡ç«¯é”™è¯¯ | server_error | false | stop |
| å¤–éƒ¨é”™è¯¯ | external_error | false | stop |

---

## 3. è§„åˆ’å™¨ (Planner) è¯¦ç»†å®ç°

**æ–‡ä»¶ä½ç½®**: [src/core/planner.rs](src/core/planner.rs)

### 3.1 æ ¸å¿ƒæ•°æ®ç»“æ„

**ä»£ç ä½ç½®**: [src/core/planner.rs:31-60](src/core/planner.rs#L31-L60)

```rust
pub struct Planner {
    /// LLM å®¢æˆ·ç«¯
    llm_client: UnifiedLlmClient,
    /// å·¥å…·æœåŠ¡å®¢æˆ·ç«¯
    tool_client: UnifiedToolServiceClient,
    /// æ˜¯å¦å¯ç”¨ä¸¤é˜¶æ®µè§„åˆ’
    enable_two_stage_planning: bool,
    /// ä¸¤é˜¶æ®µè§„åˆ’çš„å·¥å…·æ•°é‡é˜ˆå€¼
    two_stage_tool_threshold: usize,
    /// æ˜¯å¦å¯ç”¨å†…ç½®ä»»åŠ¡æµç¨‹
    enable_builtin_workflows: bool,
    /// å·¥å…·ç­›é€‰ç›¸ä¼¼åº¦é˜ˆå€¼ï¼ˆ0-100ï¼‰
    tool_selection_threshold: f32,
    /// å“åº”æ¶ˆæ¯æ¨¡å¼
    response_mode: ResponseMode,
    /// æ˜¯å¦å¯ç”¨æµå¼è¿”å›
    enable_streaming: bool,
    /// å½“å‰ç­›é€‰åçš„å·¥å…·åˆ—è¡¨ï¼ˆæ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼‰
    selected_tools_formatted: Arc<RwLock<Option<String>>>,
    /// å½“å‰ç­›é€‰åçš„å·¥å…·åˆ—è¡¨ï¼ˆToolInfoç»“æ„ä½“ï¼‰
    selected_tools: Arc<RwLock<Vec<ToolInfo>>>,
}
```

### 3.2 ä¸¤é˜¶æ®µè§„åˆ’æ¶æ„

#### 3.2.1 é˜¶æ®µ1ï¼šå·¥å…·ç­›é€‰ - select_relevant_tools

ä»æ‰€æœ‰å¯ç”¨å·¥å…·ä¸­ç­›é€‰ä¸ä»»åŠ¡ç›¸å…³çš„å·¥å…·å­é›†ï¼š

```rust
pub async fn select_relevant_tools(
    &self,
    task_description: &str,
    all_tools: &[ToolInfo],
    metadata: &HashMap<String, String>,
    event_sender: Option<Arc<dyn EventSender>>,
) -> Result<(Vec<ToolInfo>, String, Option<String>)>
// è¿”å›ï¼š(ç­›é€‰åçš„å·¥å…·, task_type, workflow_id)
```

#### 3.2.2 é˜¶æ®µ2ï¼šä»»åŠ¡è§„åˆ’ - generate_plan_with_sender

**ä»£ç ä½ç½®**: [src/core/planner.rs:372-400](src/core/planner.rs#L372-L400)

åŸºäºç­›é€‰åçš„å·¥å…·ç”Ÿæˆè¯¦ç»†æ‰§è¡Œè®¡åˆ’ï¼š

```rust
pub async fn generate_plan_with_sender(
    &self,
    task_description: &str,
    reflection_history: Option<&str>,
    metadata: &HashMap<String, String>,
    context: Option<&TaskContext>,
    temp_event_sender: Option<Arc<dyn EventSender>>,
) -> Result<ExecutionPlan>
```

### 3.3 é‡æ–°è§„åˆ’ - replan_task

åŸºäºåæ€ç»“æœç”Ÿæˆæ–°çš„æ‰§è¡Œè®¡åˆ’ï¼š

```rust
pub async fn replan_task(
    &self,
    task_description: &str,
    original_plan: &ExecutionPlan,
    reflection: &ReflectionResult,   // åæ€ç»“æœ
    current_round: u32,
    event_sender: Option<Arc<dyn EventSender>>,
) -> Result<ExecutionPlan>
```

### 3.4 æ„å›¾æå–

**ä»£ç ä½ç½®**: [src/core/planner.rs:63-97](src/core/planner.rs#L63-L97)

```rust
fn extract_intent_from_task(task_description: &str) -> Option<String>
```

æ”¯æŒçš„æ ¼å¼ï¼š
- `æ„å›¾: XXX, ç”¨æˆ·è¾“å…¥: ...`
- `æ„å›¾: XXX`
- `Intent: XXX`

æå–çš„æ„å›¾ä¼šè¦†ç›– LLM è¿”å›çš„ task_typeï¼Œä¼˜å…ˆçº§æœ€é«˜ã€‚

---

## 4. åæ€æç¤ºè¯ç³»ç»Ÿ

**æ–‡ä»¶ä½ç½®**: [src/llm/reflection_prompts.rs](src/llm/reflection_prompts.rs)

### 4.1 åæ€ä¸Šä¸‹æ–‡ - ReflectionContext

**ä»£ç ä½ç½®**: [src/llm/reflection_prompts.rs:24-32](src/llm/reflection_prompts.rs#L24-L32)

```rust
pub struct ReflectionContext {
    /// ä»»åŠ¡ç±»å‹ï¼ˆç”¨äºé€‰æ‹©åœºæ™¯æŒ‡å¯¼ï¼‰
    pub task_type: Option<String>,
    /// ç”¨æˆ·æäº¤çš„åŸå§‹ä¸Šä¸‹æ–‡
    pub user_context: Option<String>,
    /// æ‰§è¡Œå†å²ç‰‡æ®µ
    pub execution_history: Vec<String>,
}
```

### 4.2 åæ€æç¤ºè¯æ„å»ºå™¨ - ReflectionPromptBuilder

**ä»£ç ä½ç½®**: [src/llm/reflection_prompts.rs:622-634](src/llm/reflection_prompts.rs#L622-L634)

```rust
pub struct ReflectionPromptBuilder {
    /// ç»Ÿä¸€çš„åœºæ™¯ç®¡ç†å™¨
    scene_manager: SceneManager,
}
```

#### 4.2.1 æ„å»ºä»»åŠ¡çº§åæ€æç¤ºè¯

**ä»£ç ä½ç½®**: [src/llm/reflection_prompts.rs:652-681](src/llm/reflection_prompts.rs#L652-L681)

```rust
pub fn build_reflection_prompt(
    &self,
    task_description: &str,
    original_plan: &str,
    evaluation_result: &str,
    current_round: u32,
    max_rounds: u32,  // å·²å¼ƒç”¨
    context: &ReflectionContext,
) -> (String, String)  // (system_prompt, user_prompt)
```

#### 4.2.2 æ„å»ºå•æ­¥åæ€æç¤ºè¯

**ä»£ç ä½ç½®**: [src/llm/reflection_prompts.rs:707-756](src/llm/reflection_prompts.rs#L707-L756)

```rust
pub fn build_step_reflection_prompt(
    &self,
    step_id: &str,
    tool_id: &str,
    step_description: &str,
    error_message: &str,
    metadata: &str,
    available_tools: Option<&str>,
    task_type: Option<&str>,
    execution_history: Option<&str>,
    retry_count: Option<u32>,
) -> (String, String)  // (system_prompt, user_prompt)
```

### 4.3 ä»»åŠ¡çº§åæ€æç¤ºè¯ç»“æ„

**ä»£ç ä½ç½®**: [src/llm/reflection_prompts.rs:103-257](src/llm/reflection_prompts.rs#L103-L257) (ç³»ç»Ÿæç¤ºè¯)

#### ç³»ç»Ÿæç¤ºè¯æ ¸å¿ƒå†…å®¹ (BASE_REFLECTION_SYSTEM_PROMPT)

```
ã€æ ¸å¿ƒèŒè´£ã€‘
1. æ·±å…¥åˆ†æè¯„ä¼°æŠ¥å‘Šä¸­çš„é—®é¢˜
2. åŸºäºè¯æ®è¿›è¡Œæ¨ç†
3. æå‡ºå…·ä½“å¯æ“ä½œçš„æ”¹è¿›ç­–ç•¥
4. æ€»ç»“å¯å¤ç”¨çš„ç»éªŒæ•™è®­

ã€é˜²æ­¢é‡å¤åæ€ - æœ€é«˜ä¼˜å…ˆçº§ã€‘
- æ£€æŸ¥æ‰§è¡Œå†å²æ˜¯å¦æœ‰é‡å¤æ¨¡å¼
- è¯†åˆ«ä¹‹å‰å·²å°è¯•çš„æ–¹æ¡ˆ
- ç¦æ­¢é‡å¤ç›¸åŒåˆ†æ
- æå‡ºæ–°çš„ã€æœªå°è¯•è¿‡çš„è§£å†³æ€è·¯

ã€æ˜¯å¦ç»§ç»­åæ€çš„å†³ç­–æŒ‡å—ã€‘
åº”è¯¥ç»§ç»­åæ€ (should_replan = true)ï¼š
  - å‘ç°å¯ä¿®å¤çš„é—®é¢˜
  - æœ‰æ–°çš„è§£å†³æ€è·¯
  - ä»»åŠ¡å®Œæˆåº¦ < 80%

åº”è¯¥åœæ­¢åæ€ (should_replan = false)ï¼š
  - ä»»åŠ¡å·²æˆåŠŸ âœ…
  - å®Œæˆåº¦ >= 80% âœ…
  - ç›¸åŒé”™è¯¯å‡ºç° â‰¥3æ¬¡ä¸”æ— æ–°æ–¹æ¡ˆ âŒ
  - è¿ç»­åæ€ â‰¥5è½®æ— æ”¹å–„ âŒ
  - å¤–éƒ¨å› ç´ å¯¼è‡´ âŒ
```

#### ç”¨æˆ·æç¤ºè¯æ¨¡æ¿ (BASE_REFLECTION_USER_TEMPLATE)

**ä»£ç ä½ç½®**: [src/llm/reflection_prompts.rs:260-315](src/llm/reflection_prompts.rs#L260-L315)

```
ã€ä»»åŠ¡ä¿¡æ¯ã€‘
- ä»»åŠ¡ç›®æ ‡: {task_description}
- å½“å‰è½®æ¬¡: ç¬¬ {current_round} è½®
- è½®æ¬¡å‚è€ƒæŒ‡å—ï¼ˆ1-3è½®æ­£å¸¸ï¼Œ6-10è½®è­¦å‘Šï¼Œ10è½®ä»¥ä¸Šå¼ºçƒˆå»ºè®®åœæ­¢ï¼‰

ã€æ‰§è¡Œå†å²ã€‘
{execution_history}

ã€åŸå§‹è®¡åˆ’ã€‘
{original_plan}

ã€è¯„ä¼°ç»“æœã€‘
{evaluation_result}

ã€åœºæ™¯æŒ‡å¯¼ã€‘
{scene_specific_guidance}
```

### 4.4 å•æ­¥åæ€æç¤ºè¯ç»“æ„

**ä»£ç ä½ç½®**: [src/llm/reflection_prompts.rs:321-482](src/llm/reflection_prompts.rs#L321-L482) (ç³»ç»Ÿæç¤ºè¯)

#### ç³»ç»Ÿæç¤ºè¯æ ¸å¿ƒå†…å®¹ (STEP_REFLECTION_SYSTEM_PROMPT)

```
ã€æ‰§è¡Œå†å²å®¡æŸ¥ - åæ€å‰çš„å¼ºåˆ¶æ­¥éª¤ã€‘
å¿…é¡»æ£€æŸ¥ï¼š
â–¡ 1. å†å²ä¸­æ˜¯å¦å·²æœ‰å¯¹ç›¸åŒ tool_id çš„å¤±è´¥è®°å½•ï¼Ÿ
â–¡ 2. å†å²ä¸­çš„åæ€å»ºè®®æ˜¯å¦å·²è¢«æ‰§è¡Œï¼Ÿ
â–¡ 3. å½“å‰é”™è¯¯ä¸å†å²é”™è¯¯çš„æœ¬è´¨åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ
â–¡ 4. ä½ èƒ½æä¾›ä»€ä¹ˆå†å²ä¸­æ²¡æœ‰çš„æ–°è§è§£ï¼Ÿ

ã€é‡å¤åæ€çš„åˆ¤å®šä¸å¤„ç†ã€‘
åˆ¤å®šæ ‡å‡†ï¼š
  - ç›¸åŒ tool_id + ç›¸åŒé”™è¯¯ä¿¡æ¯å‡ºç° â‰¥2 æ¬¡
  - ä¹‹å‰çš„å»ºè®®å·²æå‡ºä½†æœªè§£å†³
  - æ— æ³•æä¾›æ–°è§è§£

å¼ºåˆ¶å¤„ç†ï¼š
  - analysis å¿…é¡»ä»¥ "âš ï¸ é‡å¤åæ€æ£€æµ‹ï¼š" å¼€å¤´
  - suggested_action.type åªèƒ½æ˜¯ "stop" æˆ– "replan"

ã€å·¥å…·çº¦æŸã€‘
- å¤‡é€‰å·¥å…·å¿…é¡»ä»å¯ç”¨å·¥å…·åˆ—è¡¨ä¸­é€‰æ‹©
- ä¸¥ç¦è‡†é€ ä¸å­˜åœ¨çš„å·¥å…·
- å¦‚æœæ²¡æœ‰åˆé€‚çš„å·¥å…·ï¼Œå»ºè®® stop æˆ– replan
```

#### ç”¨æˆ·æç¤ºè¯æ¨¡æ¿ (STEP_REFLECTION_USER_TEMPLATE)

**ä»£ç ä½ç½®**: [src/llm/reflection_prompts.rs:486-615](src/llm/reflection_prompts.rs#L486-L615)

```
ã€æ‰§è¡Œå†å² - å¿…é¡»é¦–å…ˆé˜…è¯»ï¼ã€‘
{execution_history}

ã€å½“å‰å¤±è´¥æ­¥éª¤ã€‘
- æ­¥éª¤ ID: {step_id}
- å·¥å…· ID: {tool_id}
- æ­¥éª¤æè¿°: {step_description}
- å½“å‰é‡è¯•æ¬¡æ•°: ç¬¬ {retry_count} æ¬¡
- é‡è¯•æ¬¡æ•°å‚è€ƒæŒ‡å—ï¼ˆ1-2æ¬¡æ­£å¸¸ï¼Œ4-5æ¬¡è­¦å‘Šï¼Œ5æ¬¡ä»¥ä¸Šå¼ºçƒˆå»ºè®®stop/replanï¼‰

ã€é”™è¯¯ä¿¡æ¯ã€‘
{error_message}

ã€å½“å‰å…ƒæ•°æ®ã€‘
{metadata}

ã€å¯ç”¨å·¥å…·ã€‘
{available_tools}

ã€åœºæ™¯æŒ‡å¯¼ã€‘
{scene_specific_guidance}

ã€è¯Šæ–­ä»»åŠ¡ - 5æ­¥å¼ºåˆ¶æµç¨‹ã€‘
ç¬¬ä¸€æ­¥ï¼šæ‰§è¡Œå†å²å®¡æŸ¥ï¼ˆQ1-Q5ï¼‰
ç¬¬äºŒæ­¥ï¼šè¯æ®æ”¶é›†
ç¬¬ä¸‰æ­¥ï¼šå› æœæ¨ç†
ç¬¬å››æ­¥ï¼šæ–°è§è§£å£°æ˜
ç¬¬äº”æ­¥ï¼šJSONè¾“å‡º
```

---

## 5. ç¼–æ’å™¨ (Orchestrator) åæ€å¾ªç¯

**æ–‡ä»¶ä½ç½®**: [src/core/orchestrator.rs](src/core/orchestrator.rs)

### 5.1 ä¸Šä¸‹æ–‡å·¥ç¨‹äº‹ä»¶æ„å»ºå™¨

**ä»£ç ä½ç½®**: [src/core/orchestrator.rs:48-66](src/core/orchestrator.rs#L48-L66)

```rust
pub struct ContextEngineeringEventBuilder {
    /// ä»»åŠ¡æè¿°
    task_description: String,
    /// æˆåŠŸæ­¥éª¤åˆ—è¡¨
    pub successful_steps: Vec<SuccessfulStepData>,
    /// å¤±è´¥æ­¥éª¤åˆ—è¡¨
    pub failed_steps: Vec<FailedStepData>,
    /// å½“å‰åæ€è½®æ¬¡
    current_round: u32,
    /// ç´¯è®¡æ­¥éª¤é‡è¯•æ¬¡æ•°
    total_step_retries: u32,
    /// ç´¯è®¡ä»»åŠ¡é‡æ–°è§„åˆ’æ¬¡æ•°
    total_task_replans: u32,
}
```

### 5.2 æ ¸å¿ƒæ‰§è¡Œæµç¨‹

```
åæ€å¾ªç¯ (execute_reflective_loop):
â”‚
â”œâ”€ Phase 1: Planning è§„åˆ’é˜¶æ®µ
â”‚   â”œâ”€ ä¸¤é˜¶æ®µè§„åˆ’ï¼šå·¥å…·ç­›é€‰ â†’ ä»»åŠ¡è§„åˆ’
â”‚   â””â”€ æˆ–ç›´æ¥è§„åˆ’ï¼ˆå·¥å…·æ•°å°‘æ—¶ï¼‰
â”‚
â”œâ”€ Phase 2: Execution æ‰§è¡Œé˜¶æ®µ
â”‚   â”œâ”€ é€æ­¥æ‰§è¡Œ
â”‚   â”œâ”€ æˆåŠŸ â†’ è®°å½•åˆ° successful_steps
â”‚   â””â”€ å¤±è´¥ â†’ è§¦å‘å•æ­¥åæ€ â†’ æ ¹æ® suggested_action å¤„ç†
â”‚
â”œâ”€ Phase 3: Evaluation è¯„ä¼°é˜¶æ®µ
â”‚   â””â”€ ä»…å½“æœ‰æ­¥éª¤å¤±è´¥æ—¶æ‰è¿›è¡Œæ•´ä½“è¯„ä¼°
â”‚
â”œâ”€ Phase 4: Reflection åæ€é˜¶æ®µ
â”‚   â”œâ”€ è°ƒç”¨ reflect_with_context
â”‚   â”œâ”€ è·å– ReflectionResult
â”‚   â””â”€ æ ¹æ® should_replan å†³å®šæ˜¯å¦ç»§ç»­
â”‚
â””â”€ å¾ªç¯ç»ˆæ­¢æ¡ä»¶ï¼š
    â”œâ”€ should_replan = false
    â””â”€ æˆ–ä»»åŠ¡è¶…æ—¶
```

### 5.3 æ‰§è¡Œå†å²æ ¼å¼åŒ–

**ä»£ç ä½ç½®**: [src/core/orchestrator.rs:238-391](src/core/orchestrator.rs#L238-L391)

`format_to_file()` æ–¹æ³•ç”Ÿæˆçš„æ‰§è¡Œå†å²æ ¼å¼ï¼š

```
ä»»åŠ¡æè¿°: XXX

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“Š æ‰§è¡Œç»Ÿè®¡æ‘˜è¦
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  â€¢ å½“å‰åæ€è½®æ¬¡: ç¬¬ X è½®
  â€¢ ç´¯è®¡æ­¥éª¤é‡è¯•æ¬¡æ•°: X æ¬¡
  â€¢ ç´¯è®¡ä»»åŠ¡é‡è§„åˆ’æ¬¡æ•°: X æ¬¡
  â€¢ æˆåŠŸæ­¥éª¤æ•°: X
  â€¢ å¤±è´¥æ­¥éª¤æ•°: X

æˆåŠŸæ­¥éª¤åˆ—è¡¨ (å…± X ä¸ª):
æ­¥éª¤ #1: XXX
  æ­¥éª¤ID: XXX
  æ­¥éª¤æè¿°: XXX
  å·¥å…·ID: XXX
  ä¾èµ–æ­¥éª¤: XXX
  å·¥å…·å‚æ•°: {...}
  å·¥å…·è¾“å‡º: {...}
  æå–çš„å…³é”®å­—æ®µ: {...}

å¤±è´¥æ­¥éª¤åˆ—è¡¨ (å…± X ä¸ª):
æ­¥éª¤ #1: XXX
  æ­¥éª¤ID: XXX
  æ­¥éª¤æè¿°: XXX
  å·¥å…·ID: XXX
  é”™è¯¯ä¿¡æ¯: XXX
  åæ€ä¸æ“ä½œ: XXX
```

---

## 6. åœºæ™¯ç®¡ç†å™¨

**æ–‡ä»¶ä½ç½®**: [src/llm/scene_guidance.rs](src/llm/scene_guidance.rs)

### 6.1 æ”¯æŒçš„åœºæ™¯ç±»å‹

| ä»»åŠ¡ç±»å‹ | è¯´æ˜ |
|---------|------|
| è‡ªç„¶è¯­è¨€å»ºæ¨¡ | è‡ªåŠ¨å»ºæ¨¡ã€æ¨¡å‹ç”Ÿæˆ |
| å·¥å…·ç®¡ç† | å·¥å…·å¢åˆ æ”¹æŸ¥ |
| å®¢æˆ·ç«¯ç®¡ç† | å®¢æˆ·ç«¯æ“ä½œ |
| PLCæ§åˆ¶å™¨ | PLC ç›¸å…³æ“ä½œ |
| è´Ÿè·é¢„æµ‹ | è´Ÿè·é¢„æµ‹ä»»åŠ¡ |
| é€šç”¨ | é»˜è®¤å…œåº•åœºæ™¯ |

### 6.2 åœºæ™¯åŒ¹é…ç­–ç•¥

1. **ç²¾ç¡®åŒ¹é…**ï¼šä»»åŠ¡ç±»å‹å®Œå…¨åŒ¹é…
2. **æ¨¡ç³ŠåŒ¹é…**ï¼šä»»åŠ¡ç±»å‹åŒ…å«å…³é”®è¯
3. **é»˜è®¤å…œåº•**ï¼šä½¿ç”¨é€šç”¨åœºæ™¯æŒ‡å¯¼

---

## 7. é…ç½®ç³»ç»Ÿ

**æ–‡ä»¶ä½ç½®**: [src/config/mod.rs](src/config/mod.rs)

### 7.1 ç¼–æ’å™¨é…ç½®

```rust
pub struct OrchestratorConfig {
    // â˜…å·²å¼ƒç”¨ï¼Œä¸å†é™åˆ¶è½®æ•°
    #[deprecated]
    pub max_reflection_rounds: u32,        // é»˜è®¤ u32::MAX

    pub task_timeout_secs: u64,            // ä»»åŠ¡æ•´ä½“è¶…æ—¶
    pub enable_auto_reflection: bool,      // æ˜¯å¦è‡ªåŠ¨åæ€
    pub success_threshold: f32,            // æˆåŠŸè¯„åˆ†é˜ˆå€¼

    // ä¸¤é˜¶æ®µè§„åˆ’é…ç½®
    pub enable_two_stage_planning: bool,   // é»˜è®¤ true
    pub two_stage_tool_threshold: usize,   // é»˜è®¤ 10
    pub enable_builtin_workflows: bool,    // é»˜è®¤ true
    pub tool_selection_threshold: f32,     // é»˜è®¤ 70.0
}
```

### 7.2 åæ€é…ç½®

```rust
pub struct ReflectionConfig {
    // â˜…å·²å¼ƒç”¨ï¼Œä¸å†é™åˆ¶é‡è¯•æ¬¡æ•°
    #[deprecated]
    pub max_step_retries: usize,              // é»˜è®¤ usize::MAX
    #[deprecated]
    pub max_task_replanning_attempts: usize,  // é»˜è®¤ usize::MAX

    pub enable_step_level_reflection: bool,   // é»˜è®¤ true
}
```

### 7.3 è°ƒè¯•é…ç½®

```rust
pub struct DebugConfig {
    pub save_debug_log: bool,
    pub debug_log_file: String,
    pub save_context_engineering_event: bool,
    pub enable_post_task_evaluation: bool,
    pub enable_dynamic_parameter_inference: bool,
}
```

---

## 8. å…³é”®è°ƒç”¨å…³ç³»

### 8.1 ä»»åŠ¡çº§åæ€æµç¨‹

```
Orchestrator.execute_reflective_loop()
    â”‚
    â”œâ”€ Evaluator.evaluate() â†’ EvaluationResult
    â”‚
    â”œâ”€ æ„å»º ReflectionContext
    â”‚   â”œâ”€ task_type (ä»è§„åˆ’é˜¶æ®µè·å–)
    â”‚   â”œâ”€ user_context (ä» TaskContext æå–)
    â”‚   â””â”€ execution_history (ä» ContextEngineeringEventBuilder è·å–)
    â”‚
    â”œâ”€ Reflector.reflect_with_context()
    â”‚   â”œâ”€ ReflectionPromptBuilder.build_reflection_prompt()
    â”‚   â”‚   â”œâ”€ SceneManager.get_reflection_guidance()
    â”‚   â”‚   â””â”€ ç»„è£…ç³»ç»Ÿæç¤ºè¯ + ç”¨æˆ·æç¤ºè¯
    â”‚   â”œâ”€ LLM.call() â†’ åŸå§‹å“åº”
    â”‚   â””â”€ parse_reflection_response() â†’ ReflectionResult
    â”‚
    â””â”€ æ ¹æ® should_replan å†³ç­–
        â”œâ”€ true â†’ Planner.replan_task() â†’ æ–° ExecutionPlan â†’ ç»§ç»­å¾ªç¯
        â””â”€ false â†’ é€€å‡ºå¾ªç¯ï¼Œä»»åŠ¡å®Œæˆ
```

### 8.2 å•æ­¥åæ€æµç¨‹

```
Executor.execute_step()
    â”‚
    â”œâ”€ æ­¥éª¤æ‰§è¡Œå¤±è´¥
    â”‚
    â”œâ”€ Reflector.reflect_on_step_with_events()
    â”‚   â”œâ”€ ReflectionPromptBuilder.build_step_reflection_prompt()
    â”‚   â”‚   â”œâ”€ åŒ…å«æ‰§è¡Œå†å²
    â”‚   â”‚   â”œâ”€ åŒ…å«å¯ç”¨å·¥å…·åˆ—è¡¨
    â”‚   â”‚   â””â”€ åŒ…å«åœºæ™¯æŒ‡å¯¼
    â”‚   â”œâ”€ LLM.call() â†’ JSON å“åº”
    â”‚   â””â”€ parse_step_reflection_response() â†’ StepReflection
    â”‚
    â””â”€ æ ¹æ® suggested_action å¤„ç†
        â”œâ”€ RetryWithAdjustedParams â†’ è°ƒæ•´å‚æ•°é‡è¯•
        â”œâ”€ RetryWithAlternativeTool â†’ æ¢å·¥å…·é‡è¯•
        â”œâ”€ ReplanEntireTask â†’ è¿›å…¥åæ€é˜¶æ®µ
        â””â”€ StopExecution â†’ åœæ­¢æ‰§è¡Œ
```

---

## 9. æ ¸å¿ƒä»£ç ä½ç½®æ±‡æ€»

| æ¨¡å— | æ–‡ä»¶ | è¡Œå·èŒƒå›´ | è¯´æ˜ |
|------|------|----------|------|
| ReflectionResult | src/core/reflector.rs | 31-47 | ä»»åŠ¡çº§åæ€ç»“æœç»“æ„ |
| StepReflection | src/core/reflector.rs | 78-99 | å•æ­¥åæ€ç»“æœç»“æ„ |
| StepAction | src/core/reflector.rs | 49-60 | å•æ­¥è¡ŒåŠ¨æšä¸¾ |
| Reflector | src/core/reflector.rs | 206-218 | åæ€å™¨ç»“æ„ |
| reflect_with_context | src/core/reflector.rs | 429-483 | ä»»åŠ¡çº§åæ€æ–¹æ³• |
| reflect_on_step_with_events | src/core/reflector.rs | 817-881 | å•æ­¥åæ€æ–¹æ³• |
| parse_step_reflection_response | src/core/reflector.rs | 883-983 | è§£æå•æ­¥åæ€å“åº” |
| Planner | src/core/planner.rs | 31-60 | è§„åˆ’å™¨ç»“æ„ |
| extract_intent_from_task | src/core/planner.rs | 63-97 | æ„å›¾æå– |
| generate_plan_with_sender | src/core/planner.rs | 372-400 | ç”Ÿæˆæ‰§è¡Œè®¡åˆ’ |
| ReflectionContext | src/llm/reflection_prompts.rs | 24-32 | åæ€ä¸Šä¸‹æ–‡ |
| ReflectionPromptBuilder | src/llm/reflection_prompts.rs | 622-634 | åæ€æç¤ºè¯æ„å»ºå™¨ |
| build_reflection_prompt | src/llm/reflection_prompts.rs | 652-681 | æ„å»ºä»»åŠ¡çº§åæ€æç¤ºè¯ |
| build_step_reflection_prompt | src/llm/reflection_prompts.rs | 707-756 | æ„å»ºå•æ­¥åæ€æç¤ºè¯ |
| BASE_REFLECTION_SYSTEM_PROMPT | src/llm/reflection_prompts.rs | 103-257 | ä»»åŠ¡çº§åæ€ç³»ç»Ÿæç¤ºè¯ |
| BASE_REFLECTION_USER_TEMPLATE | src/llm/reflection_prompts.rs | 260-315 | ä»»åŠ¡çº§åæ€ç”¨æˆ·æ¨¡æ¿ |
| STEP_REFLECTION_SYSTEM_PROMPT | src/llm/reflection_prompts.rs | 321-482 | å•æ­¥åæ€ç³»ç»Ÿæç¤ºè¯ |
| STEP_REFLECTION_USER_TEMPLATE | src/llm/reflection_prompts.rs | 486-615 | å•æ­¥åæ€ç”¨æˆ·æ¨¡æ¿ |
| ContextEngineeringEventBuilder | src/core/orchestrator.rs | 48-66 | ä¸Šä¸‹æ–‡å·¥ç¨‹äº‹ä»¶æ„å»ºå™¨ |
| format_to_file | src/core/orchestrator.rs | 238-391 | æ ¼å¼åŒ–æ‰§è¡Œå†å² |

---

## 10. å…³é”®ç‰¹æ€§æ€»ç»“

### 10.1 æ™ºèƒ½è½®æ•°ç®¡ç†

**æ—§æ–¹å¼ï¼ˆå·²ç§»é™¤ï¼‰**:
```rust
if current_round >= max_rounds {
    stop()
}
```

**æ–°æ–¹å¼ï¼ˆå½“å‰ï¼‰**:
```rust
let reflection = reflector.reflect_with_context(...).await?;
if reflection.should_replan {
    continue_loop()
} else {
    break
}
```

### 10.2 é˜²æ­¢é‡å¤åæ€

æç¤ºè¯ä¸­æ˜ç¡®è¦æ±‚ï¼š
1. æ£€æŸ¥æ‰§è¡Œå†å²ä¸­æ˜¯å¦æœ‰é‡å¤çš„é”™è¯¯
2. æ£€æŸ¥ä¹‹å‰æ˜¯å¦å°è¯•è¿‡ç›¸åŒæ–¹æ¡ˆ
3. å¦‚æœæ˜¯é‡å¤ä¸”æ— æ–°è§è§£ï¼Œå¼ºåˆ¶å»ºè®® stop æˆ– replan
4. å¦‚æœæœ‰æ–°è§è§£ï¼Œå¿…é¡»æ˜ç¡®è¯´æ˜ä¸å†å²çš„åŒºåˆ«

### 10.3 ä¸¤é˜¶æ®µè§„åˆ’

**é˜¶æ®µ1**: å·¥å…·ç­›é€‰
- ä»æ‰€æœ‰å¯ç”¨å·¥å…·ä¸­ç­›é€‰ç›¸å…³å·¥å…·
- è¯†åˆ«ä»»åŠ¡ç±»å‹
- åŒ¹é…å†…ç½®ä»»åŠ¡æµç¨‹

**é˜¶æ®µ2**: ä»»åŠ¡è§„åˆ’
- åŸºäºç­›é€‰çš„å·¥å…·ç”Ÿæˆè¯¦ç»†æ‰§è¡Œè®¡åˆ’
- åˆ©ç”¨å·¥ä½œæµæç¤ºï¼ˆå¦‚æœåŒ¹é…ï¼‰

### 10.4 å•æ­¥åæ€ä¸æ­¥éª¤çº§æ¢å¤

```
å½“æ­¥éª¤Nå¤±è´¥:
  â”œâ”€ è°ƒç”¨å•æ­¥åæ€
  â”‚  â”œâ”€ æ£€æŸ¥æ‰§è¡Œå†å²
  â”‚  â”œâ”€ è¯Šæ–­æ ¹æœ¬åŸå› 
  â”‚  â””â”€ ç»™å‡ºå»ºè®®è¡ŒåŠ¨
  â”‚
  â””â”€ æ ¹æ® suggested_action
     â”œâ”€ RetryWithAdjustedParams: è°ƒæ•´å‚æ•°é‡è¯•
     â”œâ”€ RetryWithAlternativeTool: æ¢å·¥å…·é‡è¯•
     â”œâ”€ ReplanEntireTask: è¿›å…¥åæ€é˜¶æ®µ
     â””â”€ StopExecution: åœæ­¢æ‰§è¡Œ
```

### 10.5 ä¸Šä¸‹æ–‡å·¥ç¨‹

ç³»ç»Ÿå®æ—¶æ”¶é›†æ‰§è¡Œè¿‡ç¨‹ä¸­çš„ï¼š
- æˆåŠŸæ­¥éª¤ä¿¡æ¯ï¼ˆIDã€åç§°ã€å·¥å…·ã€è¾“å‡ºã€æå–çš„å­—æ®µï¼‰
- å¤±è´¥æ­¥éª¤ä¿¡æ¯ï¼ˆIDã€åç§°ã€å·¥å…·ã€é”™è¯¯ã€åæ€ç»“æœï¼‰
- æ‰§è¡Œç»Ÿè®¡ï¼ˆé‡è¯•æ¬¡æ•°ã€é‡è§„åˆ’æ¬¡æ•°ï¼‰

è¿™äº›ä¿¡æ¯è¢«æ ¼å¼åŒ–ä¸º**æ‰§è¡Œå†å²**ï¼Œä¼ é€’ç»™åæ€å™¨è¿›è¡Œæ™ºèƒ½å†³ç­–ã€‚

---

## 11. å…¸å‹æ‰§è¡Œæµç¨‹ç¤ºä¾‹

```
ã€ç¬¬1è½®ã€‘
Planning:    ç”Ÿæˆåˆå§‹è®¡åˆ’ (5ä¸ªæ­¥éª¤)
Executing:
  - Step 1: æˆåŠŸ âœ…
  - Step 2: æˆåŠŸ âœ…
  - Step 3: å¤±è´¥ âŒ
    â””â”€ è§¦å‘å•æ­¥åæ€ â†’ suggested_action: retry_with_params
  - Step 3: é‡è¯•æˆåŠŸ âœ…
  - Step 4: æˆåŠŸ âœ…
  - Step 5: å¤±è´¥ âŒ
    â””â”€ è§¦å‘å•æ­¥åæ€ â†’ suggested_action: replan

Evaluation: æ•´ä½“è¯„ä¼°
  - å®Œæ•´æ€§: 80%
  - æ­£ç¡®æ€§: 70%
  - æ•ˆç‡: 60%

Reflection: æ·±åº¦åæ€
  æ ¹å› åˆ†æ:
  - Step 3 å‚æ•°ä¸åŒ¹é…
  - Step 5 ä»»åŠ¡åˆ†è§£æœ‰é—®é¢˜

  should_replan = true âœ…

ã€ç¬¬2è½®ã€‘
Planning:    åŸºäºåæ€ç”Ÿæˆæ–°è®¡åˆ’ (6ä¸ªæ­¥éª¤)
Executing:   æ‰€æœ‰æ­¥éª¤æˆåŠŸ âœ…
Evaluation:  è·³è¿‡ï¼ˆå…¨éƒ¨æˆåŠŸï¼‰
Reflection:  should_replan = false âŒ

ã€ä»»åŠ¡å®Œæˆã€‘ âœ…
```

---

## 12. æ›´æ–°æ—¥å¿—

- **2026-01-12**: åˆ›å»ºæ–‡æ¡£ï¼Œè¯¦ç»†æè¿°åæ€ä¸è§„åˆ’çš„å®Œæ•´å®ç°é€»è¾‘ä¸ä»£ç æ˜ å°„

---

## 13. ç›¸å…³æ–‡æ¡£

- [17-ç§»é™¤è½®æ•°é™åˆ¶-ç”±å¤§æ¨¡å‹å†³å®šåæ€ä¸é‡è§„åˆ’](./17-ç§»é™¤è½®æ•°é™åˆ¶-ç”±å¤§æ¨¡å‹å†³å®šåæ€ä¸é‡è§„åˆ’.md)
- [14-å•æ­¥åæ€ä¸æ‰§è¡Œå†å²ä¼˜åŒ–è¯¦è§£](./14-å•æ­¥åæ€ä¸æ‰§è¡Œå†å²ä¼˜åŒ–è¯¦è§£.md)
- [10-è¯­ä¹‰è·¯ç”±æœºåˆ¶ä¸åœºæ™¯æ„ŸçŸ¥æç¤ºè¯ç³»ç»Ÿè®¾è®¡æ–‡æ¡£](./10-è¯­ä¹‰è·¯ç”±æœºåˆ¶ä¸åœºæ™¯æ„ŸçŸ¥æç¤ºè¯ç³»ç»Ÿè®¾è®¡æ–‡æ¡£(äººä¸ºå¹²é¢„ä¸åŒæ„å›¾åœºæ™¯ä¸‹å¤§æ¨¡å‹è¡ŒåŠ¨çš„æ ¸å¿ƒæ­¦å™¨).md)
- [11-ä¸Šä¸‹æ–‡å·¥ç¨‹äº‹ä»¶å®ç°ç»†èŠ‚](./11-ä¸Šä¸‹æ–‡å·¥ç¨‹äº‹ä»¶å®ç°ç»†èŠ‚.md)
- [4-ä¸¤é˜¶æ®µè§„åˆ’æ¶æ„ä¸å®ç°](./4-ä¸¤é˜¶æ®µè§„åˆ’æ¶æ„ä¸å®ç°.md)
