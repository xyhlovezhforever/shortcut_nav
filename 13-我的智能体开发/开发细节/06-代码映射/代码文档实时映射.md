# 任务编排服务代码文档实时映射

> **文档版本**: v1.0
> **最后更新**: 2026-01-12
> **维护说明**: 本文档提供代码与文档之间的双向映射关系，便于快速定位

---

## 目录

1. [核心模块代码映射](#核心模块代码映射)
2. [LLM提示词模块映射](#llm提示词模块映射)
3. [功能到代码的映射](#功能到代码的映射)
4. [文档到代码的映射](#文档到代码的映射)
5. [代码到文档的映射](#代码到文档的映射)

---

## 核心模块代码映射

### src/core/ - 核心业务逻辑模块

| 文件名 | 大小 | 主要功能 | 相关文档 | 核心结构体/方法 |
|--------|------|----------|----------|----------------|
| **orchestrator.rs** | 163KB | 任务编排器，核心工作流程控制 | [04-评估与提示词/5-提示词系统与核心工作流程.md](../04-评估与提示词/5-提示词系统与核心工作流程.md)<br>[03-反思与恢复/18-反思与规划实现逻辑与代码映射详解.md](../03-反思与恢复/18-反思与规划实现逻辑与代码映射详解.md) | `Orchestrator`<br>`execute_task_iteration()`<br>`execute_reflective_loop()`<br>`ContextEngineeringEventBuilder` |
| **planner.rs** | 99KB | 任务规划器，两阶段规划 | [02-规划系统/4-两阶段规划架构与实现.md](../02-规划系统/4-两阶段规划架构与实现.md)<br>[03-反思与恢复/18-反思与规划实现逻辑与代码映射详解.md](../03-反思与恢复/18-反思与规划实现逻辑与代码映射详解.md) | `Planner`<br>`generate_plan_with_sender()`<br>`select_relevant_tools()`<br>`replan_task()` |
| **executor.rs** | 107KB | 步骤执行器，参数解析与执行 | [01-核心机制/1-数据槽位的智能流转.md](../01-核心机制/1-数据槽位的智能流转.md)<br>[01-核心机制/16-动态参数推断功能实现详解.md](../01-核心机制/16-动态参数推断功能实现详解.md) | `Executor`<br>`execute_single_step()`<br>`execute_single_step_with_overrides()`<br>`infer_parameters_with_llm()` |
| **reflector.rs** | 42KB | 反思分析器，失败诊断 | [03-反思与恢复/19-反思机制设计与实现文档.md](../03-反思与恢复/19-反思机制设计与实现文档.md)<br>[03-反思与恢复/18-反思与规划实现逻辑与代码映射详解.md](../03-反思与恢复/18-反思与规划实现逻辑与代码映射详解.md) | `Reflector`<br>`reflect_with_context()`<br>`reflect_on_step()`<br>`StepReflection` |
| **parallel_executor.rs** | 31KB | 并行执行器，DAG调度 | [01-核心机制/8-并行执行功能代码修改详细记录.md](../01-核心机制/8-并行执行功能代码修改详细记录.md) | `ParallelExecutor`<br>`execute_plan_parallel()`<br>`build_dependency_graph()` |
| **parameter_resolver.rs** | 60KB | 参数解析器，占位符处理 | [01-核心机制/1-数据槽位的智能流转.md](../01-核心机制/1-数据槽位的智能流转.md)<br>[01-核心机制/7-多步骤执行与参数动态占位机制详解.md](../01-核心机制/7-多步骤执行与参数动态占位机制详解.md) | `ParameterResolver`<br>`resolve_parameters()`<br>`resolve_placeholder()` |
| **execution_context.rs** | 22KB | 执行上下文管理 | [01-核心机制/1-数据槽位的智能流转.md](../01-核心机制/1-数据槽位的智能流转.md) | `ExecutionContext`<br>`get_runtime_metadata()`<br>`set_step_result()` |
| **evaluator.rs** | 20KB | 评估器，任务完成度评估 | [04-评估与提示词/5-提示词系统与核心工作流程.md](../04-评估与提示词/5-提示词系统与核心工作流程.md) | `Evaluator`<br>`evaluate()`<br>`EvaluationResult` |
| **post_task_evaluator.rs** | 21KB | 任务后评估器 | [04-评估与提示词/13-任务后评估功能实现详解.md](../04-评估与提示词/13-任务后评估功能实现详解.md)<br>[03-反思与恢复/14-单步反思与执行历史优化详解.md](../03-反思与恢复/14-单步反思与执行历史优化详解.md) | `PostTaskEvaluator`<br>`evaluate_completed_task()`<br>`extract_round_statistics_from_context()` |

---

## LLM提示词模块映射

### src/llm/ - LLM交互与提示词模块

| 文件名 | 大小 | 主要功能 | 相关文档 | 核心结构体/方法 |
|--------|------|----------|----------|----------------|
| **reflection_prompts.rs** | 53KB | 反思提示词系统 | [03-反思与恢复/19-反思机制设计与实现文档.md](../03-反思与恢复/19-反思机制设计与实现文档.md)<br>[03-反思与恢复/18-反思与规划实现逻辑与代码映射详解.md](../03-反思与恢复/18-反思与规划实现逻辑与代码映射详解.md) | `ReflectionPromptBuilder`<br>`build_reflection_prompt()`<br>`build_step_reflection_prompt()`<br>`ReflectionContext` |
| **planning_prompts.rs** | 26KB | 规划阶段提示词 | [02-规划系统/10-语义路由机制与场景感知提示词系统设计文档.md](../02-规划系统/10-语义路由机制与场景感知提示词系统设计文档(人为干预不同意图场景下大模型行动的核心武器).md) | `PlanningPromptBuilder`<br>`build_planning_prompt()`<br>`PlanningContext` |
| **replanning_prompts.rs** | 20KB | 重新规划提示词 | [02-规划系统/10-语义路由机制与场景感知提示词系统设计文档.md](../02-规划系统/10-语义路由机制与场景感知提示词系统设计文档(人为干预不同意图场景下大模型行动的核心武器).md) | `ReplanningPromptBuilder`<br>`build_replanning_prompt()` |
| **scene_guidance.rs** | 22KB | 场景管理与场景指导 | [02-规划系统/10-语义路由机制与场景感知提示词系统设计文档.md](../02-规划系统/10-语义路由机制与场景感知提示词系统设计文档(人为干预不同意图场景下大模型行动的核心武器).md) | `SceneManager`<br>`SceneType`<br>`get_planning_guidance()`<br>`get_reflection_guidance()` |
| **selection_prompts.rs** | 18KB | 工具筛选提示词 | [02-规划系统/4-两阶段规划架构与实现.md](../02-规划系统/4-两阶段规划架构与实现.md) | `ToolSelectionPromptBuilder`<br>`build_tool_selection_prompt()` |
| **continue_planning_prompts.rs** | 22KB | 继续规划提示词 | [02-规划系统/15-继续规划功能实现详解.md](../02-规划系统/15-继续规划功能实现详解.md) | `ContinuePlanningPromptBuilder`<br>`build_continue_planning_prompt()` |
| **parameter_inference_prompts.rs** | 11KB | 动态参数推断提示词 | [01-核心机制/16-动态参数推断功能实现详解.md](../01-核心机制/16-动态参数推断功能实现详解.md) | `ParameterInferencePromptBuilder`<br>`build_parameter_inference_prompt()`<br>`ParameterInferenceContext` |
| **post_task_evaluation_prompts.rs** | 17KB | 任务后评估提示词 | [04-评估与提示词/13-任务后评估功能实现详解.md](../04-评估与提示词/13-任务后评估功能实现详解.md) | `PostTaskEvaluationPromptBuilder`<br>`build_post_task_evaluation_prompt()` |
| **evaluation_prompts.rs** | 8KB | 评估阶段提示词 | [04-评估与提示词/5-提示词系统与核心工作流程.md](../04-评估与提示词/5-提示词系统与核心工作流程.md) | `EvaluationPromptBuilder`<br>`build_evaluation_prompt()` |
| **message_formatter_prompts.rs** | 6KB | 消息格式化提示词 | [04-评估与提示词/12-上下文工程事件-格式化文本使用指南.md](../04-评估与提示词/12-上下文工程事件-格式化文本使用指南.md) | `MessageFormatterPromptBuilder` |
| **message_templates.rs** | 32KB | 消息模板系统 | [04-评估与提示词/12-上下文工程事件-格式化文本使用指南.md](../04-评估与提示词/12-上下文工程事件-格式化文本使用指南.md) | 各种消息模板常量 |
| **prompts.rs** | 11KB | 通用提示词工具 | [04-评估与提示词/5-提示词系统与核心工作流程.md](../04-评估与提示词/5-提示词系统与核心工作流程.md) | 工具筛选提示词 |
| **unified_client.rs** | 5KB | 统一LLM客户端接口 | 所有涉及LLM调用的文档 | `UnifiedLlmClient`<br>`call_llm()` |

---

## 功能到代码的映射

### 1. 数据流转与参数处理

**功能**: 步骤间数据传递、参数占位符解析、运行时元数据管理

**核心代码**:
```
src/core/execution_context.rs
├── ExecutionContext::init_metadata()          # 初始化元数据
├── ExecutionContext::get_runtime_metadata()   # 获取运行时元数据
├── ExecutionContext::set_step_result()        # 保存步骤结果
└── ExecutionContext::sync_output_to_metadata()# 同步输出到metadata

src/core/parameter_resolver.rs
├── ParameterResolver::resolve_parameters()    # 解析步骤参数
├── ParameterResolver::resolve_placeholder()   # 解析占位符
├── ParameterResolver::resolve_step_output()   # 解析步骤输出引用
└── ParameterResolver::resolve_metadata()      # 解析元数据引用

src/core/orchestrator.rs
└── Orchestrator::sync_step_output_to_metadata() # 同步步骤输出到元数据
```

**相关文档**:
- [01-核心机制/1-数据槽位的智能流转.md](../01-核心机制/1-数据槽位的智能流转.md)
- [01-核心机制/7-多步骤执行与参数动态占位机制详解.md](../01-核心机制/7-多步骤执行与参数动态占位机制详解.md)

---

### 2. 两阶段规划

**功能**: 工具筛选 → 任务分解的两阶段规划流程

**核心代码**:
```
src/core/planner.rs
├── Planner::select_relevant_tools()           # 阶段1: 工具筛选
├── Planner::generate_plan_with_sender()       # 阶段2: 任务分解
├── Planner::extract_intent_from_task()        # 意图提取
└── Planner::get_selected_tools()              # 获取筛选后的工具

src/llm/selection_prompts.rs
└── ToolSelectionPromptBuilder::build_tool_selection_prompt() # 工具筛选提示词

src/llm/planning_prompts.rs
└── PlanningPromptBuilder::build_planning_prompt() # 任务分解提示词
```

**相关文档**:
- [02-规划系统/4-两阶段规划架构与实现.md](../02-规划系统/4-两阶段规划架构与实现.md)

---

### 3. 场景感知与语义路由

**功能**: 根据任务类型自动选择场景特定的提示词策略

**核心代码**:
```
src/llm/scene_guidance.rs
├── SceneManager::new()                        # 场景管理器初始化
├── SceneManager::get_planning_guidance()      # 获取规划阶段场景指导
├── SceneManager::get_reflection_guidance()    # 获取反思阶段场景指导
├── SceneManager::get_replanning_guidance()    # 获取重规划阶段场景指导
└── SceneType (enum)                           # 场景类型枚举

src/core/planner.rs
└── Planner::extract_intent_from_task()        # 从任务描述提取意图

src/llm/planning_prompts.rs
src/llm/reflection_prompts.rs
src/llm/replanning_prompts.rs
└── 各自的 PromptBuilder 调用 SceneManager 获取场景指导
```

**相关文档**:
- [02-规划系统/10-语义路由机制与场景感知提示词系统设计文档.md](../02-规划系统/10-语义路由机制与场景感知提示词系统设计文档(人为干预不同意图场景下大模型行动的核心武器).md)

---

### 4. 反思机制

**功能**: 单步反思 + 计划级反思的两级反思架构

**核心代码**:
```
src/core/reflector.rs
├── Reflector::reflect_with_context()          # 计划级反思
├── Reflector::reflect_on_step()               # 单步反思
├── Reflector::parse_reflection_response()     # 解析反思响应
├── StepReflection (struct)                    # 单步反思结果
├── StepAction (enum)                          # 单步行动类型
└── ReflectionResult (struct)                  # 计划级反思结果

src/llm/reflection_prompts.rs
├── ReflectionPromptBuilder::build_reflection_prompt()      # 计划级反思提示词
├── ReflectionPromptBuilder::build_step_reflection_prompt() # 单步反思提示词
├── ReflectionContext (struct)                 # 反思上下文
├── BASE_REFLECTION_SYSTEM_PROMPT              # 计划级反思系统提示词
├── STEP_REFLECTION_SYSTEM_PROMPT              # 单步反思系统提示词
└── 各种场景特定的反思指导

src/core/orchestrator.rs
├── Orchestrator::execute_reflection_phase()   # 执行反思阶段
├── Orchestrator::execute_execution_phase_with_metadata() # 执行阶段(含单步反思)
└── ContextEngineeringEventBuilder             # 上下文工程事件构建器
```

**相关文档**:
- [03-反思与恢复/19-反思机制设计与实现文档.md](../03-反思与恢复/19-反思机制设计与实现文档.md)
- [03-反思与恢复/18-反思与规划实现逻辑与代码映射详解.md](../03-反思与恢复/18-反思与规划实现逻辑与代码映射详解.md)
- [03-反思与恢复/14-单步反思与执行历史优化详解.md](../03-反思与恢复/14-单步反思与执行历史优化详解.md)

---

### 5. 执行历史与上下文工程

**功能**: 记录、格式化和传递执行历史，避免重复反思

**核心代码**:
```
src/core/orchestrator.rs
├── ContextEngineeringEventBuilder::new()      # 创建事件构建器
├── ContextEngineeringEventBuilder::add_successful_step() # 添加成功步骤
├── ContextEngineeringEventBuilder::add_failed_step()     # 添加失败步骤
├── ContextEngineeringEventBuilder::format_to_file()      # 格式化为文本
├── ContextEngineeringEventBuilder::get_execution_summary() # 获取执行摘要
├── SuccessfulStepData (struct)                # 成功步骤数据
└── FailedStepData (struct)                    # 失败步骤数据

src/core/orchestrator.rs (反思调用处)
└── 在单步反思时检查是否有相同工具的失败记录，决定是否传入执行历史
```

**相关文档**:
- [04-评估与提示词/11-上下文工程事件实现细节.md](../04-评估与提示词/11-上下文工程事件实现细节.md)
- [04-评估与提示词/12-上下文工程事件-格式化文本使用指南.md](../04-评估与提示词/12-上下文工程事件-格式化文本使用指南.md)
- [03-反思与恢复/14-单步反思与执行历史优化详解.md](../03-反思与恢复/14-单步反思与执行历史优化详解.md)

---

### 6. 动态参数推断

**功能**: 运行时通过LLM动态推断步骤参数

**核心代码**:
```
src/core/executor.rs
├── Executor::infer_parameters_with_llm()      # 调用LLM推断参数
├── Executor::execute_step_with_inference()    # 使用推断后的参数执行
└── 配置开关: config.debug.enable_dynamic_parameter_inference

src/llm/parameter_inference_prompts.rs
├── ParameterInferencePromptBuilder::build_parameter_inference_prompt()
├── ParameterInferenceContext (struct)         # 参数推断上下文
└── ParameterInferenceResult (struct)          # 参数推断结果

src/config/mod.rs
└── DebugConfig::enable_dynamic_parameter_inference # 配置开关
```

**相关文档**:
- [01-核心机制/16-动态参数推断功能实现详解.md](../01-核心机制/16-动态参数推断功能实现详解.md)

---

### 7. 并行执行

**功能**: 基于DAG的并行步骤执行

**核心代码**:
```
src/core/parallel_executor.rs
├── ParallelExecutor::execute_plan_parallel()  # 并行执行计划
├── ParallelExecutor::build_dependency_graph() # 构建依赖图
├── ParallelExecutor::topological_sort()       # 拓扑排序
└── ParallelExecutor::execute_batch()          # 批量执行步骤
```

**相关文档**:
- [01-核心机制/8-并行执行功能代码修改详细记录.md](../01-核心机制/8-并行执行功能代码修改详细记录.md)

---

### 8. 任务后评估

**功能**: 任务完成后的全面复盘和评估

**核心代码**:
```
src/core/post_task_evaluator.rs
├── PostTaskEvaluator::evaluate_completed_task() # 评估已完成任务
├── PostTaskEvaluator::extract_round_statistics_from_context() # 从上下文提取统计
├── PostTaskEvaluator::extract_key_events_from_context()       # 提取关键事件
└── PostTaskEvaluation (struct)                # 任务后评估结果

src/llm/post_task_evaluation_prompts.rs
├── PostTaskEvaluationPromptBuilder::build_post_task_evaluation_prompt()
└── 任务后评估提示词模板
```

**相关文档**:
- [04-评估与提示词/13-任务后评估功能实现详解.md](../04-评估与提示词/13-任务后评估功能实现详解.md)

---

### 9. 事件推送

**功能**: 实时向客户端推送任务执行进度

**核心代码**:
```
src/grpc/server.rs
├── TaskOrchestrationService::execute_task()   # gRPC服务入口
├── EventSender (trait)                        # 事件发送器接口
├── GrpcEventSender::send_step_started()       # 发送步骤开始事件
├── GrpcEventSender::send_step_completed()     # 发送步骤完成事件
└── 其他事件发送方法

src/core/orchestrator.rs
└── 在各个阶段调用 event_sender 发送事件
```

**相关文档**:
- [05-集成与推送/6-user模式下服务端事件推送机制详解.md](../05-集成与推送/6-user模式下服务端事件推送机制详解.md)

---

## 文档到代码的映射

### 01-核心机制

| 文档 | 主要涉及的代码文件 |
|------|------------------|
| [1-数据槽位的智能流转.md](../01-核心机制/1-数据槽位的智能流转.md) | `src/core/execution_context.rs`<br>`src/core/parameter_resolver.rs`<br>`src/core/executor.rs`<br>`src/core/orchestrator.rs` |
| [7-多步骤执行与参数动态占位机制详解.md](../01-核心机制/7-多步骤执行与参数动态占位机制详解.md) | `src/core/parameter_resolver.rs`<br>`src/core/executor.rs` |
| [8-并行执行功能代码修改详细记录.md](../01-核心机制/8-并行执行功能代码修改详细记录.md) | `src/core/parallel_executor.rs` |
| [16-动态参数推断功能实现详解.md](../01-核心机制/16-动态参数推断功能实现详解.md) | `src/core/executor.rs`<br>`src/llm/parameter_inference_prompts.rs`<br>`src/config/mod.rs` |

### 02-规划系统

| 文档 | 主要涉及的代码文件 |
|------|------------------|
| [4-两阶段规划架构与实现.md](../02-规划系统/4-两阶段规划架构与实现.md) | `src/core/planner.rs`<br>`src/llm/selection_prompts.rs`<br>`src/llm/planning_prompts.rs`<br>`src/grpc/server.rs` |
| [10-语义路由机制与场景感知提示词系统设计文档.md](../02-规划系统/10-语义路由机制与场景感知提示词系统设计文档(人为干预不同意图场景下大模型行动的核心武器).md) | `src/llm/scene_guidance.rs`<br>`src/llm/planning_prompts.rs`<br>`src/llm/reflection_prompts.rs`<br>`src/llm/replanning_prompts.rs`<br>`src/core/planner.rs` |
| [15-继续规划功能实现详解.md](../02-规划系统/15-继续规划功能实现详解.md) | `src/core/planner.rs`<br>`src/llm/continue_planning_prompts.rs` |

### 03-反思与恢复

| 文档 | 主要涉及的代码文件 |
|------|------------------|
| [14-单步反思与执行历史优化详解.md](../03-反思与恢复/14-单步反思与执行历史优化详解.md) | `src/core/orchestrator.rs`<br>`src/core/reflector.rs`<br>`src/core/post_task_evaluator.rs`<br>`src/llm/reflection_prompts.rs` |
| [17-移除轮数限制-由大模型决定反思与重规划.md](../03-反思与恢复/17-移除轮数限制-由大模型决定反思与重规划.md) | `src/core/orchestrator.rs`<br>`src/core/reflector.rs`<br>`src/config/mod.rs` |
| [18-反思与规划实现逻辑与代码映射详解.md](../03-反思与恢复/18-反思与规划实现逻辑与代码映射详解.md) | `src/core/reflector.rs`<br>`src/core/planner.rs`<br>`src/core/orchestrator.rs`<br>`src/llm/reflection_prompts.rs`<br>`src/llm/scene_guidance.rs` |
| [19-反思机制设计与实现文档.md](../03-反思与恢复/19-反思机制设计与实现文档.md) | `src/llm/reflection_prompts.rs`<br>`src/core/reflector.rs`<br>`src/core/orchestrator.rs`<br>`src/core/parallel_executor.rs` |

### 04-评估与提示词

| 文档 | 主要涉及的代码文件 |
|------|------------------|
| [5-提示词系统与核心工作流程.md](../04-评估与提示词/5-提示词系统与核心工作流程.md) | `src/core/orchestrator.rs`<br>`src/core/planner.rs`<br>`src/core/evaluator.rs`<br>`src/core/reflector.rs`<br>`src/llm/prompts.rs` |
| [11-上下文工程事件实现细节.md](../04-评估与提示词/11-上下文工程事件实现细节.md) | `src/core/orchestrator.rs` (ContextEngineeringEventBuilder) |
| [12-上下文工程事件-格式化文本使用指南.md](../04-评估与提示词/12-上下文工程事件-格式化文本使用指南.md) | `src/core/orchestrator.rs`<br>`src/llm/message_formatter_prompts.rs`<br>`src/llm/message_templates.rs` |
| [13-任务后评估功能实现详解.md](../04-评估与提示词/13-任务后评估功能实现详解.md) | `src/core/post_task_evaluator.rs`<br>`src/llm/post_task_evaluation_prompts.rs` |

### 05-集成与推送

| 文档 | 主要涉及的代码文件 |
|------|------------------|
| [6-user模式下服务端事件推送机制详解.md](../05-集成与推送/6-user模式下服务端事件推送机制详解.md) | `src/grpc/server.rs`<br>`src/core/orchestrator.rs` (event_sender调用) |

---

## 代码到文档的映射

### 核心代码文件的文档索引

#### orchestrator.rs (163KB)

**功能**: 任务编排核心，控制整个工作流程

**关键方法**:
- `execute_task_iteration()` - 执行任务迭代（含反思循环）
- `execute_reflective_loop()` - 反思型规划循环
- `execute_planning_phase()` - 规划阶段
- `execute_execution_phase_with_metadata()` - 执行阶段（含单步反思）
- `execute_evaluation_phase()` - 评估阶段
- `execute_reflection_phase()` - 反思阶段
- `ContextEngineeringEventBuilder` - 上下文工程事件构建器

**相关文档**:
1. [04-评估与提示词/5-提示词系统与核心工作流程.md](../04-评估与提示词/5-提示词系统与核心工作流程.md) - 整体流程
2. [03-反思与恢复/18-反思与规划实现逻辑与代码映射详解.md](../03-反思与恢复/18-反思与规划实现逻辑与代码映射详解.md) - 反思循环
3. [03-反思与恢复/14-单步反思与执行历史优化详解.md](../03-反思与恢复/14-单步反思与执行历史优化详解.md) - 执行历史
4. [04-评估与提示词/11-上下文工程事件实现细节.md](../04-评估与提示词/11-上下文工程事件实现细节.md) - 上下文工程

---

#### planner.rs (99KB)

**功能**: 任务规划，包括两阶段规划和重新规划

**关键方法**:
- `select_relevant_tools()` - 工具筛选（两阶段规划第1阶段）
- `generate_plan_with_sender()` - 生成执行计划（两阶段规划第2阶段）
- `replan_task()` - 任务重新规划
- `replan_single_step()` - 单步修复
- `extract_intent_from_task()` - 意图提取

**相关文档**:
1. [02-规划系统/4-两阶段规划架构与实现.md](../02-规划系统/4-两阶段规划架构与实现.md) - 两阶段规划
2. [02-规划系统/10-语义路由机制与场景感知提示词系统设计文档.md](../02-规划系统/10-语义路由机制与场景感知提示词系统设计文档(人为干预不同意图场景下大模型行动的核心武器).md) - 场景路由
3. [03-反思与恢复/18-反思与规划实现逻辑与代码映射详解.md](../03-反思与恢复/18-反思与规划实现逻辑与代码映射详解.md) - 规划器实现

---

#### reflector.rs (42KB)

**功能**: 反思分析，包括单步反思和计划级反思

**关键方法**:
- `reflect_with_context()` - 计划级反思
- `reflect_on_step()` - 单步反思
- `parse_reflection_response()` - 解析反思响应
- `parse_step_reflection_response()` - 解析单步反思响应

**关键数据结构**:
- `ReflectionResult` - 计划级反思结果
- `StepReflection` - 单步反思结果
- `StepAction` - 单步行动决策

**相关文档**:
1. [03-反思与恢复/19-反思机制设计与实现文档.md](../03-反思与恢复/19-反思机制设计与实现文档.md) - 反思机制全面解析
2. [03-反思与恢复/18-反思与规划实现逻辑与代码映射详解.md](../03-反思与恢复/18-反思与规划实现逻辑与代码映射详解.md) - 反思器实现
3. [03-反思与恢复/14-单步反思与执行历史优化详解.md](../03-反思与恢复/14-单步反思与执行历史优化详解.md) - 单步反思优化

---

#### executor.rs (107KB)

**功能**: 步骤执行，包括参数解析、工具调用、动态推断

**关键方法**:
- `execute_single_step()` - 执行单个步骤
- `execute_single_step_with_overrides()` - 带参数/工具覆盖的执行
- `infer_parameters_with_llm()` - LLM动态参数推断
- `execute_step_with_inference()` - 使用推断参数执行

**相关文档**:
1. [01-核心机制/1-数据槽位的智能流转.md](../01-核心机制/1-数据槽位的智能流转.md) - 数据流转
2. [01-核心机制/16-动态参数推断功能实现详解.md](../01-核心机制/16-动态参数推断功能实现详解.md) - 动态推断

---

#### reflection_prompts.rs (53KB)

**功能**: 反思提示词系统

**关键内容**:
- `ReflectionPromptBuilder` - 反思提示词构建器
- `BASE_REFLECTION_SYSTEM_PROMPT` - 计划级反思系统提示词
- `STEP_REFLECTION_SYSTEM_PROMPT` - 单步反思系统提示词
- `ReflectionContext` - 反思上下文

**相关文档**:
1. [03-反思与恢复/19-反思机制设计与实现文档.md](../03-反思与恢复/19-反思机制设计与实现文档.md) - 反思提示词设计
2. [03-反思与恢复/18-反思与规划实现逻辑与代码映射详解.md](../03-反思与恢复/18-反思与规划实现逻辑与代码映射详解.md) - 提示词系统结构

---

#### scene_guidance.rs (22KB)

**功能**: 场景管理与场景特定指导

**关键内容**:
- `SceneManager` - 场景管理器
- `SceneType` - 场景类型枚举
- `get_planning_guidance()` - 规划阶段场景指导
- `get_reflection_guidance()` - 反思阶段场景指导

**相关文档**:
1. [02-规划系统/10-语义路由机制与场景感知提示词系统设计文档.md](../02-规划系统/10-语义路由机制与场景感知提示词系统设计文档(人为干预不同意图场景下大模型行动的核心武器).md)

---

## 快速查找指南

### 我想修改...

| 功能需求 | 主要修改的文件 | 参考文档 |
|---------|--------------|---------|
| **参数传递逻辑** | `src/core/parameter_resolver.rs`<br>`src/core/execution_context.rs` | [01-核心机制/1-数据槽位的智能流转.md](../01-核心机制/1-数据槽位的智能流转.md) |
| **规划算法** | `src/core/planner.rs`<br>`src/llm/planning_prompts.rs` | [02-规划系统/4-两阶段规划架构与实现.md](../02-规划系统/4-两阶段规划架构与实现.md) |
| **反思决策逻辑** | `src/core/reflector.rs`<br>`src/llm/reflection_prompts.rs` | [03-反思与恢复/19-反思机制设计与实现文档.md](../03-反思与恢复/19-反思机制设计与实现文档.md) |
| **工具筛选逻辑** | `src/core/planner.rs`<br>`src/llm/selection_prompts.rs` | [02-规划系统/4-两阶段规划架构与实现.md](../02-规划系统/4-两阶段规划架构与实现.md) |
| **场景匹配规则** | `src/llm/scene_guidance.rs` | [02-规划系统/10-语义路由机制与场景感知提示词系统设计文档.md](../02-规划系统/10-语义路由机制与场景感知提示词系统设计文档(人为干预不同意图场景下大模型行动的核心武器).md) |
| **并行执行策略** | `src/core/parallel_executor.rs` | [01-核心机制/8-并行执行功能代码修改详细记录.md](../01-核心机制/8-并行执行功能代码修改详细记录.md) |
| **评估标准** | `src/core/evaluator.rs`<br>`src/llm/evaluation_prompts.rs` | [04-评估与提示词/5-提示词系统与核心工作流程.md](../04-评估与提示词/5-提示词系统与核心工作流程.md) |
| **事件推送格式** | `src/grpc/server.rs` | [05-集成与推送/6-user模式下服务端事件推送机制详解.md](../05-集成与推送/6-user模式下服务端事件推送机制详解.md) |

---

## 维护说明

### 如何保持此文档的同步

1. **代码重构时**: 更新"核心模块代码映射"和"LLM提示词模块映射"表格中的文件大小和方法名
2. **新增功能时**: 在"功能到代码的映射"部分添加新功能的映射
3. **文档更新时**: 在"文档到代码的映射"部分更新相关文档链接
4. **代码迁移时**: 更新"代码到文档的映射"部分的代码位置

### 文档更新检查清单

- [ ] 文件路径是否正确
- [ ] 文件大小是否更新（可选）
- [ ] 方法名是否准确
- [ ] 文档链接是否有效
- [ ] 新增功能是否已映射
- [ ] 相关文档是否已关联

---

**最后更新**: 2026-01-12
**维护者**: 开发团队
**版本**: v1.0
